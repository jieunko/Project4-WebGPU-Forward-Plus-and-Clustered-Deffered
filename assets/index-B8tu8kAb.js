(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const h of d)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function c(d){const h={};return d.integrity&&(h.integrity=d.integrity),d.referrerPolicy&&(h.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?h.credentials="include":d.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function u(d){if(d.ep)return;d.ep=!0;const h=c(d);fetch(d.href,h)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var stats_min={exports:{}};(function(t,e){(function(c,u){t.exports=u()})(commonjsGlobal,function(){var c=function(){function u(X){return m.appendChild(X.dom),X}function d(X){for(var j=0;j<m.children.length;j++)m.children[j].style.display=j===X?"block":"none";h=X}var h=0,m=document.createElement("div");m.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",m.addEventListener("click",function(X){X.preventDefault(),d(++h%m.children.length)},!1);var p=(performance||Date).now(),y=p,M=0,F=u(new c.Panel("FPS","#0ff","#002")),L=u(new c.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var K=u(new c.Panel("MB","#f08","#201"));return d(0),{REVISION:16,dom:m,addPanel:u,showPanel:d,begin:function(){p=(performance||Date).now()},end:function(){M++;var X=(performance||Date).now();if(L.update(X-p,200),X>y+1e3&&(F.update(1e3*M/(X-y),100),y=X,M=0,K)){var j=performance.memory;K.update(j.usedJSHeapSize/1048576,j.jsHeapSizeLimit/1048576)}return X},update:function(){p=this.end()},domElement:m,setMode:d}};return c.Panel=function(u,d,h){var m=1/0,p=0,y=Math.round,M=y(window.devicePixelRatio||1),F=80*M,L=48*M,K=3*M,X=2*M,j=3*M,Q=15*M,z=74*M,re=30*M,ie=document.createElement("canvas");ie.width=F,ie.height=L,ie.style.cssText="width:80px;height:48px";var te=ie.getContext("2d");return te.font="bold "+9*M+"px Helvetica,Arial,sans-serif",te.textBaseline="top",te.fillStyle=h,te.fillRect(0,0,F,L),te.fillStyle=d,te.fillText(u,K,X),te.fillRect(j,Q,z,re),te.fillStyle=h,te.globalAlpha=.9,te.fillRect(j,Q,z,re),{dom:ie,update:function(ge,Be){m=Math.min(m,ge),p=Math.max(p,ge),te.fillStyle=h,te.globalAlpha=1,te.fillRect(0,0,F,Q),te.fillStyle=d,te.fillText(y(ge)+" "+u+" ("+y(m)+"-"+y(p)+")",K,X),te.drawImage(ie,j+M,Q,z-M,re,j,Q,z-M,re),te.fillRect(j+z-M,Q,M,re),te.fillStyle=h,te.globalAlpha=.9,te.fillRect(j+z-M,Q,M,y((1-ge/Be)*re))}}},c})})(stats_min);var stats_minExports=stats_min.exports;const Stats=getDefaultExportFromCjs(stats_minExports);function ___$insertStyle(t){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function colorToString(t,e){var c=t.__state.conversionName.toString(),u=Math.round(t.r),d=Math.round(t.g),h=Math.round(t.b),m=t.a,p=Math.round(t.h),y=t.s.toFixed(1),M=t.v.toFixed(1);if(e||c==="THREE_CHAR_HEX"||c==="SIX_CHAR_HEX"){for(var F=t.hex.toString(16);F.length<6;)F="0"+F;return"#"+F}else{if(c==="CSS_RGB")return"rgb("+u+","+d+","+h+")";if(c==="CSS_RGBA")return"rgba("+u+","+d+","+h+","+m+")";if(c==="HEX")return"0x"+t.hex.toString(16);if(c==="RGB_ARRAY")return"["+u+","+d+","+h+"]";if(c==="RGBA_ARRAY")return"["+u+","+d+","+h+","+m+"]";if(c==="RGB_OBJ")return"{r:"+u+",g:"+d+",b:"+h+"}";if(c==="RGBA_OBJ")return"{r:"+u+",g:"+d+",b:"+h+",a:"+m+"}";if(c==="HSV_OBJ")return"{h:"+p+",s:"+y+",v:"+M+"}";if(c==="HSVA_OBJ")return"{h:"+p+",s:"+y+",v:"+M+",a:"+m+"}"}return"unknown format"}var ARR_EACH=Array.prototype.forEach,ARR_SLICE=Array.prototype.slice,Common={BREAK:{},extend:function(e){return this.each(ARR_SLICE.call(arguments,1),function(c){var u=this.isObject(c)?Object.keys(c):[];u.forEach(function(d){this.isUndefined(c[d])||(e[d]=c[d])}.bind(this))},this),e},defaults:function(e){return this.each(ARR_SLICE.call(arguments,1),function(c){var u=this.isObject(c)?Object.keys(c):[];u.forEach(function(d){this.isUndefined(e[d])&&(e[d]=c[d])}.bind(this))},this),e},compose:function(){var e=ARR_SLICE.call(arguments);return function(){for(var c=ARR_SLICE.call(arguments),u=e.length-1;u>=0;u--)c=[e[u].apply(this,c)];return c[0]}},each:function(e,c,u){if(e){if(ARR_EACH&&e.forEach&&e.forEach===ARR_EACH)e.forEach(c,u);else if(e.length===e.length+0){var d=void 0,h=void 0;for(d=0,h=e.length;d<h;d++)if(d in e&&c.call(u,e[d],d)===this.BREAK)return}else for(var m in e)if(c.call(u,e[m],m)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,c,u){var d=void 0;return function(){var h=this,m=arguments;function p(){d=null,u||e.apply(h,m)}var y=u||!d;clearTimeout(d),d=setTimeout(p,c),y&&e.apply(h,m)}},toArray:function(e){return e.toArray?e.toArray():ARR_SLICE.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(t){function e(c){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},INTERPRETATIONS=[{litmus:Common.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var c=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return c===null?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString()+c[1].toString()+c[2].toString()+c[2].toString()+c[3].toString()+c[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function(e){var c=e.match(/^#([A-F0-9]{6})$/i);return c===null?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function(e){var c=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return c===null?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])}},write:colorToString},CSS_RGBA:{read:function(e){var c=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return c===null?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3]),a:parseFloat(c[4])}},write:colorToString}}},{litmus:Common.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Common.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Common.isObject,conversions:{RGBA_OBJ:{read:function(e){return Common.isNumber(e.r)&&Common.isNumber(e.g)&&Common.isNumber(e.b)&&Common.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return Common.isNumber(e.r)&&Common.isNumber(e.g)&&Common.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return Common.isNumber(e.h)&&Common.isNumber(e.s)&&Common.isNumber(e.v)&&Common.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return Common.isNumber(e.h)&&Common.isNumber(e.s)&&Common.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],result=void 0,toReturn=void 0,interpret=function(){toReturn=!1;var e=arguments.length>1?Common.toArray(arguments):arguments[0];return Common.each(INTERPRETATIONS,function(c){if(c.litmus(e))return Common.each(c.conversions,function(u,d){if(result=u.read(e),toReturn===!1&&result!==!1)return toReturn=result,result.conversionName=d,result.conversion=u,Common.BREAK}),Common.BREAK}),toReturn},tmpComponent=void 0,ColorMath={hsv_to_rgb:function(e,c,u){var d=Math.floor(e/60)%6,h=e/60-Math.floor(e/60),m=u*(1-c),p=u*(1-h*c),y=u*(1-(1-h)*c),M=[[u,y,m],[p,u,m],[m,u,y],[m,p,u],[y,m,u],[u,m,p]][d];return{r:M[0]*255,g:M[1]*255,b:M[2]*255}},rgb_to_hsv:function(e,c,u){var d=Math.min(e,c,u),h=Math.max(e,c,u),m=h-d,p=void 0,y=void 0;if(h!==0)y=m/h;else return{h:NaN,s:0,v:0};return e===h?p=(c-u)/m:c===h?p=2+(u-e)/m:p=4+(e-c)/m,p/=6,p<0&&(p+=1),{h:p*360,s:y,v:h/255}},rgb_to_hex:function(e,c,u){var d=this.hex_with_component(0,2,e);return d=this.hex_with_component(d,1,c),d=this.hex_with_component(d,0,u),d},component_from_hex:function(e,c){return e>>c*8&255},hex_with_component:function(e,c,u){return u<<(tmpComponent=c*8)|e&~(255<<tmpComponent)}},_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(e,c){for(var u=0;u<c.length;u++){var d=c[u];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(e,d.key,d)}}return function(e,c,u){return c&&t(e.prototype,c),u&&t(e,u),e}}(),get=function t(e,c,u){e===null&&(e=Function.prototype);var d=Object.getOwnPropertyDescriptor(e,c);if(d===void 0){var h=Object.getPrototypeOf(e);return h===null?void 0:t(h,c,u)}else{if("value"in d)return d.value;var m=d.get;return m===void 0?void 0:m.call(u)}},inherits=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},Color=function(){function t(){if(classCallCheck(this,t),this.__state=interpret.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return createClass(t,[{key:"toString",value:function(){return colorToString(this)}},{key:"toHexString",value:function(){return colorToString(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function defineRGBComponent(t,e,c){Object.defineProperty(t,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(Color.recalculateRGB(this,e,c),this.__state[e])},set:function(d){this.__state.space!=="RGB"&&(Color.recalculateRGB(this,e,c),this.__state.space="RGB"),this.__state[e]=d}})}function defineHSVComponent(t,e){Object.defineProperty(t,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(Color.recalculateHSV(this),this.__state[e])},set:function(u){this.__state.space!=="HSV"&&(Color.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=u}})}Color.recalculateRGB=function(t,e,c){if(t.__state.space==="HEX")t.__state[e]=ColorMath.component_from_hex(t.__state.hex,c);else if(t.__state.space==="HSV")Common.extend(t.__state,ColorMath.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v));else throw new Error("Corrupted color state")};Color.recalculateHSV=function(t){var e=ColorMath.rgb_to_hsv(t.r,t.g,t.b);Common.extend(t.__state,{s:e.s,v:e.v}),Common.isNaN(e.h)?Common.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h};Color.COMPONENTS=["r","g","b","h","s","v","hex","a"];defineRGBComponent(Color.prototype,"r",2);defineRGBComponent(Color.prototype,"g",1);defineRGBComponent(Color.prototype,"b",0);defineHSVComponent(Color.prototype,"h");defineHSVComponent(Color.prototype,"s");defineHSVComponent(Color.prototype,"v");Object.defineProperty(Color.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(Color.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ColorMath.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Controller=function(){function t(e,c){classCallCheck(this,t),this.initialValue=e[c],this.domElement=document.createElement("div"),this.object=e,this.property=c,this.__onChange=void 0,this.__onFinishChange=void 0}return createClass(t,[{key:"onChange",value:function(c){return this.__onChange=c,this}},{key:"onFinishChange",value:function(c){return this.__onFinishChange=c,this}},{key:"setValue",value:function(c){return this.object[this.property]=c,this.__onChange&&this.__onChange.call(this,c),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),EVENT_MAP={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},EVENT_MAP_INV={};Common.each(EVENT_MAP,function(t,e){Common.each(t,function(c){EVENT_MAP_INV[c]=e})});var CSS_VALUE_PIXELS=/(\d+(\.\d+)?)px/;function cssValueToPixels(t){if(t==="0"||Common.isUndefined(t))return 0;var e=t.match(CSS_VALUE_PIXELS);return Common.isNull(e)?0:parseFloat(e[1])}var dom={makeSelectable:function(e,c){e===void 0||e.style===void 0||(e.onselectstart=c?function(){return!1}:function(){},e.style.MozUserSelect=c?"auto":"none",e.style.KhtmlUserSelect=c?"auto":"none",e.unselectable=c?"on":"off")},makeFullscreen:function(e,c,u){var d=u,h=c;Common.isUndefined(h)&&(h=!0),Common.isUndefined(d)&&(d=!0),e.style.position="absolute",h&&(e.style.left=0,e.style.right=0),d&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,c,u,d){var h=u||{},m=EVENT_MAP_INV[c];if(!m)throw new Error("Event type "+c+" not supported.");var p=document.createEvent(m);switch(m){case"MouseEvents":{var y=h.x||h.clientX||0,M=h.y||h.clientY||0;p.initMouseEvent(c,h.bubbles||!1,h.cancelable||!0,window,h.clickCount||1,0,0,y,M,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var F=p.initKeyboardEvent||p.initKeyEvent;Common.defaults(h,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),F(c,h.bubbles||!1,h.cancelable,window,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.keyCode,h.charCode);break}default:{p.initEvent(c,h.bubbles||!1,h.cancelable||!0);break}}Common.defaults(p,d),e.dispatchEvent(p)},bind:function(e,c,u,d){var h=d||!1;return e.addEventListener?e.addEventListener(c,u,h):e.attachEvent&&e.attachEvent("on"+c,u),dom},unbind:function(e,c,u,d){var h=d||!1;return e.removeEventListener?e.removeEventListener(c,u,h):e.detachEvent&&e.detachEvent("on"+c,u),dom},addClass:function(e,c){if(e.className===void 0)e.className=c;else if(e.className!==c){var u=e.className.split(/ +/);u.indexOf(c)===-1&&(u.push(c),e.className=u.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return dom},removeClass:function(e,c){if(c)if(e.className===c)e.removeAttribute("class");else{var u=e.className.split(/ +/),d=u.indexOf(c);d!==-1&&(u.splice(d,1),e.className=u.join(" "))}else e.className=void 0;return dom},hasClass:function(e,c){return new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var c=getComputedStyle(e);return cssValueToPixels(c["border-left-width"])+cssValueToPixels(c["border-right-width"])+cssValueToPixels(c["padding-left"])+cssValueToPixels(c["padding-right"])+cssValueToPixels(c.width)},getHeight:function(e){var c=getComputedStyle(e);return cssValueToPixels(c["border-top-width"])+cssValueToPixels(c["border-bottom-width"])+cssValueToPixels(c["padding-top"])+cssValueToPixels(c["padding-bottom"])+cssValueToPixels(c.height)},getOffset:function(e){var c=e,u={left:0,top:0};if(c.offsetParent)do u.left+=c.offsetLeft,u.top+=c.offsetTop,c=c.offsetParent;while(c);return u},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},BooleanController=function(t){inherits(e,t);function e(c,u){classCallCheck(this,e);var d=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u)),h=d;d.__prev=d.getValue(),d.__checkbox=document.createElement("input"),d.__checkbox.setAttribute("type","checkbox");function m(){h.setValue(!h.__prev)}return dom.bind(d.__checkbox,"change",m,!1),d.domElement.appendChild(d.__checkbox),d.updateDisplay(),d}return createClass(e,[{key:"setValue",value:function(u){var d=get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,u);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),d}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Controller),OptionController=function(t){inherits(e,t);function e(c,u,d){classCallCheck(this,e);var h=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u)),m=d,p=h;if(h.__select=document.createElement("select"),Common.isArray(m)){var y={};Common.each(m,function(M){y[M]=M}),m=y}return Common.each(m,function(M,F){var L=document.createElement("option");L.innerHTML=F,L.setAttribute("value",M),p.__select.appendChild(L)}),h.updateDisplay(),dom.bind(h.__select,"change",function(){var M=this.options[this.selectedIndex].value;p.setValue(M)}),h.domElement.appendChild(h.__select),h}return createClass(e,[{key:"setValue",value:function(u){var d=get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,u);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),d}},{key:"updateDisplay",value:function(){return dom.isActive(this.__select)?this:(this.__select.value=this.getValue(),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Controller),StringController=function(t){inherits(e,t);function e(c,u){classCallCheck(this,e);var d=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u)),h=d;function m(){h.setValue(h.__input.value)}function p(){h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}return d.__input=document.createElement("input"),d.__input.setAttribute("type","text"),dom.bind(d.__input,"keyup",m),dom.bind(d.__input,"change",m),dom.bind(d.__input,"blur",p),dom.bind(d.__input,"keydown",function(y){y.keyCode===13&&this.blur()}),d.updateDisplay(),d.domElement.appendChild(d.__input),d}return createClass(e,[{key:"updateDisplay",value:function(){return dom.isActive(this.__input)||(this.__input.value=this.getValue()),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Controller);function numDecimals(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var NumberController=function(t){inherits(e,t);function e(c,u,d){classCallCheck(this,e);var h=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u)),m=d||{};return h.__min=m.min,h.__max=m.max,h.__step=m.step,Common.isUndefined(h.__step)?h.initialValue===0?h.__impliedStep=1:h.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(h.initialValue))/Math.LN10))/10:h.__impliedStep=h.__step,h.__precision=numDecimals(h.__impliedStep),h}return createClass(e,[{key:"setValue",value:function(u){var d=u;return this.__min!==void 0&&d<this.__min?d=this.__min:this.__max!==void 0&&d>this.__max&&(d=this.__max),this.__step!==void 0&&d%this.__step!==0&&(d=Math.round(d/this.__step)*this.__step),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,d)}},{key:"min",value:function(u){return this.__min=u,this}},{key:"max",value:function(u){return this.__max=u,this}},{key:"step",value:function(u){return this.__step=u,this.__impliedStep=u,this.__precision=numDecimals(u),this}}]),e}(Controller);function roundToDecimal(t,e){var c=Math.pow(10,e);return Math.round(t*c)/c}var NumberControllerBox=function(t){inherits(e,t);function e(c,u,d){classCallCheck(this,e);var h=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u,d));h.__truncationSuspended=!1;var m=h,p=void 0;function y(){var j=parseFloat(m.__input.value);Common.isNaN(j)||m.setValue(j)}function M(){m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function F(){M()}function L(j){var Q=p-j.clientY;m.setValue(m.getValue()+Q*m.__impliedStep),p=j.clientY}function K(){dom.unbind(window,"mousemove",L),dom.unbind(window,"mouseup",K),M()}function X(j){dom.bind(window,"mousemove",L),dom.bind(window,"mouseup",K),p=j.clientY}return h.__input=document.createElement("input"),h.__input.setAttribute("type","text"),dom.bind(h.__input,"change",y),dom.bind(h.__input,"blur",F),dom.bind(h.__input,"mousedown",X),dom.bind(h.__input,"keydown",function(j){j.keyCode===13&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1,M())}),h.updateDisplay(),h.domElement.appendChild(h.__input),h}return createClass(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():roundToDecimal(this.getValue(),this.__precision),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(NumberController);function map(t,e,c,u,d){return u+(d-u)*((t-e)/(c-e))}var NumberControllerSlider=function(t){inherits(e,t);function e(c,u,d,h,m){classCallCheck(this,e);var p=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u,{min:d,max:h,step:m})),y=p;p.__background=document.createElement("div"),p.__foreground=document.createElement("div"),dom.bind(p.__background,"mousedown",M),dom.bind(p.__background,"touchstart",K),dom.addClass(p.__background,"slider"),dom.addClass(p.__foreground,"slider-fg");function M(Q){document.activeElement.blur(),dom.bind(window,"mousemove",F),dom.bind(window,"mouseup",L),F(Q)}function F(Q){Q.preventDefault();var z=y.__background.getBoundingClientRect();return y.setValue(map(Q.clientX,z.left,z.right,y.__min,y.__max)),!1}function L(){dom.unbind(window,"mousemove",F),dom.unbind(window,"mouseup",L),y.__onFinishChange&&y.__onFinishChange.call(y,y.getValue())}function K(Q){Q.touches.length===1&&(dom.bind(window,"touchmove",X),dom.bind(window,"touchend",j),X(Q))}function X(Q){var z=Q.touches[0].clientX,re=y.__background.getBoundingClientRect();y.setValue(map(z,re.left,re.right,y.__min,y.__max))}function j(){dom.unbind(window,"touchmove",X),dom.unbind(window,"touchend",j),y.__onFinishChange&&y.__onFinishChange.call(y,y.getValue())}return p.updateDisplay(),p.__background.appendChild(p.__foreground),p.domElement.appendChild(p.__background),p}return createClass(e,[{key:"updateDisplay",value:function(){var u=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=u*100+"%",get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(NumberController),FunctionController=function(t){inherits(e,t);function e(c,u,d){classCallCheck(this,e);var h=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u)),m=h;return h.__button=document.createElement("div"),h.__button.innerHTML=d===void 0?"Fire":d,dom.bind(h.__button,"click",function(p){return p.preventDefault(),m.fire(),!1}),dom.addClass(h.__button,"button"),h.domElement.appendChild(h.__button),h}return createClass(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Controller),ColorController=function(t){inherits(e,t);function e(c,u){classCallCheck(this,e);var d=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,u));d.__color=new Color(d.getValue()),d.__temp=new Color(0);var h=d;d.domElement=document.createElement("div"),dom.makeSelectable(d.domElement,!1),d.__selector=document.createElement("div"),d.__selector.className="selector",d.__saturation_field=document.createElement("div"),d.__saturation_field.className="saturation-field",d.__field_knob=document.createElement("div"),d.__field_knob.className="field-knob",d.__field_knob_border="2px solid ",d.__hue_knob=document.createElement("div"),d.__hue_knob.className="hue-knob",d.__hue_field=document.createElement("div"),d.__hue_field.className="hue-field",d.__input=document.createElement("input"),d.__input.type="text",d.__input_textShadow="0 1px 1px ",dom.bind(d.__input,"keydown",function(Q){Q.keyCode===13&&L.call(this)}),dom.bind(d.__input,"blur",L),dom.bind(d.__selector,"mousedown",function(){dom.addClass(this,"drag").bind(window,"mouseup",function(){dom.removeClass(h.__selector,"drag")})}),dom.bind(d.__selector,"touchstart",function(){dom.addClass(this,"drag").bind(window,"touchend",function(){dom.removeClass(h.__selector,"drag")})});var m=document.createElement("div");Common.extend(d.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Common.extend(d.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:d.__field_knob_border+(d.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Common.extend(d.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Common.extend(d.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Common.extend(m.style,{width:"100%",height:"100%",background:"none"}),linearGradient(m,"top","rgba(0,0,0,0)","#000"),Common.extend(d.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hueGradient(d.__hue_field),Common.extend(d.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:d.__input_textShadow+"rgba(0,0,0,0.7)"}),dom.bind(d.__saturation_field,"mousedown",p),dom.bind(d.__saturation_field,"touchstart",p),dom.bind(d.__field_knob,"mousedown",p),dom.bind(d.__field_knob,"touchstart",p),dom.bind(d.__hue_field,"mousedown",y),dom.bind(d.__hue_field,"touchstart",y);function p(Q){X(Q),dom.bind(window,"mousemove",X),dom.bind(window,"touchmove",X),dom.bind(window,"mouseup",M),dom.bind(window,"touchend",M)}function y(Q){j(Q),dom.bind(window,"mousemove",j),dom.bind(window,"touchmove",j),dom.bind(window,"mouseup",F),dom.bind(window,"touchend",F)}function M(){dom.unbind(window,"mousemove",X),dom.unbind(window,"touchmove",X),dom.unbind(window,"mouseup",M),dom.unbind(window,"touchend",M),K()}function F(){dom.unbind(window,"mousemove",j),dom.unbind(window,"touchmove",j),dom.unbind(window,"mouseup",F),dom.unbind(window,"touchend",F),K()}function L(){var Q=interpret(this.value);Q!==!1?(h.__color.__state=Q,h.setValue(h.__color.toOriginal())):this.value=h.__color.toString()}function K(){h.__onFinishChange&&h.__onFinishChange.call(h,h.__color.toOriginal())}d.__saturation_field.appendChild(m),d.__selector.appendChild(d.__field_knob),d.__selector.appendChild(d.__saturation_field),d.__selector.appendChild(d.__hue_field),d.__hue_field.appendChild(d.__hue_knob),d.domElement.appendChild(d.__input),d.domElement.appendChild(d.__selector),d.updateDisplay();function X(Q){Q.type.indexOf("touch")===-1&&Q.preventDefault();var z=h.__saturation_field.getBoundingClientRect(),re=Q.touches&&Q.touches[0]||Q,ie=re.clientX,te=re.clientY,ge=(ie-z.left)/(z.right-z.left),Be=1-(te-z.top)/(z.bottom-z.top);return Be>1?Be=1:Be<0&&(Be=0),ge>1?ge=1:ge<0&&(ge=0),h.__color.v=Be,h.__color.s=ge,h.setValue(h.__color.toOriginal()),!1}function j(Q){Q.type.indexOf("touch")===-1&&Q.preventDefault();var z=h.__hue_field.getBoundingClientRect(),re=Q.touches&&Q.touches[0]||Q,ie=re.clientY,te=1-(ie-z.top)/(z.bottom-z.top);return te>1?te=1:te<0&&(te=0),h.__color.h=te*360,h.setValue(h.__color.toOriginal()),!1}return d}return createClass(e,[{key:"updateDisplay",value:function(){var u=interpret(this.getValue());if(u!==!1){var d=!1;Common.each(Color.COMPONENTS,function(p){if(!Common.isUndefined(u[p])&&!Common.isUndefined(this.__color.__state[p])&&u[p]!==this.__color.__state[p])return d=!0,{}},this),d&&Common.extend(this.__color.__state,u)}Common.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var h=this.__color.v<.5||this.__color.s>.5?255:0,m=255-h;Common.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+h+","+h+","+h+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Common.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+h+","+h+","+h+")",textShadow:this.__input_textShadow+"rgba("+m+","+m+","+m+",.7)"})}}]),e}(Controller),vendors=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(t,e,c,u){t.style.background="",Common.each(vendors,function(d){t.style.cssText+="background: "+d+"linear-gradient("+e+", "+c+" 0%, "+u+" 100%); "})}function hueGradient(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var css={load:function(e,c){var u=c||document,d=u.createElement("link");d.type="text/css",d.rel="stylesheet",d.href=e,u.getElementsByTagName("head")[0].appendChild(d)},inject:function(e,c){var u=c||document,d=document.createElement("style");d.type="text/css",d.innerHTML=e;var h=u.getElementsByTagName("head")[0];try{h.appendChild(d)}catch{}}},saveDialogContents=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,ControllerFactory=function(e,c){var u=e[c];return Common.isArray(arguments[2])||Common.isObject(arguments[2])?new OptionController(e,c,arguments[2]):Common.isNumber(u)?Common.isNumber(arguments[2])&&Common.isNumber(arguments[3])?Common.isNumber(arguments[4])?new NumberControllerSlider(e,c,arguments[2],arguments[3],arguments[4]):new NumberControllerSlider(e,c,arguments[2],arguments[3]):Common.isNumber(arguments[4])?new NumberControllerBox(e,c,{min:arguments[2],max:arguments[3],step:arguments[4]}):new NumberControllerBox(e,c,{min:arguments[2],max:arguments[3]}):Common.isString(u)?new StringController(e,c):Common.isFunction(u)?new FunctionController(e,c,""):Common.isBoolean(u)?new BooleanController(e,c):null};function requestAnimationFrame$1(t){setTimeout(t,1e3/60)}var requestAnimationFrame$1$1=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||requestAnimationFrame$1,CenteredDiv=function(){function t(){classCallCheck(this,t),this.backgroundElement=document.createElement("div"),Common.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),dom.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Common.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;dom.bind(this.backgroundElement,"click",function(){e.hide()})}return createClass(t,[{key:"show",value:function(){var c=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Common.defer(function(){c.backgroundElement.style.opacity=1,c.domElement.style.opacity=1,c.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var c=this,u=function d(){c.domElement.style.display="none",c.backgroundElement.style.display="none",dom.unbind(c.domElement,"webkitTransitionEnd",d),dom.unbind(c.domElement,"transitionend",d),dom.unbind(c.domElement,"oTransitionEnd",d)};dom.bind(this.domElement,"webkitTransitionEnd",u),dom.bind(this.domElement,"transitionend",u),dom.bind(this.domElement,"oTransitionEnd",u),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-dom.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-dom.getHeight(this.domElement)/2+"px"}}]),t}(),styleSheet=___$insertStyle(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);css.inject(styleSheet);var CSS_NAMESPACE="dg",HIDE_KEY_CODE=72,CLOSE_BUTTON_HEIGHT=20,DEFAULT_DEFAULT_PRESET_NAME="Default",SUPPORTS_LOCAL_STORAGE=function(){try{return!!window.localStorage}catch{return!1}}(),SAVE_DIALOGUE=void 0,autoPlaceVirgin=!0,autoPlaceContainer=void 0,hide=!1,hideableGuis=[],GUI=function t(e){var c=this,u=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),dom.addClass(this.domElement,CSS_NAMESPACE),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],u=Common.defaults(u,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),u=Common.defaults(u,{resizable:u.autoPlace,hideable:u.autoPlace}),Common.isUndefined(u.load)?u.load={preset:DEFAULT_DEFAULT_PRESET_NAME}:u.preset&&(u.load.preset=u.preset),Common.isUndefined(u.parent)&&u.hideable&&hideableGuis.push(this),u.resizable=Common.isUndefined(u.parent)&&u.resizable,u.autoPlace&&Common.isUndefined(u.scrollable)&&(u.scrollable=!0);var d=SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(this,"isLocal"))==="true",h=void 0,m=void 0;if(Object.defineProperties(this,{parent:{get:function(){return u.parent}},scrollable:{get:function(){return u.scrollable}},autoPlace:{get:function(){return u.autoPlace}},closeOnTop:{get:function(){return u.closeOnTop}},preset:{get:function(){return c.parent?c.getRoot().preset:u.load.preset},set:function(K){c.parent?c.getRoot().preset=K:u.load.preset=K,setPresetSelectIndex(this),c.revert()}},width:{get:function(){return u.width},set:function(K){u.width=K,setWidth(c,K)}},name:{get:function(){return u.name},set:function(K){u.name=K,m&&(m.innerHTML=u.name)}},closed:{get:function(){return u.closed},set:function(K){u.closed=K,u.closed?dom.addClass(c.__ul,t.CLASS_CLOSED):dom.removeClass(c.__ul,t.CLASS_CLOSED),this.onResize(),c.__closeButton&&(c.__closeButton.innerHTML=K?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return u.load}},useLocalStorage:{get:function(){return d},set:function(K){SUPPORTS_LOCAL_STORAGE&&(d=K,K?dom.bind(window,"unload",h):dom.unbind(window,"unload",h),localStorage.setItem(getLocalStorageHash(c,"isLocal"),K))}}}),Common.isUndefined(u.parent)){if(this.closed=u.closed||!1,dom.addClass(this.domElement,t.CLASS_MAIN),dom.makeSelectable(this.domElement,!1),SUPPORTS_LOCAL_STORAGE&&d){c.useLocalStorage=!0;var p=localStorage.getItem(getLocalStorageHash(this,"gui"));p&&(u.load=JSON.parse(p))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,dom.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),u.closeOnTop?(dom.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(dom.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),dom.bind(this.__closeButton,"click",function(){c.closed=!c.closed})}else{u.closed===void 0&&(u.closed=!0);var y=document.createTextNode(u.name);dom.addClass(y,"controller-name"),m=addRow(c,y);var M=function(K){return K.preventDefault(),c.closed=!c.closed,!1};dom.addClass(this.__ul,t.CLASS_CLOSED),dom.addClass(m,"title"),dom.bind(m,"click",M),u.closed||(this.closed=!1)}u.autoPlace&&(Common.isUndefined(u.parent)&&(autoPlaceVirgin&&(autoPlaceContainer=document.createElement("div"),dom.addClass(autoPlaceContainer,CSS_NAMESPACE),dom.addClass(autoPlaceContainer,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(autoPlaceContainer),autoPlaceVirgin=!1),autoPlaceContainer.appendChild(this.domElement),dom.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||setWidth(c,u.width)),this.__resizeHandler=function(){c.onResizeDebounced()},dom.bind(window,"resize",this.__resizeHandler),dom.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),dom.bind(this.__ul,"transitionend",this.__resizeHandler),dom.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),u.resizable&&addResizeHandle(this),h=function(){SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(c,"isLocal"))==="true"&&localStorage.setItem(getLocalStorageHash(c,"gui"),JSON.stringify(c.getSaveObject()))},this.saveToLocalStorageIfPossible=h;function F(){var L=c.getRoot();L.width+=1,Common.defer(function(){L.width-=1})}u.parent||F()};GUI.toggleHide=function(){hide=!hide,Common.each(hideableGuis,function(t){t.domElement.style.display=hide?"none":""})};GUI.CLASS_AUTO_PLACE="a";GUI.CLASS_AUTO_PLACE_CONTAINER="ac";GUI.CLASS_MAIN="main";GUI.CLASS_CONTROLLER_ROW="cr";GUI.CLASS_TOO_TALL="taller-than-window";GUI.CLASS_CLOSED="closed";GUI.CLASS_CLOSE_BUTTON="close-button";GUI.CLASS_CLOSE_TOP="close-top";GUI.CLASS_CLOSE_BOTTOM="close-bottom";GUI.CLASS_DRAG="drag";GUI.DEFAULT_WIDTH=245;GUI.TEXT_CLOSED="Close Controls";GUI.TEXT_OPEN="Open Controls";GUI._keydownHandler=function(t){document.activeElement.type!=="text"&&(t.which===HIDE_KEY_CODE||t.keyCode===HIDE_KEY_CODE)&&GUI.toggleHide()};dom.bind(window,"keydown",GUI._keydownHandler,!1);Common.extend(GUI.prototype,{add:function(e,c){return _add(this,e,c,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,c){return _add(this,e,c,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var c=this;Common.defer(function(){c.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&autoPlaceContainer.removeChild(this.domElement);var e=this;Common.each(this.__folders,function(c){e.removeFolder(c)}),dom.unbind(window,"keydown",GUI._keydownHandler,!1),removeListeners(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var c={name:e,parent:this};c.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(c.closed=this.load.folders[e].closed,c.load=this.load.folders[e]);var u=new GUI(c);this.__folders[e]=u;var d=addRow(this,u.domElement);return dom.addClass(d,"folder"),u},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],removeListeners(e);var c=this;Common.each(e.__folders,function(u){e.removeFolder(u)}),Common.defer(function(){c.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var c=dom.getOffset(e.__ul).top,u=0;Common.each(e.__ul.childNodes,function(d){e.autoPlace&&d===e.__save_row||(u+=dom.getHeight(d))}),window.innerHeight-c-CLOSE_BUTTON_HEIGHT<u?(dom.addClass(e.domElement,GUI.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-c-CLOSE_BUTTON_HEIGHT+"px"):(dom.removeClass(e.domElement,GUI.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Common.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Common.debounce(function(){this.onResize()},50),remember:function(){if(Common.isUndefined(SAVE_DIALOGUE)&&(SAVE_DIALOGUE=new CenteredDiv,SAVE_DIALOGUE.domElement.innerHTML=saveDialogContents),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Common.each(Array.prototype.slice.call(arguments),function(c){e.__rememberedObjects.length===0&&addSaveMenu(e),e.__rememberedObjects.indexOf(c)===-1&&e.__rememberedObjects.push(c)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=getCurrentPreset(this)),e.folders={},Common.each(this.__folders,function(c,u){e.folders[u]=c.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME]=getCurrentPreset(this,!0)),this.load.remembered[e]=getCurrentPreset(this),this.preset=e,addPresetOption(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Common.each(this.__controllers,function(c){this.getRoot().load.remembered?recallSavedValue(e||this.getRoot(),c):c.setValue(c.initialValue),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())},this),Common.each(this.__folders,function(c){c.revert(c)}),e||markPresetModified(this.getRoot(),!1)},listen:function(e){var c=this.__listening.length===0;this.__listening.push(e),c&&updateDisplays(this.__listening)},updateDisplay:function(){Common.each(this.__controllers,function(e){e.updateDisplay()}),Common.each(this.__folders,function(e){e.updateDisplay()})}});function addRow(t,e,c){var u=document.createElement("li");return e&&u.appendChild(e),c?t.__ul.insertBefore(u,c):t.__ul.appendChild(u),t.onResize(),u}function removeListeners(t){dom.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&dom.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function markPresetModified(t,e){var c=t.__preset_select[t.__preset_select.selectedIndex];e?c.innerHTML=c.value+"*":c.innerHTML=c.value}function augmentController(t,e,c){if(c.__li=e,c.__gui=t,Common.extend(c,{options:function(m){if(arguments.length>1){var p=c.__li.nextElementSibling;return c.remove(),_add(t,c.object,c.property,{before:p,factoryArgs:[Common.toArray(arguments)]})}if(Common.isArray(m)||Common.isObject(m)){var y=c.__li.nextElementSibling;return c.remove(),_add(t,c.object,c.property,{before:y,factoryArgs:[m]})}},name:function(m){return c.__li.firstElementChild.firstElementChild.innerHTML=m,c},listen:function(){return c.__gui.listen(c),c},remove:function(){return c.__gui.remove(c),c}}),c instanceof NumberControllerSlider){var u=new NumberControllerBox(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});Common.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(h){var m=c[h],p=u[h];c[h]=u[h]=function(){var y=Array.prototype.slice.call(arguments);return p.apply(u,y),m.apply(c,y)}}),dom.addClass(e,"has-slider"),c.domElement.insertBefore(u.domElement,c.domElement.firstElementChild)}else if(c instanceof NumberControllerBox){var d=function(m){if(Common.isNumber(c.__min)&&Common.isNumber(c.__max)){var p=c.__li.firstElementChild.firstElementChild.innerHTML,y=c.__gui.__listening.indexOf(c)>-1;c.remove();var M=_add(t,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]});return M.name(p),y&&M.listen(),M}return m};c.min=Common.compose(d,c.min),c.max=Common.compose(d,c.max)}else c instanceof BooleanController?(dom.bind(e,"click",function(){dom.fakeEvent(c.__checkbox,"click")}),dom.bind(c.__checkbox,"click",function(h){h.stopPropagation()})):c instanceof FunctionController?(dom.bind(e,"click",function(){dom.fakeEvent(c.__button,"click")}),dom.bind(e,"mouseover",function(){dom.addClass(c.__button,"hover")}),dom.bind(e,"mouseout",function(){dom.removeClass(c.__button,"hover")})):c instanceof ColorController&&(dom.addClass(e,"color"),c.updateDisplay=Common.compose(function(h){return e.style.borderLeftColor=c.__color.toString(),h},c.updateDisplay),c.updateDisplay());c.setValue=Common.compose(function(h){return t.getRoot().__preset_select&&c.isModified()&&markPresetModified(t.getRoot(),!0),h},c.setValue)}function recallSavedValue(t,e){var c=t.getRoot(),u=c.__rememberedObjects.indexOf(e.object);if(u!==-1){var d=c.__rememberedObjectIndecesToControllers[u];if(d===void 0&&(d={},c.__rememberedObjectIndecesToControllers[u]=d),d[e.property]=e,c.load&&c.load.remembered){var h=c.load.remembered,m=void 0;if(h[t.preset])m=h[t.preset];else if(h[DEFAULT_DEFAULT_PRESET_NAME])m=h[DEFAULT_DEFAULT_PRESET_NAME];else return;if(m[u]&&m[u][e.property]!==void 0){var p=m[u][e.property];e.initialValue=p,e.setValue(p)}}}}function _add(t,e,c,u){if(e[c]===void 0)throw new Error('Object "'+e+'" has no property "'+c+'"');var d=void 0;if(u.color)d=new ColorController(e,c);else{var h=[e,c].concat(u.factoryArgs);d=ControllerFactory.apply(t,h)}u.before instanceof Controller&&(u.before=u.before.__li),recallSavedValue(t,d),dom.addClass(d.domElement,"c");var m=document.createElement("span");dom.addClass(m,"property-name"),m.innerHTML=d.property;var p=document.createElement("div");p.appendChild(m),p.appendChild(d.domElement);var y=addRow(t,p,u.before);return dom.addClass(y,GUI.CLASS_CONTROLLER_ROW),d instanceof ColorController?dom.addClass(y,"color"):dom.addClass(y,_typeof(d.getValue())),augmentController(t,y,d),t.__controllers.push(d),d}function getLocalStorageHash(t,e){return document.location.href+"."+e}function addPresetOption(t,e,c){var u=document.createElement("option");u.innerHTML=e,u.value=e,t.__preset_select.appendChild(u),c&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function showHideExplain(t,e){e.style.display=t.useLocalStorage?"block":"none"}function addSaveMenu(t){var e=t.__save_row=document.createElement("li");dom.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),dom.addClass(e,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;",dom.addClass(c,"button gears");var u=document.createElement("span");u.innerHTML="Save",dom.addClass(u,"button"),dom.addClass(u,"save");var d=document.createElement("span");d.innerHTML="New",dom.addClass(d,"button"),dom.addClass(d,"save-as");var h=document.createElement("span");h.innerHTML="Revert",dom.addClass(h,"button"),dom.addClass(h,"revert");var m=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?Common.each(t.load.remembered,function(L,K){addPresetOption(t,K,K===t.preset)}):addPresetOption(t,DEFAULT_DEFAULT_PRESET_NAME,!1),dom.bind(m,"change",function(){for(var L=0;L<t.__preset_select.length;L++)t.__preset_select[L].innerHTML=t.__preset_select[L].value;t.preset=this.value}),e.appendChild(m),e.appendChild(c),e.appendChild(u),e.appendChild(d),e.appendChild(h),SUPPORTS_LOCAL_STORAGE){var p=document.getElementById("dg-local-explain"),y=document.getElementById("dg-local-storage"),M=document.getElementById("dg-save-locally");M.style.display="block",localStorage.getItem(getLocalStorageHash(t,"isLocal"))==="true"&&y.setAttribute("checked","checked"),showHideExplain(t,p),dom.bind(y,"change",function(){t.useLocalStorage=!t.useLocalStorage,showHideExplain(t,p)})}var F=document.getElementById("dg-new-constructor");dom.bind(F,"keydown",function(L){L.metaKey&&(L.which===67||L.keyCode===67)&&SAVE_DIALOGUE.hide()}),dom.bind(c,"click",function(){F.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),SAVE_DIALOGUE.show(),F.focus(),F.select()}),dom.bind(u,"click",function(){t.save()}),dom.bind(d,"click",function(){var L=prompt("Enter a new preset name.");L&&t.saveAs(L)}),dom.bind(h,"click",function(){t.revert()})}function addResizeHandle(t){var e=void 0;t.__resize_handle=document.createElement("div"),Common.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function c(h){return h.preventDefault(),t.width+=e-h.clientX,t.onResize(),e=h.clientX,!1}function u(){dom.removeClass(t.__closeButton,GUI.CLASS_DRAG),dom.unbind(window,"mousemove",c),dom.unbind(window,"mouseup",u)}function d(h){return h.preventDefault(),e=h.clientX,dom.addClass(t.__closeButton,GUI.CLASS_DRAG),dom.bind(window,"mousemove",c),dom.bind(window,"mouseup",u),!1}dom.bind(t.__resize_handle,"mousedown",d),dom.bind(t.__closeButton,"mousedown",d),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function setWidth(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function getCurrentPreset(t,e){var c={};return Common.each(t.__rememberedObjects,function(u,d){var h={},m=t.__rememberedObjectIndecesToControllers[d];Common.each(m,function(p,y){h[y]=e?p.initialValue:p.getValue()}),c[d]=h}),c}function setPresetSelectIndex(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function updateDisplays(t){t.length!==0&&requestAnimationFrame$1$1.call(window,function(){updateDisplays(t)}),Common.each(t,function(e){e.updateDisplay()})}var GUI$1=GUI,canvas,canvasFormat,context,device,aspectRatio;const fovYDegrees=45;var modelBindGroupLayout,materialBindGroupLayout;async function initWebGPU(){canvas=document.getElementById("mainCanvas");const t=window.devicePixelRatio;if(canvas.width=canvas.clientWidth*t,canvas.height=canvas.clientHeight*t,aspectRatio=canvas.width/canvas.height,!navigator.gpu){let c=document.createElement("h1");throw c.textContent="This browser doesn't support WebGPU! Try using Google Chrome.",c.style.paddingLeft="0.4em",document.body.innerHTML="",document.body.appendChild(c),new Error("WebGPU not supported on this browser")}const e=await navigator.gpu.requestAdapter();if(!e)throw new Error("no appropriate GPUAdapter found");device=await e.requestDevice(),context=canvas.getContext("webgpu"),canvasFormat=navigator.gpu.getPreferredCanvasFormat(),context.configure({device,format:canvasFormat}),console.log("WebGPU init successsful"),modelBindGroupLayout=device.createBindGroupLayout({label:"model bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),materialBindGroupLayout=device.createBindGroupLayout({label:"material bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})}const vertexBufferLayout={arrayStride:32,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1},{format:"float32x2",offset:24,shaderLocation:2}]};class Renderer{scene;lights;camera;stats;prevTime=0;frameRequestId;constructor(e){this.scene=e.scene,this.lights=e.lights,this.camera=e.camera,this.stats=e.stats,this.frameRequestId=requestAnimationFrame(c=>this.onFrame(c))}stop(){cancelAnimationFrame(this.frameRequestId)}onFrame(e){this.prevTime==0&&(this.prevTime=e);let c=e-this.prevTime;this.camera.onFrame(c),this.lights.onFrame(e),this.stats.begin(),this.draw(),this.stats.end(),this.prevTime=e,this.frameRequestId=requestAnimationFrame(u=>this.onFrame(u))}}const commonRaw=`// CHECKITOUT: code that you add here will be prepended to all shaders

struct Light {
    pos: vec3f,
    color: vec3f
}

struct LightSet {
    numLights: u32,
    lights: array<Light>
}

// TODO-2: you may want to create a ClusterSet struct similar to LightSet
struct Cluster {
    minBounds: vec4<f32>,
    maxBounds: vec4<f32>,
    numLights: u32,
    indices: array<u32, \${maxLightsPerCluster}>
}

struct ClusterSet {
    numClusters: u32,
    clusters: array<Cluster>
}

struct CameraUniforms {
    // TODO-1.3: add an entry for the view proj mat (of type mat4x4f)
    viewProjMat: mat4x4<f32>,
    viewMat: mat4x4<f32>, 
    invProjMat: mat4x4<f32>, 
    invViewMat: mat4x4<f32>, 
    screenDim: vec2<f32>
}

// CHECKITOUT: this special attenuation function ensures lights don't affect geometry outside the maximum light radius
fn rangeAttenuation(distance: f32) -> f32 {
    return clamp(1.f - pow(distance / \${lightRadius}, 4.f), 0.f, 1.f) / (distance * distance);
}

fn calculateLightContrib(light: Light, posWorld: vec3f, nor: vec3f) -> vec3f {
    let vecToLight = light.pos - posWorld;
    let distToLight = length(vecToLight);

    let lambert = max(dot(nor, normalize(vecToLight)), 0.f);
    return light.color * lambert * rangeAttenuation(distToLight);
}
`,naiveVertRaw=`// CHECKITOUT: you can use this vertex shader for all of the renderers

// TODO-1.3: add a uniform variable here for camera uniforms (of type CameraUniforms)
// make sure to use \${bindGroup_scene} for the group
@group(\${bindGroup_scene}) @binding(0) var<uniform> camUniform: CameraUniforms;

@group(\${bindGroup_model}) @binding(0) var<uniform> modelMat: mat4x4f;

struct VertexInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

struct VertexOutput
{
    @builtin(position) fragPos: vec4f,
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

@vertex
fn main(in: VertexInput) -> VertexOutput
{
    let modelPos = modelMat * vec4(in.pos, 1);

    var out: VertexOutput;
    out.fragPos = camUniform.viewProjMat * modelPos; // TODO-1.3: replace ??? with the view proj mat from your CameraUniforms uniform variable
    out.pos = modelPos.xyz / modelPos.w;
    out.nor = in.nor;
    out.uv = in.uv;
    return out;
}
`,naiveFragRaw=`@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var totalLightContrib = vec3f(0, 0, 0);
    for (var lightIdx = 0u; lightIdx < lightSet.numLights; lightIdx++) {
        let light = lightSet.lights[lightIdx];
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));
    }

    var finalColor = diffuseColor.rgb * totalLightContrib;
    return vec4(finalColor, 1);
}
`,forwardPlusFragRaw=`// TODO-2: implement the Forward+ fragment shader

// See naive.fs.wgsl for basic fragment shader setup; this shader should use light clusters instead of looping over all lights

// ------------------------------------
// Shading process:
// ------------------------------------
// Determine which cluster contains the current fragment.
// Retrieve the number of lights that affect the current fragment from the clusters data.
// Initialize a variable to accumulate the total light contribution for the fragment.\\

// For each light in the cluster:
//     Access the light's properties using its index.
//     Calculate the contribution of the light based on its position, the fragments position, and the surface normal.
//     Add the calculated contribution to the total light accumulation.
// Multiply the fragments diffuse color by the accumulated light contribution.
// Return the final color, ensuring that the alpha component is set appropriately (typically to 1).
@group(\${bindGroup_scene}) @binding(0) var<uniform> camUniform: CameraUniforms;
@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;
@group(\${bindGroup_scene}) @binding(2) var<storage, read> clusterSet: ClusterSet;

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    const zNear : f32 = 0.1; 
    const zFar : f32 = 20.0;
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }
    let clusterDim: vec3<u32> = vec3<u32>(\${clusterDim[0]}, \${clusterDim[1]}, \${clusterDim[2]});
    let VSPos : vec4<f32> = camUniform.viewMat * vec4<f32>(in.pos, 1.0);
    let clusterZ : u32 = u32((log(abs(VSPos.z) / zNear) * f32(clusterDim.z)) / log(zFar / zNear));
    let CSPos : vec4<f32> = camUniform.viewProjMat * vec4<f32>(in.pos, 1.0);
    let NDCPos : vec3<f32> = (CSPos.xyz / CSPos.w) * 0.5 + 0.5;
    let clusterX : u32 = u32(NDCPos.x * f32(clusterDim.x));
    let clusterY : u32 = u32(NDCPos.y * f32(clusterDim.y));
    let clusterIdx : u32 = clusterX + clusterY * clusterDim.x + clusterZ * clusterDim.x * clusterDim.y;
    let cluster = &(clusterSet.clusters[clusterIdx]);

    var totalLightContrib = vec3f(0, 0, 0);
    let numLights : u32 = cluster.numLights;
    for (var lightIdx = 0u; lightIdx < numLights; lightIdx++) 
    {
        let clusterlightIdx = cluster.indices[lightIdx];
        let light = lightSet.lights[clusterlightIdx];
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));
    }

    var finalColor = diffuseColor.rgb * totalLightContrib;
    return vec4(finalColor, 1);
}
`,clusteredDeferredFragRaw=`// TODO-3: implement the Clustered Deferred G-buffer fragment shader

// This shader should only store G-buffer information and should not do any shading.
`,clusteredDeferredFullscreenVertRaw=`// TODO-3: implement the Clustered Deferred fullscreen vertex shader

// This shader should be very simple as it does not need all of the information passed by the the naive vertex shader.
`,clusteredDeferredFullscreenFragRaw=`// TODO-3: implement the Clustered Deferred fullscreen fragment shader

// Similar to the Forward+ fragment shader, but with vertex information coming from the G-buffer instead.
`,moveLightsComputeRaw=`@group(\${bindGroup_scene}) @binding(0) var<storage, read_write> lightSet: LightSet;
@group(\${bindGroup_scene}) @binding(1) var<uniform> time: f32;

// https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39
// MIT License.  Stefan Gustavson, Munrocket
fn permute4(x: vec4f) -> vec4f { return ((x * 34. + 1.) * x) % vec4f(289.); }
fn fade2(t: vec2f) -> vec2f { return t * t * t * (t * (t * 6. - 15.) + 10.); }

fn perlin(P: vec2f) -> f32 {
    var Pi: vec4f = floor(P.xyxy) + vec4f(0., 0., 1., 1.);
    let Pf = fract(P.xyxy) - vec4f(0., 0., 1., 1.);
    Pi = Pi % vec4f(289.); // To avoid truncation effects in permutation
    let ix = Pi.xzxz;
    let iy = Pi.yyww;
    let fx = Pf.xzxz;
    let fy = Pf.yyww;
    let i = permute4(permute4(ix) + iy);
    var gx: vec4f = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...
    let gy = abs(gx) - 0.5;
    let tx = floor(gx + 0.5);
    gx = gx - tx;
    var g00: vec2f = vec2f(gx.x, gy.x);
    var g10: vec2f = vec2f(gx.y, gy.y);
    var g01: vec2f = vec2f(gx.z, gy.z);
    var g11: vec2f = vec2f(gx.w, gy.w);
    let norm = 1.79284291400159 - 0.85373472095314 *
        vec4f(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
    g00 = g00 * norm.x;
    g01 = g01 * norm.y;
    g10 = g10 * norm.z;
    g11 = g11 * norm.w;
    let n00 = dot(g00, vec2f(fx.x, fy.x));
    let n10 = dot(g10, vec2f(fx.y, fy.y));
    let n01 = dot(g01, vec2f(fx.z, fy.z));
    let n11 = dot(g11, vec2f(fx.w, fy.w));
    let fade_xy = fade2(Pf.xy);
    let n_x = mix(vec2f(n00, n01), vec2f(n10, n11), vec2f(fade_xy.x));
    let n_xy = mix(n_x.x, n_x.y, fade_xy.y);
    return 2.3 * n_xy;
}

fn perlin3(lightIdx: u32, scaledTime: f32) -> vec3f {
    let seedPos = vec2f(f32(lightIdx) * 163.81f, scaledTime);
    return vec3f(perlin(seedPos), perlin(seedPos + 110.93), perlin(seedPos + 350.51));
}

const bboxMin = vec3f(-10, 0, -5);
const bboxMax = vec3f(10, 8, 5);

// CHECKITOUT: this is an example of a compute shader entry point function
@compute
@workgroup_size(\${moveLightsWorkgroupSize})
fn main(@builtin(global_invocation_id) globalIdx: vec3u) {
    let lightIdx = globalIdx.x;
    if (lightIdx >= lightSet.numLights) {
        return;
    }

    let scaledTime = time / 5000.f;

    let noise = perlin3(lightIdx, scaledTime);
    // perlin noise rarely reaches the extremes (-1 and 1), so scale accordingly here to ensure lights reach
    // the bounding box's sides
    let scaledNoise = (noise + 0.5) * 0.8;
    lightSet.lights[lightIdx].pos = mix(bboxMin, bboxMax, scaledNoise);
}
`,clusteringComputeRaw=`// TODO-2: implement the light clustering compute shader


// ------------------------------------
// Assigning lights to clusters:
// ------------------------------------
// For each cluster:
//     - Initialize a counter for the number of lights in this cluster.

//     For each light:
//         - Check if the light intersects with the clusters bounding box (AABB).
//         - If it does, add the light to the cluster's light list.
//         - Stop adding lights if the maximum number of lights is reached.

//     - Store the number of lights assigned to this cluster.


@group(\${bindGroup_scene}) @binding(0) var<storage, read> lightSet: LightSet;
@group(\${bindGroup_scene}) @binding(1) var<storage, read_write> clusterSet: ClusterSet;
@group(\${bindGroup_scene}) @binding(2) var<uniform> camUniform: CameraUniforms;

fn screenSpaceToViewSpace(screenCoord: vec2<f32>) -> vec3<f32> {
    let ndc: vec4<f32> = vec4<f32>((screenCoord / camUniform.screenDim) * 2.0 - 1.0, -1.0, 1.0);

    var viewCoord: vec4<f32> = camUniform.invProjMat * ndc;
    viewCoord /= viewCoord.w;
    return vec3<f32>(viewCoord.xyz);
}

fn intersectLightClusterAABB(lightPos: vec3<f32>, lightRadius: f32, clusterMin: vec3<f32>, clusterMax: vec3<f32>) -> bool {
    let sphereCenter : vec4<f32> = camUniform.viewMat * vec4<f32>(lightPos, 1.0);
    let closetPoint : vec3<f32> = clamp(sphereCenter.xyz, clusterMin, clusterMax);
    let distanceSqr : f32 = dot(closetPoint - sphereCenter.xyz, closetPoint - sphereCenter.xyz);
    return (distanceSqr <= lightRadius * lightRadius);
}

@compute
@workgroup_size(\${clusterWorkgroupSize})
fn main(@builtin(global_invocation_id) globalIdx: vec3u) {
    // ------------------------------------
    // Calculating cluster bounds:
    // ------------------------------------
    const zNear : f32 = 0.1; 
    const zFar : f32 = 20.0;
    let clusterDim: vec3<u32> = vec3<u32>(\${clusterDim[0]}, \${clusterDim[1]}, \${clusterDim[2]});
    let clusterIdx = globalIdx.x + globalIdx.y * clusterDim.x + globalIdx.z * clusterDim.x * clusterDim.y;
    if (globalIdx.x >= clusterDim.x || globalIdx.y >= clusterDim.y || globalIdx.z >= clusterDim.z) {
        return;
    }
    let currentCluster = &clusterSet.clusters[clusterIdx];
     
    //- Calculate the screen-space bounds for this cluster in 2D (XY).
    let clusterSize : vec2<f32> = camUniform.screenDim / vec2<f32>(clusterDim.xy);
    let clusterSSBoundsMin : vec2<f32> =  vec2<f32>(globalIdx.xy) * clusterSize;
    let clusterSSBoundsMax : vec2<f32> = (vec2<f32>(globalIdx.xy) + 1.0) * clusterSize;

    //- Calculate the depth bounds for this cluster in Z (near and far planes).
    // Using exponential division scheme
    let clusterDepthMin : f32 = zNear * pow(zFar / zNear, f32(globalIdx.z) / f32(clusterDim.z)); //near plane
    let clusterDepthMax : f32 = zNear * pow(zFar / zNear, f32(globalIdx.z + 1u) / f32(clusterDim.z)); //far plane

    //- Convert these screen and depth bounds into view-space coordinates.
    let clusterVSBoundsMin : vec3<f32> = screenSpaceToViewSpace(clusterSSBoundsMin); 
    let clusterVSBoundsMax : vec3<f32> = screenSpaceToViewSpace(clusterSSBoundsMax);
    
    let clusterMinOnNear : vec3<f32> = clusterDepthMin / (-clusterVSBoundsMin.z) * clusterVSBoundsMin;
    let clusterMaxOnNear : vec3<f32> = clusterDepthMin / (-clusterVSBoundsMax.z) * clusterVSBoundsMax;
    let clusterMinOnFar : vec3<f32> = clusterDepthMax / (-clusterVSBoundsMin.z) * clusterVSBoundsMin;
    let clusterMaxOnFar : vec3<f32> = clusterDepthMax / (-clusterVSBoundsMax.z) * clusterVSBoundsMax;

    let minPoint : vec4<f32> = vec4<f32>(min(clusterMinOnNear, clusterMinOnFar), 0.0);
    let maxPoint : vec4<f32> = vec4<f32>(max(clusterMaxOnNear, clusterMaxOnFar), 0.0);

    //- Store the computed bounding box (AABB) for the cluster.
    (*currentCluster).minBounds = minPoint;
    (*currentCluster).maxBounds = maxPoint;

    // ------------------------------------
    // Assigning lights to clusters:
    // ------------------------------------
    // For each cluster:
    //     - Initialize a counter for the number of lights in this cluster.
    var count : u32 = 0;
    let lightSetPtr = &(lightSet);
    //     For each light:
    for (var i : u32 = 0; i < (*lightSetPtr).numLights; i++)
    {
        let currentLight = (*lightSetPtr).lights[i];
        //         - Check if the light intersects with the clusters bounding box (AABB).
        if (intersectLightClusterAABB(currentLight.pos, f32(\${lightRadius}), minPoint.xyz, maxPoint.xyz))
        {
            //         - If it does, add the light to the cluster's light list.
            (*currentCluster).indices[count] = i;
            count++;
        }
        //         - Stop adding lights if the maximum number of lights is reached.
        if (count == \${maxLightsPerCluster})
        {
            break;
        }
    }
    //     - Store the number of lights assigned to this cluster.
    (*currentCluster).numLights = count;
}`,constants={bindGroup_scene:0,bindGroup_model:1,bindGroup_material:2,moveLightsWorkgroupSize:128,clusterWorkgroupSize:[4,4,4],clusterDim:[16,9,24],lightRadius:2,maxLightsPerCluster:500};function evalShaderRaw(raw){return eval("`"+raw.replaceAll("${","${constants.")+"`")}const commonSrc=evalShaderRaw(commonRaw);function processShaderRaw(t){return commonSrc+evalShaderRaw(t)}const naiveVertSrc=processShaderRaw(naiveVertRaw),naiveFragSrc=processShaderRaw(naiveFragRaw),forwardPlusFragSrc=processShaderRaw(forwardPlusFragRaw);processShaderRaw(clusteredDeferredFragRaw);processShaderRaw(clusteredDeferredFullscreenVertRaw);processShaderRaw(clusteredDeferredFullscreenFragRaw);const moveLightsComputeSrc=processShaderRaw(moveLightsComputeRaw),clusteringComputeSrc=processShaderRaw(clusteringComputeRaw);class NaiveRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"naive pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"naive vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"naive frag shader",code:naiveFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder(),c=context.getCurrentTexture().createView(),u=e.beginRenderPass({label:"naive render pass",colorAttachments:[{view:c,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});u.setPipeline(this.pipeline),u.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(d=>{u.setBindGroup(constants.bindGroup_model,d.modelBindGroup)},d=>{u.setBindGroup(constants.bindGroup_material,d.materialBindGroup)},d=>{u.setVertexBuffer(0,d.vertexBuffer),u.setIndexBuffer(d.indexBuffer,"uint32"),u.drawIndexed(d.numIndices)}),u.end(),device.queue.submit([e.finish()])}}class ForwardPlusRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}},{binding:2,resource:{buffer:this.lights.clusterSetBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"forward plus pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"forward plus vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"forward plus frag shader",code:forwardPlusFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder(),c=context.getCurrentTexture().createView();this.lights.doLightClustering(e);const u=e.beginRenderPass({label:"foward plus render pass",colorAttachments:[{view:c,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});u.setPipeline(this.pipeline),u.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(d=>{u.setBindGroup(constants.bindGroup_model,d.modelBindGroup)},d=>{u.setBindGroup(constants.bindGroup_material,d.materialBindGroup)},d=>{u.setVertexBuffer(0,d.vertexBuffer),u.setIndexBuffer(d.indexBuffer,"uint32"),u.drawIndexed(d.numIndices)}),u.end(),device.queue.submit([e.finish()])}}class ClusteredDeferredRenderer extends Renderer{constructor(e){super(e)}draw(){}}async function parseFromContext(t,e,c,u){return u._parse(t,e,c,u)}function assert$5(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const isBrowser$3=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),matches$2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches$2&&parseFloat(matches$2[1]);const window_=globalThis,process_=globalThis.process||{};function isElectron(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const c=typeof navigator<"u"&&navigator.userAgent;return!!(c&&c.indexOf("Electron")>=0)}function isBrowser$2(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||isElectron()}const VERSION$6="4.0.7";function getStorage(t){try{const e=window[t],c="__storage_test__";return e.setItem(c,c),e.removeItem(c),e}catch{return null}}class LocalStorage{constructor(e,c,u="sessionStorage"){this.storage=getStorage(u),this.id=e,this.config=c,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const c=JSON.stringify(this.config);this.storage.setItem(this.id,c)}}_loadConfiguration(){let e={};if(this.storage){const c=this.storage.getItem(this.id);e=c?JSON.parse(c):{}}return Object.assign(this.config,e),this}}function formatTime(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function leftPad(t,e=8){const c=Math.max(e-t.length,0);return`${" ".repeat(c)}${t}`}var COLOR;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(COLOR||(COLOR={}));const BACKGROUND_INCREMENT=10;function getColor(t){return typeof t!="string"?t:(t=t.toUpperCase(),COLOR[t]||COLOR.WHITE)}function addColor(t,e,c){return!isBrowser$2&&typeof t=="string"&&(e&&(t=`\x1B[${getColor(e)}m${t}\x1B[39m`),c&&(t=`\x1B[${getColor(c)+BACKGROUND_INCREMENT}m${t}\x1B[49m`)),t}function autobind(t,e=["constructor"]){const c=Object.getPrototypeOf(t),u=Object.getOwnPropertyNames(c),d=t;for(const h of u){const m=d[h];typeof m=="function"&&(e.find(p=>h===p)||(d[h]=m.bind(t)))}}function assert$4(t,e){if(!t)throw new Error("Assertion failed")}function getHiResTimestamp(){let t;if(isBrowser$2()&&window_.performance)t=window_?.performance?.now?.();else if("hrtime"in process_){const e=process_?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const originalConsole={debug:isBrowser$2()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_LOG_CONFIGURATION={enabled:!0,level:0};function noop(){}const cache$6={},ONCE={once:!0};class Log{constructor({id:e}={id:""}){this.VERSION=VERSION$6,this._startTs=getHiResTimestamp(),this._deltaTs=getHiResTimestamp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new LocalStorage(`__probe-${this.id}__`,DEFAULT_LOG_CONFIGURATION),this.timeStamp(`${this.id} started`),autobind(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,c){this._storage.setConfiguration({[e]:c})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,c){if(!e)throw new Error(c||"Assertion failed")}warn(e){return this._getLogFunction(0,e,originalConsole.warn,arguments,ONCE)}error(e){return this._getLogFunction(0,e,originalConsole.error,arguments)}deprecated(e,c){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${c}\` instead`)}removed(e,c){return this.error(`\`${e}\` has been removed. Use \`${c}\` instead`)}probe(e,c){return this._getLogFunction(e,c,originalConsole.log,arguments,{time:!0,once:!0})}log(e,c){return this._getLogFunction(e,c,originalConsole.debug,arguments)}info(e,c){return this._getLogFunction(e,c,console.info,arguments)}once(e,c){return this._getLogFunction(e,c,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(e,c,u){return c?this._getLogFunction(e,c,console.table||noop,u&&[u],{tag:getTableHeader(c)}):noop}time(e,c){return this._getLogFunction(e,c,console.time?console.time:console.info)}timeEnd(e,c){return this._getLogFunction(e,c,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,c){return this._getLogFunction(e,c,console.timeStamp||noop)}group(e,c,u={collapsed:!1}){const d=normalizeArguments({logLevel:e,message:c,opts:u}),{collapsed:h}=u;return d.method=(h?console.groupCollapsed:console.group)||console.info,this._getLogFunction(d)}groupCollapsed(e,c,u={}){return this.group(e,c,Object.assign({},u,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||noop)}withGroup(e,c,u){this.group(e,c)();try{u()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(e)}_getLogFunction(e,c,u,d,h){if(this._shouldLog(e)){h=normalizeArguments({logLevel:e,message:c,args:d,opts:h}),u=u||h.method,assert$4(u),h.total=this.getTotal(),h.delta=this.getDelta(),this._deltaTs=getHiResTimestamp();const m=h.tag||h.message;if(h.once&&m)if(!cache$6[m])cache$6[m]=getHiResTimestamp();else return noop;return c=decorateMessage(this.id,h.message,h),u.bind(console,c,...h.args)}return noop}}Log.VERSION=VERSION$6;function normalizeLogLevel(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return assert$4(Number.isFinite(e)&&e>=0),e}function normalizeArguments(t){const{logLevel:e,message:c}=t;t.logLevel=normalizeLogLevel(e);const u=t.args?Array.from(t.args):[];for(;u.length&&u.shift()!==c;);switch(typeof e){case"string":case"function":c!==void 0&&u.unshift(c),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const d=typeof t.message;return assert$4(d==="string"||d==="object"),Object.assign(t,{args:u},t.opts)}function decorateMessage(t,e,c){if(typeof e=="string"){const u=c.time?leftPad(formatTime(c.total)):"";e=c.time?`${t}: ${u}  ${e}`:`${t}: ${e}`,e=addColor(e,c.color,c.background)}return e}function getTableHeader(t){for(const e in t)for(const c in t[e])return c||"untitled";return"empty"}function mergeLoaderOptions(t,e){return mergeOptionsRecursively(t||{},e)}function mergeOptionsRecursively(t,e,c=0){if(c>3)return e;const u={...t};for(const[d,h]of Object.entries(e))h&&typeof h=="object"&&!Array.isArray(h)?u[d]=mergeOptionsRecursively(u[d]||{},e[d],c+1):u[d]=e[d];return u}function registerJSModules(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function getJSModuleOrNull(t){return globalThis.loaders?.modules?.[t]||null}const NPM_TAG="latest";function getVersion(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.1"),globalThis._loadersgl_.version}const VERSION$5=getVersion();function assert$3(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const isBrowser$1=typeof process!="object"||String(process)!=="[object process]"||process.browser,isWorker=typeof importScripts=="function",isMobile=typeof window<"u"&&typeof window.orientation<"u",matches$1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches$1&&parseFloat(matches$1[1]);class WorkerJob{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,c){this.name=e,this.workerThread=c,this.result=new Promise((u,d)=>{this._resolve=u,this._reject=d})}postMessage(e,c){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:c})}done(e){assert$3(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){assert$3(this.isRunning),this.isRunning=!1,this._reject(e)}}class NodeWorker{terminate(){}}const workerURLCache=new Map;function getLoadableWorkerURL(t){assert$3(t.source&&!t.url||!t.source&&t.url);let e=workerURLCache.get(t.source||t.url);return e||(t.url&&(e=getLoadableWorkerURLFromURL(t.url),workerURLCache.set(t.url,e)),t.source&&(e=getLoadableWorkerURLFromSource(t.source),workerURLCache.set(t.source,e))),assert$3(e),e}function getLoadableWorkerURLFromURL(t){if(!t.startsWith("http"))return t;const e=buildScriptSource(t);return getLoadableWorkerURLFromSource(e)}function getLoadableWorkerURLFromSource(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function buildScriptSource(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function getTransferList(t,e=!0,c){const u=c||new Set;if(t){if(isTransferable(t))u.add(t);else if(isTransferable(t.buffer))u.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const d in t)getTransferList(t[d],e,u)}}return c===void 0?Array.from(u):[]}function isTransferable(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const NOOP=()=>{};class WorkerThread{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&isBrowser$1||typeof NodeWorker<"u"&&!isBrowser$1}constructor(e){const{name:c,source:u,url:d}=e;assert$3(u||d),this.name=c,this.source=u,this.url=d,this.onMessage=NOOP,this.onError=h=>console.log(h),this.worker=isBrowser$1?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=NOOP,this.onError=NOOP,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,c){c=c||getTransferList(e),this.worker.postMessage(e,c)}_getErrorFromErrorEvent(e){let c="Failed to load ";return c+=`worker ${this.name} from ${this.url}. `,e.message&&(c+=`${e.message} in `),e.lineno&&(c+=`:${e.lineno}:${e.colno}`),new Error(c)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=c=>{c.data?this.onMessage(c.data):this.onError(new Error("No data received"))},e.onerror=c=>{this.onError(this._getErrorFromErrorEvent(c)),this.terminated=!0},e.onmessageerror=c=>console.error(c),e}_createNodeWorker(){let e;if(this.url){const u=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new NodeWorker(u,{eval:!1})}else if(this.source)e=new NodeWorker(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",c=>{this.onMessage(c)}),e.on("error",c=>{this.onError(c)}),e.on("exit",c=>{}),e}}class WorkerPool{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return WorkerThread.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,c=(d,h,m)=>d.done(m),u=(d,h)=>d.error(h)){const d=new Promise(h=>(this.jobQueue.push({name:e,onMessage:c,onError:u,onStart:h}),this));return this._startQueuedJob(),await d}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const c=this.jobQueue.shift();if(c){this.onDebug({message:"Starting job",name:c.name,workerThread:e,backlog:this.jobQueue.length});const u=new WorkerJob(c.name,e);e.onMessage=d=>c.onMessage(u,d.type,d.payload),e.onError=d=>c.onError(u,d),c.onStart(u);try{await u.result}catch(d){console.error(`Worker exception: ${d}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!isBrowser$1||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class WorkerFarm{props;workerPools=new Map;static _workerFarm;static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){this.props={...DEFAULT_PROPS},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const c of this.workerPools.values())c.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:c,source:u,url:d}=e;let h=this.workerPools.get(c);return h||(h=new WorkerPool({name:c,source:u,url:d}),h.setProps(this._getWorkerPoolProps()),this.workerPools.set(c,h)),h}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function getWorkerURL(t,e={}){const c=e[t.id]||{},u=isBrowser$1?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let d=c.workerUrl;if(!d&&t.id==="compression"&&(d=e.workerUrl),e._workerType==="test"&&(isBrowser$1?d=`modules/${t.module}/dist/${u}`:d=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!d){let h=t.version;h==="latest"&&(h=NPM_TAG);const m=h?`@${h}`:"";d=`https://unpkg.com/@loaders.gl/${t.module}${m}/dist/${u}`}return assert$3(d),d}function validateWorkerVersion(t,e=VERSION$5){assert$3(t,"no worker provided");const c=t.version;return!(!e||!c)}const loadLibraryPromises={};async function loadLibrary(t,e=null,c={},u=null){return e&&(t=getLibraryUrl(t,e,c,u)),loadLibraryPromises[t]=loadLibraryPromises[t]||loadLibraryFromFile(t),await loadLibraryPromises[t]}function getLibraryUrl(t,e,c={},u=null){if(!c.useLocalLibraries&&t.startsWith("http"))return t;u=u||t;const d=c.modules||{};return d[u]?d[u]:isBrowser$1?c.CDN?(assert$3(c.CDN.startsWith("http")),`${c.CDN}/${e}@${VERSION$5}/dist/libs/${u}`):isWorker?`../src/libs/${u}`:`modules/${e}/src/libs/${u}`:`modules/${e}/dist/libs/${u}`}async function loadLibraryFromFile(t){if(t.endsWith("wasm"))return await loadAsArrayBuffer(t);if(!isBrowser$1)try{const{requireFromFile:c}=globalThis.loaders||{};return await c?.(t)}catch(c){return console.error(c),null}if(isWorker)return importScripts(t);const e=await loadAsText(t);return loadLibraryFromString(e,t)}function loadLibraryFromString(t,e){if(!isBrowser$1){const{requireFromString:u}=globalThis.loaders||{};return u?.(t,e)}if(isWorker)return eval.call(globalThis,t),null;const c=document.createElement("script");c.id=e;try{c.appendChild(document.createTextNode(t))}catch{c.text=t}return document.body.appendChild(c),null}async function loadAsArrayBuffer(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return isBrowser$1||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function loadAsText(t){const{readFileAsText:e}=globalThis.loaders||{};return isBrowser$1||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function canParseWithWorker(t,e){return!WorkerFarm.isSupported()||!isBrowser$1&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function parseWithWorker(t,e,c,u,d){const h=t.id,m=getWorkerURL(t,c),y=WorkerFarm.getWorkerFarm(c).getWorkerPool({name:h,url:m});c=JSON.parse(JSON.stringify(c)),u=JSON.parse(JSON.stringify(u||{}));const M=await y.startJob("process-on-worker",onMessage.bind(null,d));return M.postMessage("process",{input:e,options:c,context:u}),await(await M.result).result}async function onMessage(t,e,c,u){switch(c){case"done":e.done(u);break;case"error":e.error(new Error(u.error));break;case"process":const{id:d,input:h,options:m}=u;try{const p=await t(h,m);e.postMessage("done",{id:d,result:p})}catch(p){const y=p instanceof Error?p.message:"unknown error";e.postMessage("error",{id:d,error:y})}break;default:console.warn(`parse-with-worker unknown message ${c}`)}}function getFirstCharacters$1(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?getMagicString$2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?getMagicString$2(t,0,e):""}function getMagicString$2(t,e,c){if(t.byteLength<=e+c)return"";const u=new DataView(t);let d="";for(let h=0;h<c;h++)d+=String.fromCharCode(u.getUint8(e+h));return d}function parseJSON(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${getFirstCharacters$1(t)}"`)}}function compareArrayBuffers(t,e,c){if(c=c||t.byteLength,t.byteLength<c||e.byteLength<c)return!1;const u=new Uint8Array(t),d=new Uint8Array(e);for(let h=0;h<u.length;++h)if(u[h]!==d[h])return!1;return!0}function concatenateArrayBuffers(...t){return concatenateArrayBuffersFromArray(t)}function concatenateArrayBuffersFromArray(t){const e=t.map(h=>h instanceof ArrayBuffer?new Uint8Array(h):h),c=e.reduce((h,m)=>h+m.byteLength,0),u=new Uint8Array(c);let d=0;for(const h of e)u.set(h,d),d+=h.byteLength;return u.buffer}function sliceArrayBuffer(t,e,c){const u=c!==void 0?new Uint8Array(t).subarray(e,e+c):new Uint8Array(t).subarray(e);return new Uint8Array(u).buffer}function padToNBytes(t,e){return assert$5(t>=0),assert$5(e>0),t+(e-1)&~(e-1)}function copyToArray(t,e,c){let u;if(t instanceof ArrayBuffer)u=new Uint8Array(t);else{const d=t.byteOffset,h=t.byteLength;u=new Uint8Array(t.buffer||t.arrayBuffer,d,h)}return e.set(u,c),c+padToNBytes(u.byteLength,4)}async function concatenateArrayBuffersAsync(t){const e=[];for await(const c of t)e.push(c);return concatenateArrayBuffers(...e)}let pathPrefix="";const fileAliases={};function resolvePath(t){for(const e in fileAliases)if(t.startsWith(e)){const c=fileAliases[e];t=t.replace(e,c)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${pathPrefix}${t}`),t}function toArrayBuffer$1(t){return t}function isBuffer$1(t){return t&&typeof t=="object"&&t.isBuffer}function toArrayBuffer(t){if(isBuffer$1(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function filename(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function dirname(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const isBoolean=t=>typeof t=="boolean",isFunction=t=>typeof t=="function",isObject=t=>t!==null&&typeof t=="object",isPureObject=t=>isObject(t)&&t.constructor==={}.constructor,isIterable=t=>!!t&&typeof t[Symbol.iterator]=="function",isAsyncIterable=t=>t&&typeof t[Symbol.asyncIterator]=="function",isResponse=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,isBlob=t=>typeof Blob<"u"&&t instanceof Blob,isBuffer=t=>t&&typeof t=="object"&&t.isBuffer,isReadableDOMStream=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||isObject(t)&&isFunction(t.tee)&&isFunction(t.cancel)&&isFunction(t.getReader),isReadableNodeStream=t=>isObject(t)&&isFunction(t.read)&&isFunction(t.pipe)&&isBoolean(t.readable),isReadableStream=t=>isReadableDOMStream(t)||isReadableNodeStream(t);class FetchError extends Error{constructor(e,c){super(e),this.reason=c.reason,this.url=c.url,this.response=c.response}reason;url;response}const DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function compareMIMETypes(t,e){return t.toLowerCase()===e.toLowerCase()}function parseMIMEType(t){const e=MIME_TYPE_PATTERN.exec(t);return e?e[1]:t}function parseMIMETypeFromURL(t){const e=DATA_URL_PATTERN.exec(t);return e?e[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function extractQueryString(t){const e=t.match(QUERY_STRING_PATTERN);return e&&e[0]}function stripQueryString(t){return t.replace(QUERY_STRING_PATTERN,"")}function shortenUrlForDisplay(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function getResourceUrl(t){return isResponse(t)?t.url:isBlob(t)?t.name||"":typeof t=="string"?t:""}function getResourceMIMEType(t){if(isResponse(t)){const e=t,c=e.headers.get("content-type")||"",u=stripQueryString(e.url);return parseMIMEType(c)||parseMIMETypeFromURL(u)}return isBlob(t)?t.type||"":typeof t=="string"?parseMIMETypeFromURL(t):""}function getResourceContentLength(t){return isResponse(t)?t.headers["content-length"]||-1:isBlob(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function makeResponse(t){if(isResponse(t))return t;const e={},c=getResourceContentLength(t);c>=0&&(e["content-length"]=String(c));const u=getResourceUrl(t),d=getResourceMIMEType(t);d&&(e["content-type"]=d);const h=await getInitialDataUrl(t);h&&(e["x-first-bytes"]=h),typeof t=="string"&&(t=new TextEncoder().encode(t));const m=new Response(t,{headers:e});return Object.defineProperty(m,"url",{value:u}),m}async function checkResponse(t){if(!t.ok)throw await getResponseError(t)}async function getResponseError(t){const e=shortenUrlForDisplay(t.url);let c=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;c=c.length>100?`${c.slice(0,100)}...`:c;const u={reason:t.statusText,url:t.url,response:t};try{const d=t.headers.get("Content-Type");u.reason=d?.includes("application/json")?await t.json():t.text()}catch{}return new FetchError(c,u)}async function getInitialDataUrl(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const c=t.slice(0,5);return await new Promise(u=>{const d=new FileReader;d.onload=h=>u(h?.target?.result),d.readAsDataURL(c)})}if(t instanceof ArrayBuffer){const c=t.slice(0,5);return`data:base64,${arrayBufferToBase64(c)}`}return null}function arrayBufferToBase64(t){let e="";const c=new Uint8Array(t);for(let u=0;u<c.byteLength;u++)e+=String.fromCharCode(c[u]);return btoa(e)}function isNodePath(t){return!isRequestURL(t)&&!isDataURL(t)}function isRequestURL(t){return t.startsWith("http:")||t.startsWith("https:")}function isDataURL(t){return t.startsWith("data:")}async function fetchFile(t,e){if(typeof t=="string"){const c=resolvePath(t);return isNodePath(c)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(c,e):await fetch(c,e)}return await makeResponse(t)}const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:isBrowser$3,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function getGlobalLoaderOptions(){const t=getGlobalLoaderState();return t.globalOptions=t.globalOptions||{...DEFAULT_LOADER_OPTIONS},t.globalOptions}function normalizeOptions(t,e,c,u){return c=c||[],c=Array.isArray(c)?c:[c],validateOptions(t,c),normalizeOptionsInternal(e,t,u)}function validateOptions(t,e){validateOptionsObject(t,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,e);for(const c of e){const u=t&&t[c.id]||{},d=c.options&&c.options[c.id]||{},h=c.deprecatedOptions&&c.deprecatedOptions[c.id]||{};validateOptionsObject(u,c.id,d,h,e)}}function validateOptionsObject(t,e,c,u,d){const h=e||"Top level",m=e?`${e}.`:"";for(const p in t){const y=!e&&isObject(t[p]),M=p==="baseUri"&&!e,F=p==="workerUrl"&&e;if(!(p in c)&&!M&&!F){if(p in u)probeLog.warn(`${h} loader option '${m}${p}' no longer supported, use '${u[p]}'`)();else if(!y){const L=findSimilarOption(p,d);probeLog.warn(`${h} loader option '${m}${p}' not recognized. ${L}`)()}}}}function findSimilarOption(t,e){const c=t.toLowerCase();let u="";for(const d of e)for(const h in d.options){if(t===h)return`Did you mean '${d.id}.${h}'?`;const m=h.toLowerCase();(c.startsWith(m)||m.startsWith(c))&&(u=u||`Did you mean '${d.id}.${h}'?`)}return u}function normalizeOptionsInternal(t,e,c){const d={...t.options||{}};return addUrlOptions(d,c),d.log===null&&(d.log=new NullLog),mergeNestedFields(d,getGlobalLoaderOptions()),mergeNestedFields(d,e),d}function mergeNestedFields(t,e){for(const c in e)if(c in e){const u=e[c];isPureObject(u)&&isPureObject(t[c])?t[c]={...t[c],...e[c]}:t[c]=e[c]}}function addUrlOptions(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function isLoaderObject(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function normalizeLoader(t){assert$5(t,"null loader"),assert$5(isLoaderObject(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const getGlobalLoaderRegistry=()=>{const t=getGlobalLoaderState();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function registerLoaders(t){const e=getGlobalLoaderRegistry();t=Array.isArray(t)?t:[t];for(const c of t){const u=normalizeLoader(c);e.find(d=>u===d)||e.unshift(u)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const log=new Log({id:"loaders.gl"}),EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(t,e=[],c,u){if(!validHTTPResponse(t))return null;let d=selectLoaderSync(t,e,{...c,nothrow:!0},u);if(d)return d;if(isBlob(t)&&(t=await t.slice(0,10).arrayBuffer(),d=selectLoaderSync(t,e,c,u)),!d&&!c?.nothrow)throw new Error(getNoValidLoaderMessage(t));return d}function selectLoaderSync(t,e=[],c,u){if(!validHTTPResponse(t))return null;if(e&&!Array.isArray(e))return normalizeLoader(e);let d=[];e&&(d=d.concat(e)),c?.ignoreRegisteredLoaders||d.push(...getRegisteredLoaders()),normalizeLoaders(d);const h=selectLoaderInternal(t,d,c,u);if(!h&&!c?.nothrow)throw new Error(getNoValidLoaderMessage(t));return h}function selectLoaderInternal(t,e,c,u){const d=getResourceUrl(t),h=getResourceMIMEType(t),m=stripQueryString(d)||u?.url;let p=null,y="";return c?.mimeType&&(p=findLoaderByMIMEType(e,c?.mimeType),y=`match forced by supplied MIME type ${c?.mimeType}`),p=p||findLoaderByUrl(e,m),y=y||(p?`matched url ${m}`:""),p=p||findLoaderByMIMEType(e,h),y=y||(p?`matched MIME type ${h}`:""),p=p||findLoaderByInitialBytes(e,t),y=y||(p?`matched initial data ${getFirstCharacters(t)}`:""),c?.fallbackMimeType&&(p=p||findLoaderByMIMEType(e,c?.fallbackMimeType),y=y||(p?`matched fallback MIME type ${h}`:"")),y&&log.log(1,`selectLoader selected ${p?.name}: ${y}.`),p}function validHTTPResponse(t){return!(t instanceof Response&&t.status===204)}function getNoValidLoaderMessage(t){const e=getResourceUrl(t),c=getResourceMIMEType(t);let u="No valid loader found (";u+=e?`${filename(e)}, `:"no url provided, ",u+=`MIME type: ${c?`"${c}"`:"not provided"}, `;const d=t?getFirstCharacters(t):"";return u+=d?` first bytes: "${d}"`:"first bytes: not available",u+=")",u}function normalizeLoaders(t){for(const e of t)normalizeLoader(e)}function findLoaderByUrl(t,e){const c=e&&EXT_PATTERN.exec(e),u=c&&c[1];return u?findLoaderByExtension(t,u):null}function findLoaderByExtension(t,e){e=e.toLowerCase();for(const c of t)for(const u of c.extensions)if(u.toLowerCase()===e)return c;return null}function findLoaderByMIMEType(t,e){for(const c of t)if(c.mimeTypes?.some(u=>compareMIMETypes(e,u))||compareMIMETypes(e,`application/x.${c.id}`))return c;return null}function findLoaderByInitialBytes(t,e){if(!e)return null;for(const c of t)if(typeof e=="string"){if(testDataAgainstText(e,c))return c}else if(ArrayBuffer.isView(e)){if(testDataAgainstBinary(e.buffer,e.byteOffset,c))return c}else if(e instanceof ArrayBuffer&&testDataAgainstBinary(e,0,c))return c;return null}function testDataAgainstText(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(u=>t.startsWith(u))}function testDataAgainstBinary(t,e,c){return(Array.isArray(c.tests)?c.tests:[c.tests]).some(d=>testBinary(t,e,c,d))}function testBinary(t,e,c,u){if(u instanceof ArrayBuffer)return compareArrayBuffers(u,t,u.byteLength);switch(typeof u){case"function":return u(t);case"string":const d=getMagicString$1(t,e,u.length);return u===d;default:return!1}}function getFirstCharacters(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?getMagicString$1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?getMagicString$1(t,0,e):""}function getMagicString$1(t,e,c){if(t.byteLength<e+c)return"";const u=new DataView(t);let d="";for(let h=0;h<c;h++)d+=String.fromCharCode(u.getUint8(e+h));return d}const DEFAULT_CHUNK_SIZE$2=256*1024;function*makeStringIterator(t,e){const c=e?.chunkSize||DEFAULT_CHUNK_SIZE$2;let u=0;const d=new TextEncoder;for(;u<t.length;){const h=Math.min(t.length-u,c),m=t.slice(u,u+h);u+=h,yield d.encode(m)}}const DEFAULT_CHUNK_SIZE$1=256*1024;function*makeArrayBufferIterator(t,e={}){const{chunkSize:c=DEFAULT_CHUNK_SIZE$1}=e;let u=0;for(;u<t.byteLength;){const d=Math.min(t.byteLength-u,c),h=new ArrayBuffer(d),m=new Uint8Array(t,u,d);new Uint8Array(h).set(m),u+=d,yield h}}const DEFAULT_CHUNK_SIZE=1024*1024;async function*makeBlobIterator(t,e){const c=e?.chunkSize||DEFAULT_CHUNK_SIZE;let u=0;for(;u<t.size;){const d=u+c,h=await t.slice(u,d).arrayBuffer();u=d,yield h}}function makeStreamIterator(t,e){return isBrowser$3?makeBrowserStreamIterator(t,e):makeNodeStreamIterator(t)}async function*makeBrowserStreamIterator(t,e){const c=t.getReader();let u;try{for(;;){const d=u||c.read();e?._streamReadAhead&&(u=c.read());const{done:h,value:m}=await d;if(h)return;yield toArrayBuffer(m)}}catch{c.releaseLock()}}async function*makeNodeStreamIterator(t,e){for await(const c of t)yield toArrayBuffer(c)}function makeIterator(t,e){if(typeof t=="string")return makeStringIterator(t,e);if(t instanceof ArrayBuffer)return makeArrayBufferIterator(t,e);if(isBlob(t))return makeBlobIterator(t,e);if(isReadableStream(t))return makeStreamIterator(t,e);if(isResponse(t))return makeStreamIterator(t.body,e);throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(t,e,c){if(e.text&&typeof t=="string")return t;if(isBuffer(t)&&(t=t.buffer),t instanceof ArrayBuffer){const u=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(u):u}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let u=t.buffer;const d=t.byteLength||t.length;return(t.byteOffset!==0||d!==u.byteLength)&&(u=u.slice(t.byteOffset,t.byteOffset+d)),u}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(t,e,c){const u=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||u)return getArrayBufferOrStringFromDataSync(t,e);if(isBlob(t)&&(t=await makeResponse(t)),isResponse(t)){const d=t;return await checkResponse(d),e.binary?await d.arrayBuffer():await d.text()}if(isReadableStream(t)&&(t=makeIterator(t,c)),isIterable(t)||isAsyncIterable(t))return concatenateArrayBuffersAsync(t);throw new Error(ERR_DATA)}function getFetchFunction(t,e){const c=getGlobalLoaderOptions(),u=t||c;return typeof u.fetch=="function"?u.fetch:isObject(u.fetch)?d=>fetchFile(d,u.fetch):e?.fetch?e?.fetch:fetchFile}function getLoaderContext(t,e,c){if(c)return c;const u={fetch:getFetchFunction(e,t),...t};if(u.url){const d=stripQueryString(u.url);u.baseUrl=d,u.queryString=extractQueryString(u.url),u.filename=filename(d),u.baseUrl=dirname(d)}return Array.isArray(u.loaders)||(u.loaders=null),u}function getLoadersFromContext(t,e){if(t&&!Array.isArray(t))return t;let c;if(t&&(c=Array.isArray(t)?t:[t]),e&&e.loaders){const u=Array.isArray(e.loaders)?e.loaders:[e.loaders];c=c?[...c,...u]:u}return c&&c.length?c:void 0}async function parse$2(t,e,c,u){e&&!Array.isArray(e)&&!isLoaderObject(e)&&(u=void 0,c=e,e=void 0),t=await t,c=c||{};const d=getResourceUrl(t),m=getLoadersFromContext(e,u),p=await selectLoader(t,m,c);return p?(c=normalizeOptions(c,p,m,d),u=getLoaderContext({url:d,_parse:parse$2,loaders:m},c,u||null),await parseWithLoader(p,t,c,u)):null}async function parseWithLoader(t,e,c,u){if(validateWorkerVersion(t),c=mergeLoaderOptions(t.options,c),isResponse(e)){const h=e,{ok:m,redirected:p,status:y,statusText:M,type:F,url:L}=h,K=Object.fromEntries(h.headers.entries());u.response={headers:K,ok:m,redirected:p,status:y,statusText:M,type:F,url:L}}e=await getArrayBufferOrStringFromData(e,t,c);const d=t;if(d.parseTextSync&&typeof e=="string")return d.parseTextSync(e,c,u);if(canParseWithWorker(t,c))return await parseWithWorker(t,e,c,u,parse$2);if(d.parseText&&typeof e=="string")return await d.parseText(e,c,u);if(d.parse)return await d.parse(e,c,u);throw assert$3(!d.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function getDataTypeFromTypedArray(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function getMeshBoundingBox(t){let e=1/0,c=1/0,u=1/0,d=-1/0,h=-1/0,m=-1/0;const p=t.POSITION?t.POSITION.value:[],y=p&&p.length;for(let M=0;M<y;M+=3){const F=p[M],L=p[M+1],K=p[M+2];e=F<e?F:e,c=L<c?L:c,u=K<u?K:u,d=F>d?F:d,h=L>h?L:h,m=K>m?K:m}return[[e,c,u],[d,h,m]]}function deduceMeshField(t,e,c){const u=getDataTypeFromTypedArray(e.value),d=c||makeMeshAttributeMetadata(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:u}]},nullable:!1,metadata:d}}function makeMeshAttributeMetadata(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function load(t,e,c,u){let d,h;!Array.isArray(e)&&!isLoaderObject(e)?(d=[],h=e):(d=e,h=c);const m=getFetchFunction(h);let p=t;return typeof t=="string"&&(p=await m(t)),isBlob(t)&&(p=await m(t)),Array.isArray(d)?await parse$2(p,d,h):await parse$2(p,d,h)}const VERSION$4="4.2.1",parseImageNode$1=globalThis.loaders?.parseImageNode,IMAGE_SUPPORTED$1=typeof Image<"u",IMAGE_BITMAP_SUPPORTED$1=typeof ImageBitmap<"u",NODE_IMAGE_SUPPORTED$1=!!parseImageNode$1,DATA_SUPPORTED$1=isBrowser$3?!0:NODE_IMAGE_SUPPORTED$1;function isImageTypeSupported$1(t){switch(t){case"auto":return IMAGE_BITMAP_SUPPORTED$1||IMAGE_SUPPORTED$1||DATA_SUPPORTED$1;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED$1;case"image":return IMAGE_SUPPORTED$1;case"data":return DATA_SUPPORTED$1;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function getDefaultImageType$1(){if(IMAGE_BITMAP_SUPPORTED$1)return"imagebitmap";if(IMAGE_SUPPORTED$1)return"image";if(DATA_SUPPORTED$1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType$1(t){const e=getImageTypeOrNull$1(t);if(!e)throw new Error("Not an image");return e}function getImageData$1(t){switch(getImageType$1(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),c=e.getContext("2d");if(!c)throw new Error("getImageData");return e.width=t.width,e.height=t.height,c.drawImage(t,0,0),c.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function getImageTypeOrNull$1(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const SVG_DATA_URL_PATTERN$1=/^data:image\/svg\+xml/,SVG_URL_PATTERN$1=/\.svg((\?|#).*)?$/;function isSVG$1(t){return t&&(SVG_DATA_URL_PATTERN$1.test(t)||SVG_URL_PATTERN$1.test(t))}function getBlobOrSVGDataUrl$1(t,e){if(isSVG$1(e)){let u=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(u=unescape(encodeURIComponent(u)))}catch(h){throw new Error(h.message)}return`data:image/svg+xml;base64,${btoa(u)}`}return getBlob$1(t,e)}function getBlob$1(t,e){if(isSVG$1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function parseToImage$1(t,e,c){const u=getBlobOrSVGDataUrl$1(t,c),d=self.URL||self.webkitURL,h=typeof u!="string"&&d.createObjectURL(u);try{return await loadToImage$1(h||u,e)}finally{h&&d.revokeObjectURL(h)}}async function loadToImage$1(t,e){const c=new Image;return c.src=t,e.image&&e.image.decode&&c.decode?(await c.decode(),c):await new Promise((u,d)=>{try{c.onload=()=>u(c),c.onerror=h=>{const m=h instanceof Error?h.message:"error";d(new Error(m))}}catch(h){d(h)}})}const EMPTY_OBJECT$1={};let imagebitmapOptionsSupported$1=!0;async function parseToImageBitmap$1(t,e,c){let u;isSVG$1(c)?u=await parseToImage$1(t,e,c):u=getBlob$1(t,c);const d=e&&e.imagebitmap;return await safeCreateImageBitmap$1(u,d)}async function safeCreateImageBitmap$1(t,e=null){if((isEmptyObject$1(e)||!imagebitmapOptionsSupported$1)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(c){console.warn(c),imagebitmapOptionsSupported$1=!1}return await createImageBitmap(t)}function isEmptyObject$1(t){for(const e in t||EMPTY_OBJECT$1)return!1;return!0}function getISOBMFFMediaType$1(t){return!checkString$1(t,"ftyp",4)||!(t[8]&96)?null:decodeMajorBrand$1(t)}function decodeMajorBrand$1(t){switch(getUTF8String$1(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function getUTF8String$1(t,e,c){return String.fromCharCode(...t.slice(e,c))}function stringToBytes$1(t){return[...t].map(e=>e.charCodeAt(0))}function checkString$1(t,e,c=0){const u=stringToBytes$1(e);for(let d=0;d<u.length;++d)if(u[d]!==t[d+c])return!1;return!0}const BIG_ENDIAN$1=!1,LITTLE_ENDIAN$2=!0;function getBinaryImageMetadata$1(t){const e=toDataView$1(t);return getPngMetadata$1(e)||getJpegMetadata$1(e)||getGifMetadata$1(e)||getBmpMetadata$1(e)||getISOBMFFMetadata$1(e)}function getISOBMFFMetadata$1(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),c=getISOBMFFMediaType$1(e);return c?{mimeType:c.mimeType,width:0,height:0}:null}function getPngMetadata$1(t){const e=toDataView$1(t);return e.byteLength>=24&&e.getUint32(0,BIG_ENDIAN$1)===2303741511?{mimeType:"image/png",width:e.getUint32(16,BIG_ENDIAN$1),height:e.getUint32(20,BIG_ENDIAN$1)}:null}function getGifMetadata$1(t){const e=toDataView$1(t);return e.byteLength>=10&&e.getUint32(0,BIG_ENDIAN$1)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,LITTLE_ENDIAN$2),height:e.getUint16(8,LITTLE_ENDIAN$2)}:null}function getBmpMetadata$1(t){const e=toDataView$1(t);return e.byteLength>=14&&e.getUint16(0,BIG_ENDIAN$1)===16973&&e.getUint32(2,LITTLE_ENDIAN$2)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,LITTLE_ENDIAN$2),height:e.getUint32(22,LITTLE_ENDIAN$2)}:null}function getJpegMetadata$1(t){const e=toDataView$1(t);if(!(e.byteLength>=3&&e.getUint16(0,BIG_ENDIAN$1)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:u,sofMarkers:d}=getJpegMarkers$1();let h=2;for(;h+9<e.byteLength;){const m=e.getUint16(h,BIG_ENDIAN$1);if(d.has(m))return{mimeType:"image/jpeg",height:e.getUint16(h+5,BIG_ENDIAN$1),width:e.getUint16(h+7,BIG_ENDIAN$1)};if(!u.has(m))return null;h+=2,h+=e.getUint16(h,BIG_ENDIAN$1)}return null}function getJpegMarkers$1(){const t=new Set([65499,65476,65484,65501,65534]);for(let c=65504;c<65520;++c)t.add(c);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function toDataView$1(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function parseToNodeImage$1(t,e){const{mimeType:c}=getBinaryImageMetadata$1(t)||{},u=globalThis.loaders?.parseImageNode;return assert$5(u),await u(t,c)}async function parseImage$1(t,e,c){e=e||{};const d=(e.image||{}).type||"auto",{url:h}=c||{},m=getLoadableImageType$1(d);let p;switch(m){case"imagebitmap":p=await parseToImageBitmap$1(t,e,h);break;case"image":p=await parseToImage$1(t,e,h);break;case"data":p=await parseToNodeImage$1(t);break;default:assert$5(!1)}return d==="data"&&(p=getImageData$1(p)),p}function getLoadableImageType$1(t){switch(t){case"auto":case"data":return getDefaultImageType$1();default:return isImageTypeSupported$1(t),t}}const EXTENSIONS$2=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],MIME_TYPES$1=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DEFAULT_IMAGE_LOADER_OPTIONS$1={image:{type:"auto",decode:!0}},ImageLoader$1={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VERSION$4,mimeTypes:MIME_TYPES$1,extensions:EXTENSIONS$2,parse:parseImage$1,tests:[t=>!!getBinaryImageMetadata$1(new DataView(t))],options:DEFAULT_IMAGE_LOADER_OPTIONS$1},mimeTypeSupportedSync={};function isImageFormatSupported(t){if(mimeTypeSupportedSync[t]===void 0){const e=isBrowser$3?checkBrowserImageFormatSupport(t):checkNodeImageFormatSupport(t);mimeTypeSupportedSync[t]=e}return mimeTypeSupportedSync[t]}function checkNodeImageFormatSupport(t){const e=["image/png","image/jpeg","image/gif"],c=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&c.includes(t)}function checkBrowserImageFormatSupport(t){switch(t){case"image/avif":case"image/webp":return testBrowserImageFormatSupport(t);default:return!0}}function testBrowserImageFormatSupport(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}function assert$2(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BYTES={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},TYPES=["SCALAR","VEC2","VEC3","VEC4"],ARRAY_CONSTRUCTOR_TO_WEBGL_CONSTANT=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ARRAY_TO_COMPONENT_TYPE=new Map(ARRAY_CONSTRUCTOR_TO_WEBGL_CONSTANT),ATTRIBUTE_TYPE_TO_COMPONENTS$1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE$1={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY$1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function getAccessorTypeFromSize(t){return TYPES[t-1]||TYPES[0]}function getComponentTypeFromArray(t){const e=ARRAY_TO_COMPONENT_TYPE.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function getAccessorArrayTypeAndLength(t,e){const c=ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY$1[t.componentType],u=ATTRIBUTE_TYPE_TO_COMPONENTS$1[t.type],d=ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE$1[t.componentType],h=t.count*u,m=t.count*u*d;assert$2(m>=0&&m<=e.byteLength);const p=BYTES[t.componentType],y=COMPONENTS[t.type];return{ArrayType:c,length:h,byteLength:m,componentByteSize:p,numberOfComponentsInElement:y}}function getTypedArrayForBufferView(t,e,c){const u=t.bufferViews[c];assert$2(u);const d=u.buffer,h=e[d];assert$2(h);const m=(u.byteOffset||0)+h.byteOffset;return new Uint8Array(h.arrayBuffer,m,u.byteLength)}function getTypedArrayForAccessor(t,e,c){const u=typeof c=="number"?t.accessors?.[c]:c;if(!u)throw new Error(`No gltf accessor ${JSON.stringify(c)}`);const d=t.bufferViews?.[u.bufferView||0];if(!d)throw new Error(`No gltf buffer view for accessor ${d}`);const{arrayBuffer:h,byteOffset:m}=e[d.buffer],p=(m||0)+(u.byteOffset||0)+(d.byteOffset||0),{ArrayType:y,length:M,componentByteSize:F,numberOfComponentsInElement:L}=getAccessorArrayTypeAndLength(u,d),K=F*L,X=d.byteStride||K;if(typeof d.byteStride>"u"||d.byteStride===K)return new y(h,p,M);const j=new y(M);for(let Q=0;Q<u.count;Q++){const z=new y(h,p+Q*X,L);j.set(z,Q*L)}return j}function makeDefaultGLTFJson(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class GLTFScenegraph{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||makeDefaultGLTFJson(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const c=this.getUsedExtensions().find(d=>d===e),u=this.getRequiredExtensions().find(d=>d===e);return typeof c=="string"||typeof u=="string"}getExtension(e){const c=this.getUsedExtensions().find(d=>d===e),u=this.json.extensions||{};return c?u[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(u=>u===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,c){return(e.extensions||{})[c]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,c){if(typeof c=="object")return c;const u=this.json[e]&&this.json[e][c];if(!u)throw new Error(`glTF file error: Could not find ${e}[${c}]`);return u}getTypedArrayForBufferView(e){e=this.getBufferView(e);const c=e.buffer,u=this.gltf.buffers[c];assert$2(u);const d=(e.byteOffset||0)+u.byteOffset;return new Uint8Array(u.arrayBuffer,d,e.byteLength)}getTypedArrayForAccessor(e){const c=this.getAccessor(e);return getTypedArrayForAccessor(this.gltf.json,this.gltf.buffers,c)}getTypedArrayForImageData(e){e=this.getAccessor(e);const c=this.getBufferView(e.bufferView),d=this.getBuffer(c.buffer).data,h=c.byteOffset||0;return new Uint8Array(d,h,c.byteLength)}addApplicationData(e,c){return this.json[e]=c,this}addExtraData(e,c){return this.json.extras=this.json.extras||{},this.json.extras[e]=c,this}addObjectExtension(e,c,u){return e.extensions=e.extensions||{},e.extensions[c]=u,this.registerUsedExtension(c),this}setObjectExtension(e,c,u){const d=e.extensions||{};d[c]=u}removeObjectExtension(e,c){const u=e?.extensions||{};if(u[c]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const d=this.json.extensionsRemoved;d.includes(c)||d.push(c)}delete u[c]}addExtension(e,c={}){return assert$2(c),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=c,this.registerUsedExtension(e),c}addRequiredExtension(e,c={}){return assert$2(c),this.addExtension(e,c),this.registerRequiredExtension(e),c}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(c=>c===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(c=>c===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const c=this.json.extensionsRemoved;c.includes(e)||c.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:c}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:c}),this.json.scenes.length-1}addNode(e){const{meshIndex:c,matrix:u}=e;this.json.nodes=this.json.nodes||[];const d={mesh:c};return u&&(d.matrix=u),this.json.nodes.push(d),this.json.nodes.length-1}addMesh(e){const{attributes:c,indices:u,material:d,mode:h=4}=e,p={primitives:[{attributes:this._addAttributes(c),mode:h}]};if(u){const y=this._addIndices(u);p.primitives[0].indices=y}return Number.isFinite(d)&&(p.primitives[0].material=d),this.json.meshes=this.json.meshes||[],this.json.meshes.push(p),this.json.meshes.length-1}addPointCloud(e){const u={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(u),this.json.meshes.length-1}addImage(e,c){const u=getBinaryImageMetadata$1(e),d=c||u?.mimeType,m={bufferView:this.addBufferView(e),mimeType:d};return this.json.images=this.json.images||[],this.json.images.push(m),this.json.images.length-1}addBufferView(e,c=0,u=this.byteLength){const d=e.byteLength;assert$2(Number.isFinite(d)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const h={buffer:c,byteOffset:u,byteLength:d};return this.byteLength+=padToNBytes(d,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(h),this.json.bufferViews.length-1}addAccessor(e,c){const u={bufferView:e,type:getAccessorTypeFromSize(c.size),componentType:c.componentType,count:c.count,max:c.max,min:c.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(u),this.json.accessors.length-1}addBinaryBuffer(e,c={size:3}){const u=this.addBufferView(e);let d={min:c.min,max:c.max};(!d.min||!d.max)&&(d=this._getAccessorMinMax(e,c.size));const h={size:c.size,componentType:getComponentTypeFromArray(e),count:Math.round(e.length/c.size),min:d.min,max:d.max};return this.addAccessor(u,Object.assign(h,c))}addTexture(e){const{imageIndex:c}=e,u={source:c};return this.json.textures=this.json.textures||[],this.json.textures.push(u),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const e=this.byteLength,c=new ArrayBuffer(e),u=new Uint8Array(c);let d=0;for(const h of this.sourceBuffers||[])d=copyToArray(h,u,d);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=c,this.sourceBuffers=[c]}_removeStringFromArray(e,c){let u=!0;for(;u;){const d=e.indexOf(c);d>-1?e.splice(d,1):u=!1}}_addAttributes(e={}){const c={};for(const u in e){const d=e[u],h=this._getGltfAttributeName(u),m=this.addBinaryBuffer(d.value,d);c[h]=m}return c}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,c){const u={min:null,max:null};if(e.length<c)return u;u.min=[],u.max=[];const d=e.subarray(0,c);for(const h of d)u.min.push(h),u.max.push(h);for(let h=c;h<e.length;h+=c)for(let m=0;m<c;m++)u.min[0+m]=Math.min(u.min[0+m],e[h+m]),u.max[0+m]=Math.max(u.max[0+m],e[h+m]);return u}}function emod(t){return(t%1+1)%1}const ATTRIBUTE_TYPE_TO_COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function getArrayElementByteSize(t,e){return ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[e]*ATTRIBUTE_TYPE_TO_COMPONENTS[t]}function getOffsetsForProperty(t,e,c,u){if(c!=="UINT8"&&c!=="UINT16"&&c!=="UINT32"&&c!=="UINT64")return null;const d=t.getTypedArrayForBufferView(e),h=convertRawBufferToMetadataArray(d,"SCALAR",c,u+1);return h instanceof BigInt64Array||h instanceof BigUint64Array?null:h}function convertRawBufferToMetadataArray(t,e,c,u=1){const d=ATTRIBUTE_TYPE_TO_COMPONENTS[e],h=ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[c],m=ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[c],p=u*d,y=p*m;let M=t.buffer,F=t.byteOffset;return F%m!==0&&(M=new Uint8Array(M).slice(F,F+y).buffer,F=0),new h(M,F,p)}function getPrimitiveTextureData(t,e,c){const u=`TEXCOORD_${e.texCoord||0}`,d=c.attributes[u],h=t.getTypedArrayForAccessor(d),m=t.gltf.json,p=e.index,y=m.textures?.[p]?.source;if(typeof y<"u"){const M=m.images?.[y]?.mimeType,F=t.gltf.images?.[y];if(F&&typeof F.width<"u"){const L=[];for(let K=0;K<h.length;K+=2){const X=getImageValueByCoordinates(F,M,h,K,e.channels);L.push(X)}return L}}return[]}function primitivePropertyDataToAttributes(t,e,c,u,d){if(!c?.length)return;const h=[];for(const F of c){let L=u.findIndex(K=>K===F);L===-1&&(L=u.push(F)-1),h.push(L)}const m=new Uint32Array(h),p=t.gltf.buffers.push({arrayBuffer:m.buffer,byteOffset:m.byteOffset,byteLength:m.byteLength})-1,y=t.addBufferView(m,p,0),M=t.addAccessor(y,{size:1,componentType:getComponentTypeFromArray(m),count:m.length});d.attributes[e]=M}function getImageValueByCoordinates(t,e,c,u,d=[0]){const h={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},m=c[u],p=c[u+1];let y=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(y=4);const M=coordinatesToOffset(m,p,t,y);let F=0;for(const L of d){const K=typeof L=="number"?Object.values(h)[L]:h[L],X=M+K.offset,j=getImageData$1(t);if(j.data.length<=X)throw new Error(`${j.data.length} <= ${X}`);const Q=j.data[X];F|=Q<<K.shift}return F}function coordinatesToOffset(t,e,c,u=1){const d=c.width,h=emod(t)*(d-1),m=Math.round(h),p=c.height,y=emod(e)*(p-1),M=Math.round(y),F=c.components?c.components:u;return(M*d+m)*F}function parseVariableLengthArrayNumeric(t,e,c,u,d){const h=[];for(let m=0;m<e;m++){const p=c[m],y=c[m+1]-c[m];if(y+p>u)break;const M=p/d,F=y/d;h.push(t.slice(M,M+F))}return h}function parseFixedLengthArrayNumeric(t,e,c){const u=[];for(let d=0;d<e;d++){const h=d*c;u.push(t.slice(h,h+c))}return u}function getPropertyDataString(t,e,c,u){if(c)throw new Error("Not implemented - arrayOffsets for strings is specified");if(u){const d=[],h=new TextDecoder("utf8");let m=0;for(let p=0;p<t;p++){const y=u[p+1]-u[p];if(y+m<=e.length){const M=e.subarray(m,y+m),F=h.decode(M);d.push(F),m+=y}}return d}return[]}const EXT_MESH_FEATURES_NAME="EXT_mesh_features",name$a=EXT_MESH_FEATURES_NAME;async function decode$9(t,e){const c=new GLTFScenegraph(t);decodeExtMeshFeatures(c,e)}function decodeExtMeshFeatures(t,e){const c=t.gltf.json;if(c.meshes)for(const u of c.meshes)for(const d of u.primitives)processMeshPrimitiveFeatures(t,d,e)}function processMeshPrimitiveFeatures(t,e,c){if(!c?.gltf?.loadBuffers)return;const d=e.extensions?.[EXT_MESH_FEATURES_NAME]?.featureIds;if(d)for(const h of d){let m;if(typeof h.attribute<"u"){const p=`_FEATURE_ID_${h.attribute}`,y=e.attributes[p];m=t.getTypedArrayForAccessor(y)}else typeof h.texture<"u"&&c?.gltf?.loadImages?m=getPrimitiveTextureData(t,h.texture,e):m=[];h.data=m}}const EXT_mesh_features=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$9,name:name$a},Symbol.toStringTag,{value:"Module"})),EXT_STRUCTURAL_METADATA_NAME="EXT_structural_metadata",name$9=EXT_STRUCTURAL_METADATA_NAME;async function decode$8(t,e){const c=new GLTFScenegraph(t);decodeExtStructuralMetadata(c,e)}function decodeExtStructuralMetadata(t,e){if(!e.gltf?.loadBuffers)return;const c=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);c&&(e.gltf?.loadImages&&decodePropertyTextures$1(t,c),decodePropertyTables$1(t,c))}function decodePropertyTextures$1(t,e){const c=e.propertyTextures,u=t.gltf.json;if(c&&u.meshes)for(const d of u.meshes)for(const h of d.primitives)processPrimitivePropertyTextures(t,c,h,e)}function decodePropertyTables$1(t,e){const c=e.schema;if(!c)return;const u=c.classes,d=e.propertyTables;if(u&&d)for(const h in u){const m=findPropertyTableByClass$1(d,h);m&&processPropertyTable$1(t,c,m)}}function findPropertyTableByClass$1(t,e){for(const c of t)if(c.class===e)return c;return null}function processPrimitivePropertyTextures(t,e,c,u){if(!e)return;const h=c.extensions?.[EXT_STRUCTURAL_METADATA_NAME]?.propertyTextures;if(h)for(const m of h){const p=e[m];processPrimitivePropertyTexture(t,p,c,u)}}function processPrimitivePropertyTexture(t,e,c,u){if(!e.properties)return;u.dataAttributeNames||(u.dataAttributeNames=[]);const d=e.class;for(const h in e.properties){const m=`${d}_${h}`,p=e.properties?.[h];if(!p)continue;p.data||(p.data=[]);const y=p.data,M=getPrimitiveTextureData(t,p,c);M!==null&&(primitivePropertyDataToAttributes(t,m,M,y,c),p.data=y,u.dataAttributeNames.push(m))}}function processPropertyTable$1(t,e,c){const u=e.classes?.[c.class];if(!u)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${c.class}`);const d=c.count;for(const h in u.properties){const m=u.properties[h],p=c.properties?.[h];if(p){const y=getPropertyDataFromBinarySource$1(t,e,m,d,p);p.data=y}}}function getPropertyDataFromBinarySource$1(t,e,c,u,d){let h=[];const m=d.values,p=t.getTypedArrayForBufferView(m),y=getArrayOffsetsForProperty$1(t,c,d,u),M=getStringOffsetsForProperty$1(t,d,u);switch(c.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{h=getPropertyDataNumeric$1(c,u,p,y);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${c.type}`);case"STRING":{h=getPropertyDataString(u,p,y,M);break}case"ENUM":{h=getPropertyDataENUM(e,c,u,p,y);break}default:throw new Error(`Unknown classProperty type ${c.type}`)}return h}function getArrayOffsetsForProperty$1(t,e,c,u){return e.array&&typeof e.count>"u"&&typeof c.arrayOffsets<"u"?getOffsetsForProperty(t,c.arrayOffsets,c.arrayOffsetType||"UINT32",u):null}function getStringOffsetsForProperty$1(t,e,c){return typeof e.stringOffsets<"u"?getOffsetsForProperty(t,e.stringOffsets,e.stringOffsetType||"UINT32",c):null}function getPropertyDataNumeric$1(t,e,c,u){const d=t.array,h=t.count,m=getArrayElementByteSize(t.type,t.componentType),p=c.byteLength/m;let y;return t.componentType?y=convertRawBufferToMetadataArray(c,t.type,t.componentType,p):y=c,d?u?parseVariableLengthArrayNumeric(y,e,u,c.length,m):h?parseFixedLengthArrayNumeric(y,e,h):[]:y}function getPropertyDataENUM(t,e,c,u,d){const h=e.enumType;if(!h)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const m=t.enums?.[h];if(!m)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${h}`);const p=m.valueType||"UINT16",y=getArrayElementByteSize(e.type,p),M=u.byteLength/y;let F=convertRawBufferToMetadataArray(u,e.type,p,M);if(F||(F=u),e.array){if(d)return parseVariableLengthArrayENUM({valuesData:F,numberOfElements:c,arrayOffsets:d,valuesDataBytesLength:u.length,elementSize:y,enumEntry:m});const L=e.count;return L?parseFixedLengthArrayENUM(F,c,L,m):[]}return getEnumsArray(F,0,c,m)}function parseVariableLengthArrayENUM(t){const{valuesData:e,numberOfElements:c,arrayOffsets:u,valuesDataBytesLength:d,elementSize:h,enumEntry:m}=t,p=[];for(let y=0;y<c;y++){const M=u[y],F=u[y+1]-u[y];if(F+M>d)break;const L=M/h,K=F/h,X=getEnumsArray(e,L,K,m);p.push(X)}return p}function parseFixedLengthArrayENUM(t,e,c,u){const d=[];for(let h=0;h<e;h++){const m=c*h,p=getEnumsArray(t,m,c,u);d.push(p)}return d}function getEnumsArray(t,e,c,u){const d=[];for(let h=0;h<c;h++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)d.push("");else{const m=t[e+h],p=getEnumByValue(u,m);p?d.push(p.name):d.push("")}return d}function getEnumByValue(t,e){for(const c of t.values)if(c.value===e)return c;return null}const EXT_structural_metadata=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$8,name:name$9},Symbol.toStringTag,{value:"Module"})),EXT_FEATURE_METADATA_NAME="EXT_feature_metadata",name$8=EXT_FEATURE_METADATA_NAME;async function decode$7(t,e){const c=new GLTFScenegraph(t);decodeExtFeatureMetadata(c,e)}function decodeExtFeatureMetadata(t,e){if(!e.gltf?.loadBuffers)return;const c=t.getExtension(EXT_FEATURE_METADATA_NAME);c&&(e.gltf?.loadImages&&decodePropertyTextures(t,c),decodePropertyTables(t,c))}function decodePropertyTextures(t,e){const c=e.schema;if(!c)return;const u=c.classes,{featureTextures:d}=e;if(u&&d)for(const h in u){const m=u[h],p=findFeatureTextureByClass(d,h);p&&handleFeatureTextureProperties(t,p,m)}}function decodePropertyTables(t,e){const c=e.schema;if(!c)return;const u=c.classes,d=e.featureTables;if(u&&d)for(const h in u){const m=findPropertyTableByClass(d,h);m&&processPropertyTable(t,c,m)}}function findPropertyTableByClass(t,e){for(const c in t){const u=t[c];if(u.class===e)return u}return null}function findFeatureTextureByClass(t,e){for(const c in t){const u=t[c];if(u.class===e)return u}return null}function processPropertyTable(t,e,c){if(!c.class)return;const u=e.classes?.[c.class];if(!u)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${c.class}`);const d=c.count;for(const h in u.properties){const m=u.properties[h],p=c.properties?.[h];if(p){const y=getPropertyDataFromBinarySource(t,e,m,d,p);p.data=y}}}function handleFeatureTextureProperties(t,e,c){const u=e.class;for(const d in c.properties){const h=e?.properties?.[d];if(h){const m=getPropertyDataFromTexture(t,h,u);h.data=m}}}function getPropertyDataFromBinarySource(t,e,c,u,d){let h=[];const m=d.bufferView,p=t.getTypedArrayForBufferView(m),y=getArrayOffsetsForProperty(t,c,d,u),M=getStringOffsetsForProperty(t,c,d,u);return c.type==="STRING"||c.componentType==="STRING"?h=getPropertyDataString(u,p,y,M):isNumericProperty(c)&&(h=getPropertyDataNumeric(c,u,p,y)),h}function getArrayOffsetsForProperty(t,e,c,u){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof c.arrayOffsetBufferView<"u"?getOffsetsForProperty(t,c.arrayOffsetBufferView,c.offsetType||"UINT32",u):null}function getStringOffsetsForProperty(t,e,c,u){return typeof c.stringOffsetBufferView<"u"?getOffsetsForProperty(t,c.stringOffsetBufferView,c.offsetType||"UINT32",u):null}function isNumericProperty(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function getPropertyDataNumeric(t,e,c,u){const d=t.type==="ARRAY",h=t.componentCount,m="SCALAR",p=t.componentType||t.type,y=getArrayElementByteSize(m,p),M=c.byteLength/y,F=convertRawBufferToMetadataArray(c,m,p,M);return d?u?parseVariableLengthArrayNumeric(F,e,u,c.length,y):h?parseFixedLengthArrayNumeric(F,e,h):[]:F}function getPropertyDataFromTexture(t,e,c){const u=t.gltf.json;if(!u.meshes)return[];const d=[];for(const h of u.meshes)for(const m of h.primitives)processPrimitiveTextures(t,c,e,d,m);return d}function processPrimitiveTextures(t,e,c,u,d){const h={channels:c.channels,...c.texture},m=getPrimitiveTextureData(t,h,d);m&&primitivePropertyDataToAttributes(t,e,m,u,d)}const EXT_feature_metadata=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$7,name:name$8},Symbol.toStringTag,{value:"Module"})),VERSION$3="4.2.1",VERSION$2="4.2.1",BASIS_EXTERNAL_LIBRARIES={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let loadBasisTranscoderPromise;async function loadBasisTranscoderModule(t){registerJSModules(t.modules);const e=getJSModuleOrNull("basis");return e||(loadBasisTranscoderPromise||=loadBasisTranscoder(t),await loadBasisTranscoderPromise)}async function loadBasisTranscoder(t){let e=null,c=null;return[e,c]=await Promise.all([await loadLibrary(BASIS_EXTERNAL_LIBRARIES.TRANSCODER,"textures",t),await loadLibrary(BASIS_EXTERNAL_LIBRARIES.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await initializeBasisTranscoderModule(e,c)}function initializeBasisTranscoderModule(t,e){const c={};return e&&(c.wasmBinary=e),new Promise(u=>{t(c).then(d=>{const{BasisFile:h,initializeBasis:m}=d;m(),u({BasisFile:h})})})}let loadBasisEncoderPromise;async function loadBasisEncoderModule(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(loadBasisEncoderPromise=loadBasisEncoderPromise||loadBasisEncoder(t),await loadBasisEncoderPromise)}async function loadBasisEncoder(t){let e=null,c=null;return[e,c]=await Promise.all([await loadLibrary(BASIS_EXTERNAL_LIBRARIES.ENCODER,"textures",t),await loadLibrary(BASIS_EXTERNAL_LIBRARIES.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await initializeBasisEncoderModule(e,c)}function initializeBasisEncoderModule(t,e){const c={};return e&&(c.wasmBinary=e),new Promise(u=>{t(c).then(d=>{const{BasisFile:h,KTX2File:m,initializeBasis:p,BasisEncoder:y}=d;p(),u({BasisFile:h,KTX2File:m,BasisEncoder:y})})})}const GL_EXTENSIONS_CONSTANTS={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},BROWSER_PREFIXES=["","WEBKIT_","MOZ_"],WEBGL_EXTENSIONS={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let formats=null;function getSupportedGPUTextureFormats(t){if(!formats){t=t||getWebGLContext()||void 0,formats=new Set;for(const e of BROWSER_PREFIXES)for(const c in WEBGL_EXTENSIONS)if(t&&t.getExtension(`${e}${c}`)){const u=WEBGL_EXTENSIONS[c];formats.add(u)}}return formats}function getWebGLContext(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var n,i,s,a,r,o,l,f;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(n||(n={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(i||(i={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(s||(s={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(a||(a={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(r||(r={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(o||(o={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(l||(l={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(f||(f={}));const KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10];function isKTX(t){const e=new Uint8Array(t);return!(e.byteLength<KTX2_ID.length||e[0]!==KTX2_ID[0]||e[1]!==KTX2_ID[1]||e[2]!==KTX2_ID[2]||e[3]!==KTX2_ID[3]||e[4]!==KTX2_ID[4]||e[5]!==KTX2_ID[5]||e[6]!==KTX2_ID[6]||e[7]!==KTX2_ID[7]||e[8]!==KTX2_ID[8]||e[9]!==KTX2_ID[9]||e[10]!==KTX2_ID[10]||e[11]!==KTX2_ID[11])}const OutputFormat={etc1:{basisFormat:0,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function parseBasis(t,e){if(e.basis.containerFormat==="auto"){if(isKTX(t)){const u=await loadBasisEncoderModule(e);return parseKTX2File(u.KTX2File,t,e)}const{BasisFile:c}=await loadBasisTranscoderModule(e);return parseBasisFile(c,t,e)}switch(e.basis.module){case"encoder":const c=await loadBasisEncoderModule(e);switch(e.basis.containerFormat){case"ktx2":return parseKTX2File(c.KTX2File,t,e);case"basis":default:return parseBasisFile(c.BasisFile,t,e)}case"transcoder":default:const{BasisFile:u}=await loadBasisTranscoderModule(e);return parseBasisFile(u,t,e)}}function parseBasisFile(t,e,c){const u=new t(new Uint8Array(e));try{if(!u.startTranscoding())throw new Error("Failed to start basis transcoding");const d=u.getNumImages(),h=[];for(let m=0;m<d;m++){const p=u.getNumLevels(m),y=[];for(let M=0;M<p;M++)y.push(transcodeImage(u,m,M,c));h.push(y)}return h}finally{u.close(),u.delete()}}function transcodeImage(t,e,c,u){const d=t.getImageWidth(e,c),h=t.getImageHeight(e,c),m=t.getHasAlpha(),{compressed:p,format:y,basisFormat:M}=getBasisOptions(u,m),F=t.getImageTranscodedSizeInBytes(e,c,M),L=new Uint8Array(F);if(!t.transcodeImage(L,e,c,M,0,0))throw new Error("failed to start Basis transcoding");return{width:d,height:h,data:L,compressed:p,format:y,hasAlpha:m}}function parseKTX2File(t,e,c){const u=new t(new Uint8Array(e));try{if(!u.startTranscoding())throw new Error("failed to start KTX2 transcoding");const d=u.getLevels(),h=[];for(let m=0;m<d;m++){h.push(transcodeKTX2Image(u,m,c));break}return[h]}finally{u.close(),u.delete()}}function transcodeKTX2Image(t,e,c){const{alphaFlag:u,height:d,width:h}=t.getImageLevelInfo(e,0,0),{compressed:m,format:p,basisFormat:y}=getBasisOptions(c,u),M=t.getImageTranscodedSizeInBytes(e,0,0,y),F=new Uint8Array(M);if(!t.transcodeImage(F,e,0,0,y,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:h,height:d,data:F,compressed:m,levelSize:M,hasAlpha:u,format:p}}function getBasisOptions(t,e){let c=t&&t.basis&&t.basis.format;return c==="auto"&&(c=selectSupportedBasisFormat()),typeof c=="object"&&(c=e?c.alpha:c.noAlpha),c=c.toLowerCase(),OutputFormat[c]}function selectSupportedBasisFormat(){const t=getSupportedGPUTextureFormats();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const BasisWorkerLoader={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:VERSION$2,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},BasisLoader={...BasisWorkerLoader,parse:parseBasis},LITTLE_ENDIAN$1=!0,MAGIC_glTF=1735152710,GLB_FILE_HEADER_SIZE=12,GLB_CHUNK_HEADER_SIZE=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562,GLB_V1_CONTENT_FORMAT_JSON=0,GLB_CHUNK_TYPE_JSON_XVIZ_DEPRECATED=0,GLB_CHUNK_TYPE_BIX_XVIZ_DEPRECATED=1;function getMagicString(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function isGLB(t,e=0,c={}){const u=new DataView(t),{magic:d=MAGIC_glTF}=c,h=u.getUint32(e,!1);return h===d||h===MAGIC_glTF}function parseGLBSync(t,e,c=0,u={}){const d=new DataView(e),h=getMagicString(d,c+0),m=d.getUint32(c+4,LITTLE_ENDIAN$1),p=d.getUint32(c+8,LITTLE_ENDIAN$1);switch(Object.assign(t,{header:{byteOffset:c,byteLength:p,hasBinChunk:!1},type:h,version:m,json:{},binChunks:[]}),c+=GLB_FILE_HEADER_SIZE,t.version){case 1:return parseGLBV1(t,d,c);case 2:return parseGLBV2(t,d,c,u={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function parseGLBV1(t,e,c){assert$5(t.header.byteLength>GLB_FILE_HEADER_SIZE+GLB_CHUNK_HEADER_SIZE);const u=e.getUint32(c+0,LITTLE_ENDIAN$1),d=e.getUint32(c+4,LITTLE_ENDIAN$1);return c+=GLB_CHUNK_HEADER_SIZE,assert$5(d===GLB_V1_CONTENT_FORMAT_JSON),parseJSONChunk(t,e,c,u),c+=u,c+=parseBINChunk(t,e,c,t.header.byteLength),c}function parseGLBV2(t,e,c,u){return assert$5(t.header.byteLength>GLB_FILE_HEADER_SIZE+GLB_CHUNK_HEADER_SIZE),parseGLBChunksSync(t,e,c,u),c+t.header.byteLength}function parseGLBChunksSync(t,e,c,u){for(;c+8<=t.header.byteLength;){const d=e.getUint32(c+0,LITTLE_ENDIAN$1),h=e.getUint32(c+4,LITTLE_ENDIAN$1);switch(c+=GLB_CHUNK_HEADER_SIZE,h){case GLB_CHUNK_TYPE_JSON:parseJSONChunk(t,e,c,d);break;case GLB_CHUNK_TYPE_BIN:parseBINChunk(t,e,c,d);break;case GLB_CHUNK_TYPE_JSON_XVIZ_DEPRECATED:u.strict||parseJSONChunk(t,e,c,d);break;case GLB_CHUNK_TYPE_BIX_XVIZ_DEPRECATED:u.strict||parseBINChunk(t,e,c,d);break}c+=padToNBytes(d,4)}return c}function parseJSONChunk(t,e,c,u){const d=new Uint8Array(e.buffer,c,u),m=new TextDecoder("utf8").decode(d);return t.json=JSON.parse(m),padToNBytes(u,4)}function parseBINChunk(t,e,c,u){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:c,byteLength:u,arrayBuffer:e.buffer}),padToNBytes(u,4)}function resolveUrl(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const u=e.baseUri||e.uri;if(!u)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return u.substr(0,u.lastIndexOf("/")+1)+t}const wasm_base="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",wasm_simd="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",detector=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),wasmpack=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),FILTERS={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},DECODERS={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function meshoptDecodeGltfBuffer(t,e,c,u,d,h="NONE"){const m=await loadWasmInstance();decode$6(m,m.exports[DECODERS[d]],t,e,c,u,m.exports[FILTERS[h||"NONE"]])}let wasmPromise;async function loadWasmInstance(){return wasmPromise||(wasmPromise=loadWasmModule()),wasmPromise}async function loadWasmModule(){let t=wasm_base;WebAssembly.validate(detector)&&(t=wasm_simd,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(unpack(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function unpack(t){const e=new Uint8Array(t.length);for(let u=0;u<t.length;++u){const d=t.charCodeAt(u);e[u]=d>96?d-71:d>64?d-65:d>47?d+4:d>46?63:62}let c=0;for(let u=0;u<t.length;++u)e[c++]=e[u]<60?wasmpack[e[u]]:(e[u]-60)*64+e[++u];return e.buffer.slice(0,c)}function decode$6(t,e,c,u,d,h,m){const p=t.exports.sbrk,y=u+3&-4,M=p(y*d),F=p(h.length),L=new Uint8Array(t.exports.memory.buffer);L.set(h,F);const K=e(M,u,d,F,h.length);if(K===0&&m&&m(M,y,d),c.set(L.subarray(M,M+u*d)),p(M-p(0)),K!==0)throw new Error(`Malformed buffer data: ${K}`)}const EXT_MESHOPT_COMPRESSION="EXT_meshopt_compression",name$7=EXT_MESHOPT_COMPRESSION;async function decode$5(t,e){const c=new GLTFScenegraph(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const u=[];for(const d of t.json.bufferViews||[])u.push(decodeMeshoptBufferView(c,d));await Promise.all(u),c.removeExtension(EXT_MESHOPT_COMPRESSION)}async function decodeMeshoptBufferView(t,e){const c=t.getObjectExtension(e,EXT_MESHOPT_COMPRESSION);if(c){const{byteOffset:u=0,byteLength:d=0,byteStride:h,count:m,mode:p,filter:y="NONE",buffer:M}=c,F=t.gltf.buffers[M],L=new Uint8Array(F.arrayBuffer,F.byteOffset+u,d),K=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await meshoptDecodeGltfBuffer(K,m,h,L,p,y),t.removeObjectExtension(e,EXT_MESHOPT_COMPRESSION)}}const EXT_meshopt_compression=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$5,name:name$7},Symbol.toStringTag,{value:"Module"})),EXT_TEXTURE_WEBP="EXT_texture_webp",name$6=EXT_TEXTURE_WEBP;function preprocess$3(t,e){const c=new GLTFScenegraph(t);if(!isImageFormatSupported("image/webp")){if(c.getRequiredExtensions().includes(EXT_TEXTURE_WEBP))throw new Error(`gltf: Required extension ${EXT_TEXTURE_WEBP} not supported by browser`);return}const{json:u}=c;for(const d of u.textures||[]){const h=c.getObjectExtension(d,EXT_TEXTURE_WEBP);h&&(d.source=h.source),c.removeObjectExtension(d,EXT_TEXTURE_WEBP)}c.removeExtension(EXT_TEXTURE_WEBP)}const EXT_texture_webp=Object.freeze(Object.defineProperty({__proto__:null,name:name$6,preprocess:preprocess$3},Symbol.toStringTag,{value:"Module"})),KHR_TEXTURE_BASISU="KHR_texture_basisu",name$5=KHR_TEXTURE_BASISU;function preprocess$2(t,e){const c=new GLTFScenegraph(t),{json:u}=c;for(const d of u.textures||[]){const h=c.getObjectExtension(d,KHR_TEXTURE_BASISU);h&&(d.source=h.source,c.removeObjectExtension(d,KHR_TEXTURE_BASISU))}c.removeExtension(KHR_TEXTURE_BASISU)}const KHR_texture_basisu=Object.freeze(Object.defineProperty({__proto__:null,name:name$5,preprocess:preprocess$2},Symbol.toStringTag,{value:"Module"})),VERSION$1="4.2.1",DracoLoader$1={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:VERSION$1,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function getDracoSchema(t,e,c){const u=makeMetadata(e.metadata),d=[],h=transformAttributesLoaderData(e.attributes);for(const m in t){const p=t[m],y=getArrowFieldFromAttribute(m,p,h[m]);d.push(y)}if(c){const m=getArrowFieldFromAttribute("indices",c);d.push(m)}return{fields:d,metadata:u}}function transformAttributesLoaderData(t){const e={};for(const c in t){const u=t[c];e[u.name||"undefined"]=u}return e}function getArrowFieldFromAttribute(t,e,c){const u=c?makeMetadata(c.metadata):void 0;return deduceMeshField(t,e,u)}function makeMetadata(t){Object.entries(t);const e={};for(const c in t)e[`${c}.string`]=JSON.stringify(t[c]);return e}const DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},INDEX_ITEM_SIZE=4;class DracoParser{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,c={}){const u=new this.draco.DecoderBuffer;u.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(c);const d=this.decoder.GetEncodedGeometryType(u),h=d===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let m;switch(d){case this.draco.TRIANGULAR_MESH:m=this.decoder.DecodeBufferToMesh(u,h);break;case this.draco.POINT_CLOUD:m=this.decoder.DecodeBufferToPointCloud(u,h);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!m.ok()||!h.ptr){const K=`DRACO decompression failed: ${m.error_msg()}`;throw new Error(K)}const p=this._getDracoLoaderData(h,d,c),y=this._getMeshData(h,p,c),M=getMeshBoundingBox(y.attributes),F=getDracoSchema(y.attributes,p,y.indices);return{loader:"draco",loaderData:p,header:{vertexCount:h.num_points(),boundingBox:M},...y,schema:F}}finally{this.draco.destroy(u),h&&this.draco.destroy(h)}}_getDracoLoaderData(e,c,u){const d=this._getTopLevelMetadata(e),h=this._getDracoAttributes(e,u);return{geometry_type:c,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:d,attributes:h}}_getDracoAttributes(e,c){const u={};for(let d=0;d<e.num_attributes();d++){const h=this.decoder.GetAttribute(e,d),m=this._getAttributeMetadata(e,d);u[h.unique_id()]={unique_id:h.unique_id(),attribute_type:h.attribute_type(),data_type:h.data_type(),num_components:h.num_components(),byte_offset:h.byte_offset(),byte_stride:h.byte_stride(),normalized:h.normalized(),attribute_index:d,metadata:m};const p=this._getQuantizationTransform(h,c);p&&(u[h.unique_id()].quantization_transform=p);const y=this._getOctahedronTransform(h,c);y&&(u[h.unique_id()].octahedron_transform=y)}return u}_getMeshData(e,c,u){const d=this._getMeshAttributes(c,e,u);if(!d.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(u.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:d,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:d,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:d}}_getMeshAttributes(e,c,u){const d={};for(const h of Object.values(e.attributes)){const m=this._deduceAttributeName(h,u);h.name=m;const p=this._getAttributeValues(c,h);if(p){const{value:y,size:M}=p;d[m]={value:y,size:M,byteOffset:h.byte_offset,byteStride:h.byte_stride,normalized:h.normalized}}}return d}_getTriangleListIndices(e){const u=e.num_faces()*3,d=u*INDEX_ITEM_SIZE,h=this.draco._malloc(d);try{return this.decoder.GetTrianglesUInt32Array(e,d,h),new Uint32Array(this.draco.HEAPF32.buffer,h,u).slice()}finally{this.draco._free(h)}}_getTriangleStripIndices(e){const c=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,c),getUint32Array(c)}finally{this.draco.destroy(c)}}_getAttributeValues(e,c){const u=DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP[c.data_type];if(!u)return console.warn(`DRACO: Unsupported attribute type ${c.data_type}`),null;const d=c.num_components,m=e.num_points()*d,p=m*u.BYTES_PER_ELEMENT,y=getDracoDataType(this.draco,u);let M;const F=this.draco._malloc(p);try{const L=this.decoder.GetAttribute(e,c.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,L,y,p,F),M=new u(this.draco.HEAPF32.buffer,F,m).slice()}finally{this.draco._free(F)}return{value:M,size:d}}_deduceAttributeName(e,c){const u=e.unique_id;for(const[m,p]of Object.entries(c.extraAttributes||{}))if(p===u)return m;const d=e.attribute_type;for(const m in DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP)if(this.draco[m]===d)return DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP[m];const h=c.attributeNameEntry||"name";return e.metadata[h]?e.metadata[h].string:`CUSTOM_ATTRIBUTE_${u}`}_getTopLevelMetadata(e){const c=this.decoder.GetMetadata(e);return this._getDracoMetadata(c)}_getAttributeMetadata(e,c){const u=this.decoder.GetAttributeMetadata(e,c);return this._getDracoMetadata(u)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const c={},u=this.metadataQuerier.NumEntries(e);for(let d=0;d<u;d++){const h=this.metadataQuerier.GetEntryName(e,d);c[h]=this._getDracoMetadataField(e,h)}return c}_getDracoMetadataField(e,c){const u=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,c,u);const d=getInt32Array(u);return{int:this.metadataQuerier.GetIntEntry(e,c),string:this.metadataQuerier.GetStringEntry(e,c),double:this.metadataQuerier.GetDoubleEntry(e,c),intArray:d}}finally{this.draco.destroy(u)}}_disableAttributeTransforms(e){const{quantizedAttributes:c=[],octahedronAttributes:u=[]}=e,d=[...c,...u];for(const h of d)this.decoder.SkipAttributeTransform(this.draco[h])}_getQuantizationTransform(e,c){const{quantizedAttributes:u=[]}=c,d=e.attribute_type();if(u.map(m=>this.decoder[m]).includes(d)){const m=new this.draco.AttributeQuantizationTransform;try{if(m.InitFromAttribute(e))return{quantization_bits:m.quantization_bits(),range:m.range(),min_values:new Float32Array([1,2,3]).map(p=>m.min_value(p))}}finally{this.draco.destroy(m)}}return null}_getOctahedronTransform(e,c){const{octahedronAttributes:u=[]}=c,d=e.attribute_type();if(u.map(m=>this.decoder[m]).includes(d)){const m=new this.draco.AttributeQuantizationTransform;try{if(m.InitFromAttribute(e))return{quantization_bits:m.quantization_bits()}}finally{this.draco.destroy(m)}}return null}}function getDracoDataType(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function getInt32Array(t){const e=t.size(),c=new Int32Array(e);for(let u=0;u<e;u++)c[u]=t.GetValue(u);return c}function getUint32Array(t){const e=t.size(),c=new Int32Array(e);for(let u=0;u<e;u++)c[u]=t.GetValue(u);return c}const DRACO_DECODER_VERSION="1.5.6",DRACO_ENCODER_VERSION="1.4.1",STATIC_DECODER_URL=`https://www.gstatic.com/draco/versioned/decoders/${DRACO_DECODER_VERSION}`,DRACO_EXTERNAL_LIBRARIES={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},DRACO_EXTERNAL_LIBRARY_URLS={[DRACO_EXTERNAL_LIBRARIES.DECODER]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.DECODER}`,[DRACO_EXTERNAL_LIBRARIES.DECODER_WASM]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.DECODER_WASM}`,[DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER}`,[DRACO_EXTERNAL_LIBRARIES.ENCODER]:`https://raw.githubusercontent.com/google/draco/${DRACO_ENCODER_VERSION}/javascript/${DRACO_EXTERNAL_LIBRARIES.ENCODER}`};let loadDecoderPromise;async function loadDracoDecoderModule(t){const e=t.modules||{};return e.draco3d?loadDecoderPromise||=e.draco3d.createDecoderModule({}).then(c=>({draco:c})):loadDecoderPromise||=loadDracoDecoder(t),await loadDecoderPromise}async function loadDracoDecoder(t){let e,c;switch(t.draco&&t.draco.decoderType){case"js":e=await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER],"draco",t,DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER);break;case"wasm":default:[e,c]=await Promise.all([await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.DECODER],"draco",t,DRACO_EXTERNAL_LIBRARIES.DECODER),await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.DECODER_WASM],"draco",t,DRACO_EXTERNAL_LIBRARIES.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await initializeDracoDecoder(e,c)}function initializeDracoDecoder(t,e){const c={};return e&&(c.wasmBinary=e),new Promise(u=>{t({...c,onModuleLoaded:d=>u({draco:d})})})}const DracoLoader={...DracoLoader$1,parse:parse$1};async function parse$1(t,e){const{draco:c}=await loadDracoDecoderModule(e),u=new DracoParser(c);try{return u.parseSync(t,e?.draco)}finally{u.destroy()}}function getGLTFAccessors(t){const e={};for(const c in t){const u=t[c];if(c!=="indices"){const d=getGLTFAccessor(u);e[c]=d}}return e}function getGLTFAccessor(t){const{buffer:e,size:c,count:u}=getAccessorData(t);return{value:e,size:c,byteOffset:0,count:u,type:getAccessorTypeFromSize(c),componentType:getComponentTypeFromArray(e)}}function getAccessorData(t){let e=t,c=1,u=0;return t&&t.value&&(e=t.value,c=t.size||1),e&&(ArrayBuffer.isView(e)||(e=toTypedArray(e,Float32Array)),u=e.length/c),{buffer:e,size:c,count:u}}function toTypedArray(t,e,c=!1){return t?Array.isArray(t)?new e(t):c&&!(t instanceof e)?new e(t):t:null}const KHR_DRACO_MESH_COMPRESSION="KHR_draco_mesh_compression",name$4=KHR_DRACO_MESH_COMPRESSION;function preprocess$1(t,e,c){const u=new GLTFScenegraph(t);for(const d of makeMeshPrimitiveIterator(u))u.getObjectExtension(d,KHR_DRACO_MESH_COMPRESSION)}async function decode$4(t,e,c){if(!e?.gltf?.decompressMeshes)return;const u=new GLTFScenegraph(t),d=[];for(const h of makeMeshPrimitiveIterator(u))u.getObjectExtension(h,KHR_DRACO_MESH_COMPRESSION)&&d.push(decompressPrimitive(u,h,e,c));await Promise.all(d),u.removeExtension(KHR_DRACO_MESH_COMPRESSION)}function encode$3(t,e={}){const c=new GLTFScenegraph(t);for(const u of c.json.meshes||[])compressMesh(),c.addRequiredExtension(KHR_DRACO_MESH_COMPRESSION)}async function decompressPrimitive(t,e,c,u){const d=t.getObjectExtension(e,KHR_DRACO_MESH_COMPRESSION);if(!d)return;const h=t.getTypedArrayForBufferView(d.bufferView),m=sliceArrayBuffer(h.buffer,h.byteOffset),p={...c};delete p["3d-tiles"];const y=await parseFromContext(m,DracoLoader,p,u),M=getGLTFAccessors(y.attributes);for(const[F,L]of Object.entries(M))if(F in e.attributes){const K=e.attributes[F],X=t.getAccessor(K);X?.min&&X?.max&&(L.min=X.min,L.max=X.max)}e.attributes=M,y.indices&&(e.indices=getGLTFAccessor(y.indices)),t.removeObjectExtension(e,KHR_DRACO_MESH_COMPRESSION),checkPrimitive(e)}function compressMesh(t,e,c=4,u,d){if(!u.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function checkPrimitive(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*makeMeshPrimitiveIterator(t){for(const e of t.json.meshes||[])for(const c of e.primitives)yield c}const KHR_draco_mesh_compression=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$4,encode:encode$3,name:name$4,preprocess:preprocess$1},Symbol.toStringTag,{value:"Module"})),DEFAULT_CONFIG={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...DEFAULT_CONFIG}};const config=globalThis.mathgl.config;function formatValue(t,{precision:e=config.precision}={}){return t=round(t),`${parseFloat(t.toPrecision(e))}`}function isArray(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function equals(t,e,c){const u=config.EPSILON;try{if(t===e)return!0;if(isArray(t)&&isArray(e)){if(t.length!==e.length)return!1;for(let d=0;d<t.length;++d)if(!equals(t[d],e[d]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=config.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{config.EPSILON=u}}function round(t){return Math.round(t/config.EPSILON)*config.EPSILON}class MathArray extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,c=0){for(let u=0;u<this.ELEMENTS;++u)this[u]=e[u+c];return this.check()}toArray(e=[],c=0){for(let u=0;u<this.ELEMENTS;++u)e[c+u]=this[u];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:isArray(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(e){let c="";for(let u=0;u<this.ELEMENTS;++u)c+=(u>0?", ":"")+formatValue(this[u],e);return`${e.printTypes?this.constructor.name:""}[${c}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let c=0;c<this.ELEMENTS;++c)if(!equals(this[c],e[c]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let c=0;c<this.ELEMENTS;++c)if(this[c]!==e[c])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,c,u){if(u===void 0)return this.lerp(this,e,c);for(let d=0;d<this.ELEMENTS;++d){const h=e[d],m=typeof c=="number"?c:c[d];this[d]=h+u*(m-h)}return this.check()}min(e){for(let c=0;c<this.ELEMENTS;++c)this[c]=Math.min(e[c],this[c]);return this.check()}max(e){for(let c=0;c<this.ELEMENTS;++c)this[c]=Math.max(e[c],this[c]);return this.check()}clamp(e,c){for(let u=0;u<this.ELEMENTS;++u)this[u]=Math.min(Math.max(this[u],e[u]),c[u]);return this.check()}add(...e){for(const c of e)for(let u=0;u<this.ELEMENTS;++u)this[u]+=c[u];return this.check()}subtract(...e){for(const c of e)for(let u=0;u<this.ELEMENTS;++u)this[u]-=c[u];return this.check()}scale(e){if(typeof e=="number")for(let c=0;c<this.ELEMENTS;++c)this[c]*=e;else for(let c=0;c<this.ELEMENTS&&c<e.length;++c)this[c]*=e[c];return this.check()}multiplyByScalar(e){for(let c=0;c<this.ELEMENTS;++c)this[c]*=e;return this.check()}check(){if(config.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let c=0;c<this.ELEMENTS;++c)e=e&&Number.isFinite(this[c]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let c=0;c<this.ELEMENTS;++c)this[c]=e;return this.check()}addScalar(e){for(let c=0;c<this.ELEMENTS;++c)this[c]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let c=0;c<this.ELEMENTS;++c)this[c]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,c){for(let u=0;u<this.ELEMENTS;++u)this[u]=Math.min(Math.max(this[u],e),c);return this.check()}get elements(){return this}}function validateVector(t,e){if(t.length!==e)return!1;for(let c=0;c<t.length;++c)if(!Number.isFinite(t[c]))return!1;return!0}function checkNumber(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function checkVector(t,e,c=""){if(config.debug&&!validateVector(t,e))throw new Error(`math.gl: ${c} some fields set to invalid numbers'`);return t}function assert$1(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Vector extends MathArray{get x(){return this[0]}set x(e){this[0]=checkNumber(e)}get y(){return this[1]}set y(e){this[1]=checkNumber(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let c=0;c<this.ELEMENTS;++c)e+=this[c]*this[c];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let c=0;for(let u=0;u<this.ELEMENTS;++u){const d=this[u]-e[u];c+=d*d}return checkNumber(c)}dot(e){let c=0;for(let u=0;u<this.ELEMENTS;++u)c+=this[u]*e[u];return checkNumber(c)}normalize(){const e=this.magnitude();if(e!==0)for(let c=0;c<this.ELEMENTS;++c)this[c]/=e;return this.check()}multiply(...e){for(const c of e)for(let u=0;u<this.ELEMENTS;++u)this[u]*=c[u];return this.check()}divide(...e){for(const c of e)for(let u=0;u<this.ELEMENTS;++u)this[u]/=c[u];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return assert$1(e>=0&&e<this.ELEMENTS,"index is out of range"),checkNumber(this[e])}setComponent(e,c){return assert$1(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=c,this.check()}addVectors(e,c){return this.copy(e).add(c)}subVectors(e,c){return this.copy(e).subtract(c)}multiplyVectors(e,c){return this.copy(e).multiply(c)}addScaledVector(e,c){return this.add(new this.constructor(e).multiplyScalar(c))}}let ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;function create$1(){const t=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function transformMat3$1(t,e,c){const u=e[0],d=e[1];return t[0]=c[0]*u+c[3]*d+c[6],t[1]=c[1]*u+c[4]*d+c[7],t}(function(){const t=create$1();return function(e,c,u,d,h,m){let p,y;for(c||(c=2),u||(u=0),d?y=Math.min(d*c+u,e.length):y=e.length,p=u;p<y;p+=c)t[0]=e[p],t[1]=e[p+1],h(t,t,m),e[p]=t[0],e[p+1]=t[1];return e}})();function vec3_transformMat4AsVector(t,e,c){const u=e[0],d=e[1],h=e[2],m=c[3]*u+c[7]*d+c[11]*h||1;return t[0]=(c[0]*u+c[4]*d+c[8]*h)/m,t[1]=(c[1]*u+c[5]*d+c[9]*h)/m,t[2]=(c[2]*u+c[6]*d+c[10]*h)/m,t}function vec3_transformMat2(t,e,c){const u=e[0],d=e[1];return t[0]=c[0]*u+c[2]*d,t[1]=c[1]*u+c[3]*d,t[2]=e[2],t}function vec4_transformMat3(t,e,c){const u=e[0],d=e[1],h=e[2];return t[0]=c[0]*u+c[3]*d+c[6]*h,t[1]=c[1]*u+c[4]*d+c[7]*h,t[2]=c[2]*u+c[5]*d+c[8]*h,t[3]=e[3],t}function create(){const t=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cross(t,e,c){const u=e[0],d=e[1],h=e[2],m=c[0],p=c[1],y=c[2];return t[0]=d*y-h*p,t[1]=h*m-u*y,t[2]=u*p-d*m,t}function transformMat4(t,e,c){const u=e[0],d=e[1],h=e[2];let m=c[3]*u+c[7]*d+c[11]*h+c[15];return m=m||1,t[0]=(c[0]*u+c[4]*d+c[8]*h+c[12])/m,t[1]=(c[1]*u+c[5]*d+c[9]*h+c[13])/m,t[2]=(c[2]*u+c[6]*d+c[10]*h+c[14])/m,t}function transformMat3(t,e,c){const u=e[0],d=e[1],h=e[2];return t[0]=u*c[0]+d*c[3]+h*c[6],t[1]=u*c[1]+d*c[4]+h*c[7],t[2]=u*c[2]+d*c[5]+h*c[8],t}function transformQuat(t,e,c){const u=c[0],d=c[1],h=c[2],m=c[3],p=e[0],y=e[1],M=e[2];let F=d*M-h*y,L=h*p-u*M,K=u*y-d*p,X=d*K-h*L,j=h*F-u*K,Q=u*L-d*F;const z=m*2;return F*=z,L*=z,K*=z,X*=2,j*=2,Q*=2,t[0]=p+F+X,t[1]=y+L+j,t[2]=M+K+Q,t}function rotateX(t,e,c,u){const d=[],h=[];return d[0]=e[0]-c[0],d[1]=e[1]-c[1],d[2]=e[2]-c[2],h[0]=d[0],h[1]=d[1]*Math.cos(u)-d[2]*Math.sin(u),h[2]=d[1]*Math.sin(u)+d[2]*Math.cos(u),t[0]=h[0]+c[0],t[1]=h[1]+c[1],t[2]=h[2]+c[2],t}function rotateY(t,e,c,u){const d=[],h=[];return d[0]=e[0]-c[0],d[1]=e[1]-c[1],d[2]=e[2]-c[2],h[0]=d[2]*Math.sin(u)+d[0]*Math.cos(u),h[1]=d[1],h[2]=d[2]*Math.cos(u)-d[0]*Math.sin(u),t[0]=h[0]+c[0],t[1]=h[1]+c[1],t[2]=h[2]+c[2],t}function rotateZ(t,e,c,u){const d=[],h=[];return d[0]=e[0]-c[0],d[1]=e[1]-c[1],d[2]=e[2]-c[2],h[0]=d[0]*Math.cos(u)-d[1]*Math.sin(u),h[1]=d[0]*Math.sin(u)+d[1]*Math.cos(u),h[2]=d[2],t[0]=h[0]+c[0],t[1]=h[1]+c[1],t[2]=h[2]+c[2],t}function angle(t,e){const c=t[0],u=t[1],d=t[2],h=e[0],m=e[1],p=e[2],y=Math.sqrt((c*c+u*u+d*d)*(h*h+m*m+p*p)),M=y&&dot(t,e)/y;return Math.acos(Math.min(Math.max(M,-1),1))}(function(){const t=create();return function(e,c,u,d,h,m){let p,y;for(c||(c=3),u||(u=0),d?y=Math.min(d*c+u,e.length):y=e.length,p=u;p<y;p+=c)t[0]=e[p],t[1]=e[p+1],t[2]=e[p+2],h(t,t,m),e[p]=t[0],e[p+1]=t[1],e[p+2]=t[2];return e}})();const ORIGIN=[0,0,0];let ZERO;class Vector3 extends Vector{static get ZERO(){return ZERO||(ZERO=new Vector3(0,0,0),Object.freeze(ZERO)),ZERO}constructor(e=0,c=0,u=0){super(-0,-0,-0),arguments.length===1&&isArray(e)?this.copy(e):(config.debug&&(checkNumber(e),checkNumber(c),checkNumber(u)),this[0]=e,this[1]=c,this[2]=u)}set(e,c,u){return this[0]=e,this[1]=c,this[2]=u,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return config.debug&&(checkNumber(e.x),checkNumber(e.y),checkNumber(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=checkNumber(e)}angle(e){return angle(this,e)}cross(e){return cross(this,this,e),this.check()}rotateX({radians:e,origin:c=ORIGIN}){return rotateX(this,this,c,e),this.check()}rotateY({radians:e,origin:c=ORIGIN}){return rotateY(this,this,c,e),this.check()}rotateZ({radians:e,origin:c=ORIGIN}){return rotateZ(this,this,c,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return transformMat4(this,this,e),this.check()}transformAsVector(e){return vec3_transformMat4AsVector(this,this,e),this.check()}transformByMatrix3(e){return transformMat3(this,this,e),this.check()}transformByMatrix2(e){return vec3_transformMat2(this,this,e),this.check()}transformByQuaternion(e){return transformQuat(this,this,e),this.check()}}class Matrix extends MathArray{toString(){let e="[";if(config.printRowMajor){e+="row-major:";for(let c=0;c<this.RANK;++c)for(let u=0;u<this.RANK;++u)e+=` ${this[u*this.RANK+c]}`}else{e+="column-major:";for(let c=0;c<this.ELEMENTS;++c)e+=` ${this[c]}`}return e+="]",e}getElementIndex(e,c){return c*this.RANK+e}getElement(e,c){return this[c*this.RANK+e]}setElement(e,c,u){return this[c*this.RANK+e]=checkNumber(u),this}getColumn(e,c=new Array(this.RANK).fill(-0)){const u=e*this.RANK;for(let d=0;d<this.RANK;++d)c[d]=this[u+d];return c}setColumn(e,c){const u=e*this.RANK;for(let d=0;d<this.RANK;++d)this[u+d]=c[d];return this}}function transpose(t,e){if(t===e){const c=e[1],u=e[2],d=e[5];t[1]=e[3],t[2]=e[6],t[3]=c,t[5]=e[7],t[6]=u,t[7]=d}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function invert(t,e){const c=e[0],u=e[1],d=e[2],h=e[3],m=e[4],p=e[5],y=e[6],M=e[7],F=e[8],L=F*m-p*M,K=-F*h+p*y,X=M*h-m*y;let j=c*L+u*K+d*X;return j?(j=1/j,t[0]=L*j,t[1]=(-F*u+d*M)*j,t[2]=(p*u-d*m)*j,t[3]=K*j,t[4]=(F*c-d*y)*j,t[5]=(-p*c+d*h)*j,t[6]=X*j,t[7]=(-M*c+u*y)*j,t[8]=(m*c-u*h)*j,t):null}function determinant(t){const e=t[0],c=t[1],u=t[2],d=t[3],h=t[4],m=t[5],p=t[6],y=t[7],M=t[8];return e*(M*h-m*y)+c*(-M*d+m*p)+u*(y*d-h*p)}function multiply(t,e,c){const u=e[0],d=e[1],h=e[2],m=e[3],p=e[4],y=e[5],M=e[6],F=e[7],L=e[8],K=c[0],X=c[1],j=c[2],Q=c[3],z=c[4],re=c[5],ie=c[6],te=c[7],ge=c[8];return t[0]=K*u+X*m+j*M,t[1]=K*d+X*p+j*F,t[2]=K*h+X*y+j*L,t[3]=Q*u+z*m+re*M,t[4]=Q*d+z*p+re*F,t[5]=Q*h+z*y+re*L,t[6]=ie*u+te*m+ge*M,t[7]=ie*d+te*p+ge*F,t[8]=ie*h+te*y+ge*L,t}function translate(t,e,c){const u=e[0],d=e[1],h=e[2],m=e[3],p=e[4],y=e[5],M=e[6],F=e[7],L=e[8],K=c[0],X=c[1];return t[0]=u,t[1]=d,t[2]=h,t[3]=m,t[4]=p,t[5]=y,t[6]=K*u+X*m+M,t[7]=K*d+X*p+F,t[8]=K*h+X*y+L,t}function rotate(t,e,c){const u=e[0],d=e[1],h=e[2],m=e[3],p=e[4],y=e[5],M=e[6],F=e[7],L=e[8],K=Math.sin(c),X=Math.cos(c);return t[0]=X*u+K*m,t[1]=X*d+K*p,t[2]=X*h+K*y,t[3]=X*m-K*u,t[4]=X*p-K*d,t[5]=X*y-K*h,t[6]=M,t[7]=F,t[8]=L,t}function scale(t,e,c){const u=c[0],d=c[1];return t[0]=u*e[0],t[1]=u*e[1],t[2]=u*e[2],t[3]=d*e[3],t[4]=d*e[4],t[5]=d*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function fromQuat(t,e){const c=e[0],u=e[1],d=e[2],h=e[3],m=c+c,p=u+u,y=d+d,M=c*m,F=u*m,L=u*p,K=d*m,X=d*p,j=d*y,Q=h*m,z=h*p,re=h*y;return t[0]=1-L-j,t[3]=F-re,t[6]=K+z,t[1]=F+re,t[4]=1-M-j,t[7]=X-Q,t[2]=K-z,t[5]=X+Q,t[8]=1-M-L,t}var INDICES;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(INDICES||(INDICES={}));const IDENTITY_MATRIX=Object.freeze([1,0,0,0,1,0,0,0,1]);class Matrix3 extends Matrix{static get IDENTITY(){return getIdentityMatrix()}static get ZERO(){return getZeroMatrix()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return INDICES}constructor(e,...c){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):c.length>0?this.copy([e,...c]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(IDENTITY_MATRIX)}fromObject(e){return this.check()}fromQuaternion(e){return fromQuat(this,e),this.check()}set(e,c,u,d,h,m,p,y,M){return this[0]=e,this[1]=c,this[2]=u,this[3]=d,this[4]=h,this[5]=m,this[6]=p,this[7]=y,this[8]=M,this.check()}setRowMajor(e,c,u,d,h,m,p,y,M){return this[0]=e,this[1]=d,this[2]=p,this[3]=c,this[4]=h,this[5]=y,this[6]=u,this[7]=m,this[8]=M,this.check()}determinant(){return determinant(this)}transpose(){return transpose(this,this),this.check()}invert(){return invert(this,this),this.check()}multiplyLeft(e){return multiply(this,e,this),this.check()}multiplyRight(e){return multiply(this,this,e),this.check()}rotate(e){return rotate(this,this,e),this.check()}scale(e){return Array.isArray(e)?scale(this,this,e):scale(this,this,[e,e]),this.check()}translate(e){return translate(this,this,e),this.check()}transform(e,c){let u;switch(e.length){case 2:u=transformMat3$1(c||[-0,-0],e,this);break;case 3:u=transformMat3(c||[-0,-0,-0],e,this);break;case 4:u=vec4_transformMat3(c||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(u,e.length),u}transformVector(e,c){return this.transform(e,c)}transformVector2(e,c){return this.transform(e,c)}transformVector3(e,c){return this.transform(e,c)}}let ZERO_MATRIX3,IDENTITY_MATRIX3=null;function getZeroMatrix(){return ZERO_MATRIX3||(ZERO_MATRIX3=new Matrix3([0,0,0,0,0,0,0,0,0]),Object.freeze(ZERO_MATRIX3)),ZERO_MATRIX3}function getIdentityMatrix(){return IDENTITY_MATRIX3||(IDENTITY_MATRIX3=new Matrix3,Object.freeze(IDENTITY_MATRIX3)),IDENTITY_MATRIX3}const KHR_TEXTURE_TRANSFORM="KHR_texture_transform",name$3=KHR_TEXTURE_TRANSFORM,scratchVector=new Vector3,scratchRotationMatrix=new Matrix3,scratchScaleMatrix=new Matrix3;async function decode$3(t,e){if(!new GLTFScenegraph(t).hasExtension(KHR_TEXTURE_TRANSFORM)||!e.gltf?.loadBuffers)return;const d=t.json.materials||[];for(let h=0;h<d.length;h++)transformTexCoords(h,t)}function transformTexCoords(t,e){const c=e.json.materials?.[t],u=[c?.pbrMetallicRoughness?.baseColorTexture,c?.emissiveTexture,c?.normalTexture,c?.occlusionTexture,c?.pbrMetallicRoughness?.metallicRoughnessTexture],d=[];for(const h of u)h&&h?.extensions?.[KHR_TEXTURE_TRANSFORM]&&transformPrimitives(e,t,h,d)}function transformPrimitives(t,e,c,u){const d=getTransformParameters(c,u);if(!d)return;const h=t.json.meshes||[];for(const m of h)for(const p of m.primitives){const y=p.material;Number.isFinite(y)&&e===y&&transformPrimitive(t,p,d)}}function getTransformParameters(t,e){const c=t.extensions?.[KHR_TEXTURE_TRANSFORM],{texCoord:u=0}=t,{texCoord:d=u}=c;if(!(e.findIndex(([m,p])=>m===u&&p===d)!==-1)){const m=makeTransformationMatrix(c);return u!==d&&(t.texCoord=d),e.push([u,d]),{originalTexCoord:u,texCoord:d,matrix:m}}return null}function transformPrimitive(t,e,c){const{originalTexCoord:u,texCoord:d,matrix:h}=c,m=e.attributes[`TEXCOORD_${u}`];if(Number.isFinite(m)){const p=t.json.accessors?.[m];if(p&&p.bufferView){const y=t.json.bufferViews?.[p.bufferView];if(y){const{arrayBuffer:M,byteOffset:F}=t.buffers[y.buffer],L=(F||0)+(p.byteOffset||0)+(y.byteOffset||0),{ArrayType:K,length:X}=getAccessorArrayTypeAndLength(p,y),j=BYTES[p.componentType],Q=COMPONENTS[p.type],z=y.byteStride||j*Q,re=new Float32Array(X);for(let ie=0;ie<p.count;ie++){const te=new K(M,L+ie*z,2);scratchVector.set(te[0],te[1],1),scratchVector.transformByMatrix3(h),re.set([scratchVector[0],scratchVector[1]],ie*Q)}u===d?updateGltf(p,y,t.buffers,re):createAttribute(d,p,e,t,re)}}}}function updateGltf(t,e,c,u){t.componentType=5126,c.push({arrayBuffer:u.buffer,byteOffset:0,byteLength:u.buffer.byteLength}),e.buffer=c.length-1,e.byteLength=u.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function createAttribute(t,e,c,u,d){u.buffers.push({arrayBuffer:d.buffer,byteOffset:0,byteLength:d.buffer.byteLength});const h=u.json.bufferViews;if(!h)return;h.push({buffer:u.buffers.length-1,byteLength:d.buffer.byteLength,byteOffset:0});const m=u.json.accessors;m&&(m.push({bufferView:h?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),c.attributes[`TEXCOORD_${t}`]=m.length-1)}function makeTransformationMatrix(t){const{offset:e=[0,0],rotation:c=0,scale:u=[1,1]}=t,d=new Matrix3().set(1,0,0,0,1,0,e[0],e[1],1),h=scratchRotationMatrix.set(Math.cos(c),Math.sin(c),0,-Math.sin(c),Math.cos(c),0,0,0,1),m=scratchScaleMatrix.set(u[0],0,0,0,u[1],0,0,0,1);return d.multiplyRight(h).multiplyRight(m)}const KHR_texture_transform=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$3,name:name$3},Symbol.toStringTag,{value:"Module"})),KHR_LIGHTS_PUNCTUAL="KHR_lights_punctual",name$2=KHR_LIGHTS_PUNCTUAL;async function decode$2(t){const e=new GLTFScenegraph(t),{json:c}=e,u=e.getExtension(KHR_LIGHTS_PUNCTUAL);u&&(e.json.lights=u.lights,e.removeExtension(KHR_LIGHTS_PUNCTUAL));for(const d of c.nodes||[]){const h=e.getObjectExtension(d,KHR_LIGHTS_PUNCTUAL);h&&(d.light=h.light),e.removeObjectExtension(d,KHR_LIGHTS_PUNCTUAL)}}async function encode$2(t){const e=new GLTFScenegraph(t),{json:c}=e;if(c.lights){const u=e.addExtension(KHR_LIGHTS_PUNCTUAL);assert$2(!u.lights),u.lights=c.lights,delete c.lights}if(e.json.lights){for(const u of e.json.lights){const d=u.node;e.addObjectExtension(d,KHR_LIGHTS_PUNCTUAL,u)}delete e.json.lights}}const KHR_lights_punctual=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$2,encode:encode$2,name:name$2},Symbol.toStringTag,{value:"Module"})),KHR_MATERIALS_UNLIT="KHR_materials_unlit",name$1=KHR_MATERIALS_UNLIT;async function decode$1(t){const e=new GLTFScenegraph(t),{json:c}=e;for(const u of c.materials||[])u.extensions&&u.extensions.KHR_materials_unlit&&(u.unlit=!0),e.removeObjectExtension(u,KHR_MATERIALS_UNLIT);e.removeExtension(KHR_MATERIALS_UNLIT)}function encode$1(t){const e=new GLTFScenegraph(t),{json:c}=e;if(e.materials)for(const u of c.materials||[])u.unlit&&(delete u.unlit,e.addObjectExtension(u,KHR_MATERIALS_UNLIT,{}),e.addExtension(KHR_MATERIALS_UNLIT))}const KHR_materials_unlit=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$1,encode:encode$1,name:name$1},Symbol.toStringTag,{value:"Module"})),KHR_TECHNIQUES_WEBGL="KHR_techniques_webgl",name=KHR_TECHNIQUES_WEBGL;async function decode(t){const e=new GLTFScenegraph(t),{json:c}=e,u=e.getExtension(KHR_TECHNIQUES_WEBGL);if(u){const d=resolveTechniques(u,e);for(const h of c.materials||[]){const m=e.getObjectExtension(h,KHR_TECHNIQUES_WEBGL);m&&(h.technique=Object.assign({},m,d[m.technique]),h.technique.values=resolveValues(h.technique,e)),e.removeObjectExtension(h,KHR_TECHNIQUES_WEBGL)}e.removeExtension(KHR_TECHNIQUES_WEBGL)}}async function encode(t,e){}function resolveTechniques(t,e){const{programs:c=[],shaders:u=[],techniques:d=[]}=t,h=new TextDecoder;return u.forEach(m=>{if(Number.isFinite(m.bufferView))m.code=h.decode(e.getTypedArrayForBufferView(m.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),c.forEach(m=>{m.fragmentShader=u[m.fragmentShader],m.vertexShader=u[m.vertexShader]}),d.forEach(m=>{m.program=c[m.program]}),d}function resolveValues(t,e){const c=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(u=>{t.uniforms[u].value&&!(u in c)&&(c[u]=t.uniforms[u].value)}),Object.keys(c).forEach(u=>{typeof c[u]=="object"&&c[u].index!==void 0&&(c[u].texture=e.getTexture(c[u].index))}),c}const KHR_techniques_webgl=Object.freeze(Object.defineProperty({__proto__:null,decode,encode,name},Symbol.toStringTag,{value:"Module"})),EXTENSIONS$1=[EXT_structural_metadata,EXT_mesh_features,EXT_meshopt_compression,EXT_texture_webp,KHR_texture_basisu,KHR_draco_mesh_compression,KHR_lights_punctual,KHR_materials_unlit,KHR_techniques_webgl,KHR_texture_transform,EXT_feature_metadata];function preprocessExtensions(t,e={},c){const u=EXTENSIONS$1.filter(d=>useExtension(d.name,e));for(const d of u)d.preprocess?.(t,e,c)}async function decodeExtensions(t,e={},c){const u=EXTENSIONS$1.filter(d=>useExtension(d.name,e));for(const d of u)await d.decode?.(t,e,c)}function useExtension(t,e){const c=e?.gltf?.excludeExtensions||{};return!(t in c&&!c[t])}const KHR_BINARY_GLTF="KHR_binary_glTF";function preprocess(t){const e=new GLTFScenegraph(t),{json:c}=e;for(const u of c.images||[]){const d=e.getObjectExtension(u,KHR_BINARY_GLTF);d&&Object.assign(u,d),e.removeObjectExtension(u,KHR_BINARY_GLTF)}c.buffers&&c.buffers[0]&&delete c.buffers[0].uri,e.removeExtension(KHR_BINARY_GLTF)}const GLTF_ARRAYS={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},GLTF_KEYS={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class GLTFV1Normalizer{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,c){this.json=e.json;const u=e.json;switch(u.asset&&u.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${u.asset.version}`);return}if(!c.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(u),this._convertTopLevelObjectsToArrays(u),preprocess(e),this._convertObjectIdsToArrayIndices(u),this._updateObjects(u),this._updateMaterial(u)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const c in GLTF_ARRAYS)this._convertTopLevelObjectToArray(e,c)}_convertTopLevelObjectToArray(e,c){const u=e[c];if(!(!u||Array.isArray(u))){e[c]=[];for(const d in u){const h=u[d];h.id=h.id||d;const m=e[c].length;e[c].push(h),this.idToIndexMap[c][d]=m}}}_convertObjectIdsToArrayIndices(e){for(const c in GLTF_ARRAYS)this._convertIdsToIndices(e,c);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const c of e.textures)this._convertTextureIds(c);for(const c of e.meshes)this._convertMeshIds(c);for(const c of e.nodes)this._convertNodeIds(c);for(const c of e.scenes)this._convertSceneIds(c)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const c of e.primitives){const{attributes:u,indices:d,material:h}=c;for(const m in u)u[m]=this._convertIdToIndex(u[m],"accessor");d&&(c.indices=this._convertIdToIndex(d,"accessor")),h&&(c.material=this._convertIdToIndex(h,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(c=>this._convertIdToIndex(c,"node"))),e.meshes&&(e.meshes=e.meshes.map(c=>this._convertIdToIndex(c,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(c=>this._convertIdToIndex(c,"node")))}_convertIdsToIndices(e,c){e[c]||(console.warn(`gltf v1: json doesn't contain attribute ${c}`),e[c]=[]);for(const u of e[c])for(const d in u){const h=u[d],m=this._convertIdToIndex(h,d);u[d]=m}}_convertIdToIndex(e,c){const u=GLTF_KEYS[c];if(u in this.idToIndexMap){const d=this.idToIndexMap[u][e];if(!Number.isFinite(d))throw new Error(`gltf v1: failed to resolve ${c} with id ${e}`);return d}return e}_updateObjects(e){for(const c of this.json.buffers)delete c.type}_updateMaterial(e){for(const c of e.materials){c.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const u=c.values?.tex||c.values?.texture2d_0||c.values?.diffuseTex,d=e.textures.findIndex(h=>h.id===u);d!==-1&&(c.pbrMetallicRoughness.baseColorTexture={index:d})}}}function normalizeGLTFV1(t,e={}){return new GLTFV1Normalizer().normalize(t,e)}async function parseGLTF(t,e,c=0,u,d){return parseGLTFContainerSync(t,e,c,u),normalizeGLTFV1(t,{normalize:u?.gltf?.normalize}),preprocessExtensions(t,u,d),u?.gltf?.loadBuffers&&t.json.buffers&&await loadBuffers(t,u,d),u?.gltf?.loadImages&&await loadImages(t,u,d),await decodeExtensions(t,u,d),t}function parseGLTFContainerSync(t,e,c,u){if(u.uri&&(t.baseUri=u.uri),e instanceof ArrayBuffer&&!isGLB(e,c,u)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=parseJSON(e);else if(e instanceof ArrayBuffer){const m={};c=parseGLBSync(m,e,c,u.glb),assert$2(m.type==="glTF",`Invalid GLB magic string ${m.type}`),t._glb=m,t.json=m.json}else assert$2(!1,"GLTF: must be ArrayBuffer or string");const d=t.json.buffers||[];if(t.buffers=new Array(d.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:m}=t._glb;t.buffers[0]={arrayBuffer:m[0].arrayBuffer,byteOffset:m[0].byteOffset,byteLength:m[0].byteLength}}const h=t.json.images||[];t.images=new Array(h.length).fill({})}async function loadBuffers(t,e,c){const u=t.json.buffers||[];for(let d=0;d<u.length;++d){const h=u[d];if(h.uri){const{fetch:m}=c;assert$2(m);const p=resolveUrl(h.uri,e),M=await(await c?.fetch?.(p))?.arrayBuffer?.();t.buffers[d]={arrayBuffer:M,byteOffset:0,byteLength:M.byteLength},delete h.uri}else t.buffers[d]===null&&(t.buffers[d]={arrayBuffer:new ArrayBuffer(h.byteLength),byteOffset:0,byteLength:h.byteLength})}}async function loadImages(t,e,c){const u=getReferencesImageIndices(t),d=t.json.images||[],h=[];for(const m of u)h.push(loadImage(t,d[m],m,e,c));return await Promise.all(h)}function getReferencesImageIndices(t){const e=new Set,c=t.json.textures||[];for(const u of c)u.source!==void 0&&e.add(u.source);return Array.from(e).sort()}async function loadImage(t,e,c,u,d){let h;if(e.uri&&!e.hasOwnProperty("bufferView")){const p=resolveUrl(e.uri,u),{fetch:y}=d;h=await(await y(p)).arrayBuffer(),e.bufferView={data:h}}if(Number.isFinite(e.bufferView)){const p=getTypedArrayForBufferView(t.json,t.buffers,e.bufferView);h=sliceArrayBuffer(p.buffer,p.byteOffset,p.byteLength)}assert$2(h,"glTF image has no data");let m=await parseFromContext(h,[ImageLoader$1,BasisLoader],{...u,mimeType:e.mimeType,basis:u.basis||{format:selectSupportedBasisFormat()}},d);m&&m[0]&&(m={compressed:!0,mipmaps:!1,width:m[0].width,height:m[0].height,data:m[0]}),t.images=t.images||[],t.images[c]=m}const GLTFLoader={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:VERSION$3,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function parse(t,e={},c){e={...GLTFLoader.options,...e},e.gltf={...GLTFLoader.options.gltf,...e.gltf};const{byteOffset:u=0}=e;return await parseGLTF({},t,u,e,c)}const VERSION="4.2.2";function assert(t,e){if(!t)throw new Error("loader assertion failed.")}const isBrowser=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),matches=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);const parseImageNode=globalThis.loaders?.parseImageNode,IMAGE_SUPPORTED=typeof Image<"u",IMAGE_BITMAP_SUPPORTED=typeof ImageBitmap<"u",NODE_IMAGE_SUPPORTED=!!parseImageNode,DATA_SUPPORTED=isBrowser?!0:NODE_IMAGE_SUPPORTED;function isImageTypeSupported(t){switch(t){case"auto":return IMAGE_BITMAP_SUPPORTED||IMAGE_SUPPORTED||DATA_SUPPORTED;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED;case"image":return IMAGE_SUPPORTED;case"data":return DATA_SUPPORTED;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function getDefaultImageType(){if(IMAGE_BITMAP_SUPPORTED)return"imagebitmap";if(IMAGE_SUPPORTED)return"image";if(DATA_SUPPORTED)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType(t){const e=getImageTypeOrNull(t);if(!e)throw new Error("Not an image");return e}function getImageData(t){switch(getImageType(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),c=e.getContext("2d");if(!c)throw new Error("getImageData");return e.width=t.width,e.height=t.height,c.drawImage(t,0,0),c.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function getImageTypeOrNull(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const SVG_DATA_URL_PATTERN=/^data:image\/svg\+xml/,SVG_URL_PATTERN=/\.svg((\?|#).*)?$/;function isSVG(t){return t&&(SVG_DATA_URL_PATTERN.test(t)||SVG_URL_PATTERN.test(t))}function getBlobOrSVGDataUrl(t,e){if(isSVG(e)){let u=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(u=unescape(encodeURIComponent(u)))}catch(h){throw new Error(h.message)}return`data:image/svg+xml;base64,${btoa(u)}`}return getBlob(t,e)}function getBlob(t,e){if(isSVG(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function parseToImage(t,e,c){const u=getBlobOrSVGDataUrl(t,c),d=self.URL||self.webkitURL,h=typeof u!="string"&&d.createObjectURL(u);try{return await loadToImage(h||u,e)}finally{h&&d.revokeObjectURL(h)}}async function loadToImage(t,e){const c=new Image;return c.src=t,e.image&&e.image.decode&&c.decode?(await c.decode(),c):await new Promise((u,d)=>{try{c.onload=()=>u(c),c.onerror=h=>{const m=h instanceof Error?h.message:"error";d(new Error(m))}}catch(h){d(h)}})}const EMPTY_OBJECT={};let imagebitmapOptionsSupported=!0;async function parseToImageBitmap(t,e,c){let u;isSVG(c)?u=await parseToImage(t,e,c):u=getBlob(t,c);const d=e&&e.imagebitmap;return await safeCreateImageBitmap(u,d)}async function safeCreateImageBitmap(t,e=null){if((isEmptyObject(e)||!imagebitmapOptionsSupported)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(c){console.warn(c),imagebitmapOptionsSupported=!1}return await createImageBitmap(t)}function isEmptyObject(t){for(const e in t||EMPTY_OBJECT)return!1;return!0}function getISOBMFFMediaType(t){return!checkString(t,"ftyp",4)||!(t[8]&96)?null:decodeMajorBrand(t)}function decodeMajorBrand(t){switch(getUTF8String(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function getUTF8String(t,e,c){return String.fromCharCode(...t.slice(e,c))}function stringToBytes(t){return[...t].map(e=>e.charCodeAt(0))}function checkString(t,e,c=0){const u=stringToBytes(e);for(let d=0;d<u.length;++d)if(u[d]!==t[d+c])return!1;return!0}const BIG_ENDIAN=!1,LITTLE_ENDIAN=!0;function getBinaryImageMetadata(t){const e=toDataView(t);return getPngMetadata(e)||getJpegMetadata(e)||getGifMetadata(e)||getBmpMetadata(e)||getISOBMFFMetadata(e)}function getISOBMFFMetadata(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),c=getISOBMFFMediaType(e);return c?{mimeType:c.mimeType,width:0,height:0}:null}function getPngMetadata(t){const e=toDataView(t);return e.byteLength>=24&&e.getUint32(0,BIG_ENDIAN)===2303741511?{mimeType:"image/png",width:e.getUint32(16,BIG_ENDIAN),height:e.getUint32(20,BIG_ENDIAN)}:null}function getGifMetadata(t){const e=toDataView(t);return e.byteLength>=10&&e.getUint32(0,BIG_ENDIAN)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,LITTLE_ENDIAN),height:e.getUint16(8,LITTLE_ENDIAN)}:null}function getBmpMetadata(t){const e=toDataView(t);return e.byteLength>=14&&e.getUint16(0,BIG_ENDIAN)===16973&&e.getUint32(2,LITTLE_ENDIAN)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,LITTLE_ENDIAN),height:e.getUint32(22,LITTLE_ENDIAN)}:null}function getJpegMetadata(t){const e=toDataView(t);if(!(e.byteLength>=3&&e.getUint16(0,BIG_ENDIAN)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:u,sofMarkers:d}=getJpegMarkers();let h=2;for(;h+9<e.byteLength;){const m=e.getUint16(h,BIG_ENDIAN);if(d.has(m))return{mimeType:"image/jpeg",height:e.getUint16(h+5,BIG_ENDIAN),width:e.getUint16(h+7,BIG_ENDIAN)};if(!u.has(m))return null;h+=2,h+=e.getUint16(h,BIG_ENDIAN)}return null}function getJpegMarkers(){const t=new Set([65499,65476,65484,65501,65534]);for(let c=65504;c<65520;++c)t.add(c);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function toDataView(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function parseToNodeImage(t,e){const{mimeType:c}=getBinaryImageMetadata(t)||{},u=globalThis.loaders?.parseImageNode;return assert(u),await u(t,c)}async function parseImage(t,e,c){e=e||{};const d=(e.image||{}).type||"auto",{url:h}=c||{},m=getLoadableImageType(d);let p;switch(m){case"imagebitmap":p=await parseToImageBitmap(t,e,h);break;case"image":p=await parseToImage(t,e,h);break;case"data":p=await parseToNodeImage(t);break;default:assert(!1)}return d==="data"&&(p=getImageData(p)),p}function getLoadableImageType(t){switch(t){case"auto":case"data":return getDefaultImageType();default:return isImageTypeSupported(t),t}}const EXTENSIONS=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],MIME_TYPES=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DEFAULT_IMAGE_LOADER_OPTIONS={image:{type:"auto",decode:!0}},ImageLoader={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VERSION,mimeTypes:MIME_TYPES,extensions:EXTENSIONS,parse:parseImage,tests:[t=>!!getBinaryImageMetadata(new DataView(t))],options:DEFAULT_IMAGE_LOADER_OPTIONS};function wrapConstructor(t,e){return class extends t{constructor(...c){super(...c),e(this)}}}const ZeroArray=wrapConstructor(Array,t=>t.fill(0));let EPSILON=1e-6;function getAPIImpl$5(t){function e(A=0,E=0){const g=new t(2);return A!==void 0&&(g[0]=A,E!==void 0&&(g[1]=E)),g}const c=e;function u(A,E,g){const B=g??new t(2);return B[0]=A,B[1]=E,B}function d(A,E){const g=E??new t(2);return g[0]=Math.ceil(A[0]),g[1]=Math.ceil(A[1]),g}function h(A,E){const g=E??new t(2);return g[0]=Math.floor(A[0]),g[1]=Math.floor(A[1]),g}function m(A,E){const g=E??new t(2);return g[0]=Math.round(A[0]),g[1]=Math.round(A[1]),g}function p(A,E=0,g=1,B){const w=B??new t(2);return w[0]=Math.min(g,Math.max(E,A[0])),w[1]=Math.min(g,Math.max(E,A[1])),w}function y(A,E,g){const B=g??new t(2);return B[0]=A[0]+E[0],B[1]=A[1]+E[1],B}function M(A,E,g,B){const w=B??new t(2);return w[0]=A[0]+E[0]*g,w[1]=A[1]+E[1]*g,w}function F(A,E){const g=A[0],B=A[1],w=E[0],v=E[1],U=Math.sqrt(g*g+B*B),_=Math.sqrt(w*w+v*v),T=U*_,R=T&&Oe(A,E)/T;return Math.acos(R)}function L(A,E,g){const B=g??new t(2);return B[0]=A[0]-E[0],B[1]=A[1]-E[1],B}const K=L;function X(A,E){return Math.abs(A[0]-E[0])<EPSILON&&Math.abs(A[1]-E[1])<EPSILON}function j(A,E){return A[0]===E[0]&&A[1]===E[1]}function Q(A,E,g,B){const w=B??new t(2);return w[0]=A[0]+g*(E[0]-A[0]),w[1]=A[1]+g*(E[1]-A[1]),w}function z(A,E,g,B){const w=B??new t(2);return w[0]=A[0]+g[0]*(E[0]-A[0]),w[1]=A[1]+g[1]*(E[1]-A[1]),w}function re(A,E,g){const B=g??new t(2);return B[0]=Math.max(A[0],E[0]),B[1]=Math.max(A[1],E[1]),B}function ie(A,E,g){const B=g??new t(2);return B[0]=Math.min(A[0],E[0]),B[1]=Math.min(A[1],E[1]),B}function te(A,E,g){const B=g??new t(2);return B[0]=A[0]*E,B[1]=A[1]*E,B}const ge=te;function Be(A,E,g){const B=g??new t(2);return B[0]=A[0]/E,B[1]=A[1]/E,B}function Ge(A,E){const g=E??new t(2);return g[0]=1/A[0],g[1]=1/A[1],g}const Ue=Ge;function Fe(A,E,g){const B=g??new t(3),w=A[0]*E[1]-A[1]*E[0];return B[0]=0,B[1]=0,B[2]=w,B}function Oe(A,E){return A[0]*E[0]+A[1]*E[1]}function Ce(A){const E=A[0],g=A[1];return Math.sqrt(E*E+g*g)}const He=Ce;function he(A){const E=A[0],g=A[1];return E*E+g*g}const me=he;function fe(A,E){const g=A[0]-E[0],B=A[1]-E[1];return Math.sqrt(g*g+B*B)}const I=fe;function $(A,E){const g=A[0]-E[0],B=A[1]-E[1];return g*g+B*B}const O=$;function k(A,E){const g=E??new t(2),B=A[0],w=A[1],v=Math.sqrt(B*B+w*w);return v>1e-5?(g[0]=B/v,g[1]=w/v):(g[0]=0,g[1]=0),g}function q(A,E){const g=E??new t(2);return g[0]=-A[0],g[1]=-A[1],g}function Y(A,E){const g=E??new t(2);return g[0]=A[0],g[1]=A[1],g}const ae=Y;function ce(A,E,g){const B=g??new t(2);return B[0]=A[0]*E[0],B[1]=A[1]*E[1],B}const le=ce;function ne(A,E,g){const B=g??new t(2);return B[0]=A[0]/E[0],B[1]=A[1]/E[1],B}const se=ne;function Ae(A=1,E){const g=E??new t(2),B=Math.random()*2*Math.PI;return g[0]=Math.cos(B)*A,g[1]=Math.sin(B)*A,g}function G(A){const E=A??new t(2);return E[0]=0,E[1]=0,E}function J(A,E,g){const B=g??new t(2),w=A[0],v=A[1];return B[0]=w*E[0]+v*E[4]+E[12],B[1]=w*E[1]+v*E[5]+E[13],B}function C(A,E,g){const B=g??new t(2),w=A[0],v=A[1];return B[0]=E[0]*w+E[4]*v+E[8],B[1]=E[1]*w+E[5]*v+E[9],B}function b(A,E,g,B){const w=B??new t(2),v=A[0]-E[0],U=A[1]-E[1],_=Math.sin(g),T=Math.cos(g);return w[0]=v*T-U*_+E[0],w[1]=v*_+U*T+E[1],w}function S(A,E,g){const B=g??new t(2);return k(A,B),te(B,E,B)}function x(A,E,g){const B=g??new t(2);return Ce(A)>E?S(A,E,B):Y(A,B)}function V(A,E,g){const B=g??new t(2);return Q(A,E,.5,B)}return{create:e,fromValues:c,set:u,ceil:d,floor:h,round:m,clamp:p,add:y,addScaled:M,angle:F,subtract:L,sub:K,equalsApproximately:X,equals:j,lerp:Q,lerpV:z,max:re,min:ie,mulScalar:te,scale:ge,divScalar:Be,inverse:Ge,invert:Ue,cross:Fe,dot:Oe,length:Ce,len:He,lengthSq:he,lenSq:me,distance:fe,dist:I,distanceSq:$,distSq:O,normalize:k,negate:q,copy:Y,clone:ae,multiply:ce,mul:le,divide:ne,div:se,random:Ae,zero:G,transformMat4:J,transformMat3:C,rotate:b,setLength:S,truncate:x,midpoint:V}}const cache$5=new Map;function getAPI$5(t){let e=cache$5.get(t);return e||(e=getAPIImpl$5(t),cache$5.set(t,e)),e}function getAPIImpl$4(t){const e=getAPI$5(t);function c(I,$,O,k,q,Y,ae,ce,le){const ne=new t(12);return ne[3]=0,ne[7]=0,ne[11]=0,I!==void 0&&(ne[0]=I,$!==void 0&&(ne[1]=$,O!==void 0&&(ne[2]=O,k!==void 0&&(ne[4]=k,q!==void 0&&(ne[5]=q,Y!==void 0&&(ne[6]=Y,ae!==void 0&&(ne[8]=ae,ce!==void 0&&(ne[9]=ce,le!==void 0&&(ne[10]=le))))))))),ne}function u(I,$,O,k,q,Y,ae,ce,le,ne){const se=ne??new t(12);return se[0]=I,se[1]=$,se[2]=O,se[3]=0,se[4]=k,se[5]=q,se[6]=Y,se[7]=0,se[8]=ae,se[9]=ce,se[10]=le,se[11]=0,se}function d(I,$){const O=$??new t(12);return O[0]=I[0],O[1]=I[1],O[2]=I[2],O[3]=0,O[4]=I[4],O[5]=I[5],O[6]=I[6],O[7]=0,O[8]=I[8],O[9]=I[9],O[10]=I[10],O[11]=0,O}function h(I,$){const O=$??new t(12),k=I[0],q=I[1],Y=I[2],ae=I[3],ce=k+k,le=q+q,ne=Y+Y,se=k*ce,Ae=q*ce,G=q*le,J=Y*ce,C=Y*le,b=Y*ne,S=ae*ce,x=ae*le,V=ae*ne;return O[0]=1-G-b,O[1]=Ae+V,O[2]=J-x,O[3]=0,O[4]=Ae-V,O[5]=1-se-b,O[6]=C+S,O[7]=0,O[8]=J+x,O[9]=C-S,O[10]=1-se-G,O[11]=0,O}function m(I,$){const O=$??new t(12);return O[0]=-I[0],O[1]=-I[1],O[2]=-I[2],O[4]=-I[4],O[5]=-I[5],O[6]=-I[6],O[8]=-I[8],O[9]=-I[9],O[10]=-I[10],O}function p(I,$){const O=$??new t(12);return O[0]=I[0],O[1]=I[1],O[2]=I[2],O[4]=I[4],O[5]=I[5],O[6]=I[6],O[8]=I[8],O[9]=I[9],O[10]=I[10],O}const y=p;function M(I,$){return Math.abs(I[0]-$[0])<EPSILON&&Math.abs(I[1]-$[1])<EPSILON&&Math.abs(I[2]-$[2])<EPSILON&&Math.abs(I[4]-$[4])<EPSILON&&Math.abs(I[5]-$[5])<EPSILON&&Math.abs(I[6]-$[6])<EPSILON&&Math.abs(I[8]-$[8])<EPSILON&&Math.abs(I[9]-$[9])<EPSILON&&Math.abs(I[10]-$[10])<EPSILON}function F(I,$){return I[0]===$[0]&&I[1]===$[1]&&I[2]===$[2]&&I[4]===$[4]&&I[5]===$[5]&&I[6]===$[6]&&I[8]===$[8]&&I[9]===$[9]&&I[10]===$[10]}function L(I){const $=I??new t(12);return $[0]=1,$[1]=0,$[2]=0,$[4]=0,$[5]=1,$[6]=0,$[8]=0,$[9]=0,$[10]=1,$}function K(I,$){const O=$??new t(12);if(O===I){let G;return G=I[1],I[1]=I[4],I[4]=G,G=I[2],I[2]=I[8],I[8]=G,G=I[6],I[6]=I[9],I[9]=G,O}const k=I[0*4+0],q=I[0*4+1],Y=I[0*4+2],ae=I[1*4+0],ce=I[1*4+1],le=I[1*4+2],ne=I[2*4+0],se=I[2*4+1],Ae=I[2*4+2];return O[0]=k,O[1]=ae,O[2]=ne,O[4]=q,O[5]=ce,O[6]=se,O[8]=Y,O[9]=le,O[10]=Ae,O}function X(I,$){const O=$??new t(12),k=I[0*4+0],q=I[0*4+1],Y=I[0*4+2],ae=I[1*4+0],ce=I[1*4+1],le=I[1*4+2],ne=I[2*4+0],se=I[2*4+1],Ae=I[2*4+2],G=Ae*ce-le*se,J=-Ae*ae+le*ne,C=se*ae-ce*ne,b=1/(k*G+q*J+Y*C);return O[0]=G*b,O[1]=(-Ae*q+Y*se)*b,O[2]=(le*q-Y*ce)*b,O[4]=J*b,O[5]=(Ae*k-Y*ne)*b,O[6]=(-le*k+Y*ae)*b,O[8]=C*b,O[9]=(-se*k+q*ne)*b,O[10]=(ce*k-q*ae)*b,O}function j(I){const $=I[0],O=I[0*4+1],k=I[0*4+2],q=I[1*4+0],Y=I[1*4+1],ae=I[1*4+2],ce=I[2*4+0],le=I[2*4+1],ne=I[2*4+2];return $*(Y*ne-le*ae)-q*(O*ne-le*k)+ce*(O*ae-Y*k)}const Q=X;function z(I,$,O){const k=O??new t(12),q=I[0],Y=I[1],ae=I[2],ce=I[4],le=I[5],ne=I[6],se=I[8],Ae=I[9],G=I[10],J=$[0],C=$[1],b=$[2],S=$[4],x=$[5],V=$[6],A=$[8],E=$[9],g=$[10];return k[0]=q*J+ce*C+se*b,k[1]=Y*J+le*C+Ae*b,k[2]=ae*J+ne*C+G*b,k[4]=q*S+ce*x+se*V,k[5]=Y*S+le*x+Ae*V,k[6]=ae*S+ne*x+G*V,k[8]=q*A+ce*E+se*g,k[9]=Y*A+le*E+Ae*g,k[10]=ae*A+ne*E+G*g,k}const re=z;function ie(I,$,O){const k=O??L();return I!==k&&(k[0]=I[0],k[1]=I[1],k[2]=I[2],k[4]=I[4],k[5]=I[5],k[6]=I[6]),k[8]=$[0],k[9]=$[1],k[10]=1,k}function te(I,$){const O=$??e.create();return O[0]=I[8],O[1]=I[9],O}function ge(I,$,O){const k=O??e.create(),q=$*4;return k[0]=I[q+0],k[1]=I[q+1],k}function Be(I,$,O,k){const q=k===I?I:p(I,k),Y=O*4;return q[Y+0]=$[0],q[Y+1]=$[1],q}function Ge(I,$){const O=$??e.create(),k=I[0],q=I[1],Y=I[4],ae=I[5];return O[0]=Math.sqrt(k*k+q*q),O[1]=Math.sqrt(Y*Y+ae*ae),O}function Ue(I,$){const O=$??new t(12);return O[0]=1,O[1]=0,O[2]=0,O[4]=0,O[5]=1,O[6]=0,O[8]=I[0],O[9]=I[1],O[10]=1,O}function Fe(I,$,O){const k=O??new t(12),q=$[0],Y=$[1],ae=I[0],ce=I[1],le=I[2],ne=I[1*4+0],se=I[1*4+1],Ae=I[1*4+2],G=I[2*4+0],J=I[2*4+1],C=I[2*4+2];return I!==k&&(k[0]=ae,k[1]=ce,k[2]=le,k[4]=ne,k[5]=se,k[6]=Ae),k[8]=ae*q+ne*Y+G,k[9]=ce*q+se*Y+J,k[10]=le*q+Ae*Y+C,k}function Oe(I,$){const O=$??new t(12),k=Math.cos(I),q=Math.sin(I);return O[0]=k,O[1]=q,O[2]=0,O[4]=-q,O[5]=k,O[6]=0,O[8]=0,O[9]=0,O[10]=1,O}function Ce(I,$,O){const k=O??new t(12),q=I[0*4+0],Y=I[0*4+1],ae=I[0*4+2],ce=I[1*4+0],le=I[1*4+1],ne=I[1*4+2],se=Math.cos($),Ae=Math.sin($);return k[0]=se*q+Ae*ce,k[1]=se*Y+Ae*le,k[2]=se*ae+Ae*ne,k[4]=se*ce-Ae*q,k[5]=se*le-Ae*Y,k[6]=se*ne-Ae*ae,I!==k&&(k[8]=I[8],k[9]=I[9],k[10]=I[10]),k}function He(I,$){const O=$??new t(12);return O[0]=I[0],O[1]=0,O[2]=0,O[4]=0,O[5]=I[1],O[6]=0,O[8]=0,O[9]=0,O[10]=1,O}function he(I,$,O){const k=O??new t(12),q=$[0],Y=$[1];return k[0]=q*I[0*4+0],k[1]=q*I[0*4+1],k[2]=q*I[0*4+2],k[4]=Y*I[1*4+0],k[5]=Y*I[1*4+1],k[6]=Y*I[1*4+2],I!==k&&(k[8]=I[8],k[9]=I[9],k[10]=I[10]),k}function me(I,$){const O=$??new t(12);return O[0]=I,O[1]=0,O[2]=0,O[4]=0,O[5]=I,O[6]=0,O[8]=0,O[9]=0,O[10]=1,O}function fe(I,$,O){const k=O??new t(12);return k[0]=$*I[0*4+0],k[1]=$*I[0*4+1],k[2]=$*I[0*4+2],k[4]=$*I[1*4+0],k[5]=$*I[1*4+1],k[6]=$*I[1*4+2],I!==k&&(k[8]=I[8],k[9]=I[9],k[10]=I[10]),k}return{clone:y,create:c,set:u,fromMat4:d,fromQuat:h,negate:m,copy:p,equalsApproximately:M,equals:F,identity:L,transpose:K,inverse:X,invert:Q,determinant:j,mul:re,multiply:z,setTranslation:ie,getTranslation:te,getAxis:ge,setAxis:Be,getScaling:Ge,translation:Ue,translate:Fe,rotation:Oe,rotate:Ce,scaling:He,scale:he,uniformScaling:me,uniformScale:fe}}const cache$4=new Map;function getAPI$4(t){let e=cache$4.get(t);return e||(e=getAPIImpl$4(t),cache$4.set(t,e)),e}function getAPIImpl$3(t){function e(_,T,R){const D=new t(3);return _!==void 0&&(D[0]=_,T!==void 0&&(D[1]=T,R!==void 0&&(D[2]=R))),D}const c=e;function u(_,T,R,D){const P=D??new t(3);return P[0]=_,P[1]=T,P[2]=R,P}function d(_,T){const R=T??new t(3);return R[0]=Math.ceil(_[0]),R[1]=Math.ceil(_[1]),R[2]=Math.ceil(_[2]),R}function h(_,T){const R=T??new t(3);return R[0]=Math.floor(_[0]),R[1]=Math.floor(_[1]),R[2]=Math.floor(_[2]),R}function m(_,T){const R=T??new t(3);return R[0]=Math.round(_[0]),R[1]=Math.round(_[1]),R[2]=Math.round(_[2]),R}function p(_,T=0,R=1,D){const P=D??new t(3);return P[0]=Math.min(R,Math.max(T,_[0])),P[1]=Math.min(R,Math.max(T,_[1])),P[2]=Math.min(R,Math.max(T,_[2])),P}function y(_,T,R){const D=R??new t(3);return D[0]=_[0]+T[0],D[1]=_[1]+T[1],D[2]=_[2]+T[2],D}function M(_,T,R,D){const P=D??new t(3);return P[0]=_[0]+T[0]*R,P[1]=_[1]+T[1]*R,P[2]=_[2]+T[2]*R,P}function F(_,T){const R=_[0],D=_[1],P=_[2],N=T[0],H=T[1],ee=T[2],oe=Math.sqrt(R*R+D*D+P*P),W=Math.sqrt(N*N+H*H+ee*ee),Z=oe*W,ue=Z&&Oe(_,T)/Z;return Math.acos(ue)}function L(_,T,R){const D=R??new t(3);return D[0]=_[0]-T[0],D[1]=_[1]-T[1],D[2]=_[2]-T[2],D}const K=L;function X(_,T){return Math.abs(_[0]-T[0])<EPSILON&&Math.abs(_[1]-T[1])<EPSILON&&Math.abs(_[2]-T[2])<EPSILON}function j(_,T){return _[0]===T[0]&&_[1]===T[1]&&_[2]===T[2]}function Q(_,T,R,D){const P=D??new t(3);return P[0]=_[0]+R*(T[0]-_[0]),P[1]=_[1]+R*(T[1]-_[1]),P[2]=_[2]+R*(T[2]-_[2]),P}function z(_,T,R,D){const P=D??new t(3);return P[0]=_[0]+R[0]*(T[0]-_[0]),P[1]=_[1]+R[1]*(T[1]-_[1]),P[2]=_[2]+R[2]*(T[2]-_[2]),P}function re(_,T,R){const D=R??new t(3);return D[0]=Math.max(_[0],T[0]),D[1]=Math.max(_[1],T[1]),D[2]=Math.max(_[2],T[2]),D}function ie(_,T,R){const D=R??new t(3);return D[0]=Math.min(_[0],T[0]),D[1]=Math.min(_[1],T[1]),D[2]=Math.min(_[2],T[2]),D}function te(_,T,R){const D=R??new t(3);return D[0]=_[0]*T,D[1]=_[1]*T,D[2]=_[2]*T,D}const ge=te;function Be(_,T,R){const D=R??new t(3);return D[0]=_[0]/T,D[1]=_[1]/T,D[2]=_[2]/T,D}function Ge(_,T){const R=T??new t(3);return R[0]=1/_[0],R[1]=1/_[1],R[2]=1/_[2],R}const Ue=Ge;function Fe(_,T,R){const D=R??new t(3),P=_[2]*T[0]-_[0]*T[2],N=_[0]*T[1]-_[1]*T[0];return D[0]=_[1]*T[2]-_[2]*T[1],D[1]=P,D[2]=N,D}function Oe(_,T){return _[0]*T[0]+_[1]*T[1]+_[2]*T[2]}function Ce(_){const T=_[0],R=_[1],D=_[2];return Math.sqrt(T*T+R*R+D*D)}const He=Ce;function he(_){const T=_[0],R=_[1],D=_[2];return T*T+R*R+D*D}const me=he;function fe(_,T){const R=_[0]-T[0],D=_[1]-T[1],P=_[2]-T[2];return Math.sqrt(R*R+D*D+P*P)}const I=fe;function $(_,T){const R=_[0]-T[0],D=_[1]-T[1],P=_[2]-T[2];return R*R+D*D+P*P}const O=$;function k(_,T){const R=T??new t(3),D=_[0],P=_[1],N=_[2],H=Math.sqrt(D*D+P*P+N*N);return H>1e-5?(R[0]=D/H,R[1]=P/H,R[2]=N/H):(R[0]=0,R[1]=0,R[2]=0),R}function q(_,T){const R=T??new t(3);return R[0]=-_[0],R[1]=-_[1],R[2]=-_[2],R}function Y(_,T){const R=T??new t(3);return R[0]=_[0],R[1]=_[1],R[2]=_[2],R}const ae=Y;function ce(_,T,R){const D=R??new t(3);return D[0]=_[0]*T[0],D[1]=_[1]*T[1],D[2]=_[2]*T[2],D}const le=ce;function ne(_,T,R){const D=R??new t(3);return D[0]=_[0]/T[0],D[1]=_[1]/T[1],D[2]=_[2]/T[2],D}const se=ne;function Ae(_=1,T){const R=T??new t(3),D=Math.random()*2*Math.PI,P=Math.random()*2-1,N=Math.sqrt(1-P*P)*_;return R[0]=Math.cos(D)*N,R[1]=Math.sin(D)*N,R[2]=P*_,R}function G(_){const T=_??new t(3);return T[0]=0,T[1]=0,T[2]=0,T}function J(_,T,R){const D=R??new t(3),P=_[0],N=_[1],H=_[2],ee=T[3]*P+T[7]*N+T[11]*H+T[15]||1;return D[0]=(T[0]*P+T[4]*N+T[8]*H+T[12])/ee,D[1]=(T[1]*P+T[5]*N+T[9]*H+T[13])/ee,D[2]=(T[2]*P+T[6]*N+T[10]*H+T[14])/ee,D}function C(_,T,R){const D=R??new t(3),P=_[0],N=_[1],H=_[2];return D[0]=P*T[0*4+0]+N*T[1*4+0]+H*T[2*4+0],D[1]=P*T[0*4+1]+N*T[1*4+1]+H*T[2*4+1],D[2]=P*T[0*4+2]+N*T[1*4+2]+H*T[2*4+2],D}function b(_,T,R){const D=R??new t(3),P=_[0],N=_[1],H=_[2];return D[0]=P*T[0]+N*T[4]+H*T[8],D[1]=P*T[1]+N*T[5]+H*T[9],D[2]=P*T[2]+N*T[6]+H*T[10],D}function S(_,T,R){const D=R??new t(3),P=T[0],N=T[1],H=T[2],ee=T[3]*2,oe=_[0],W=_[1],Z=_[2],ue=N*Z-H*W,de=H*oe-P*Z,pe=P*W-N*oe;return D[0]=oe+ue*ee+(N*pe-H*de)*2,D[1]=W+de*ee+(H*ue-P*pe)*2,D[2]=Z+pe*ee+(P*de-N*ue)*2,D}function x(_,T){const R=T??new t(3);return R[0]=_[12],R[1]=_[13],R[2]=_[14],R}function V(_,T,R){const D=R??new t(3),P=T*4;return D[0]=_[P+0],D[1]=_[P+1],D[2]=_[P+2],D}function A(_,T){const R=T??new t(3),D=_[0],P=_[1],N=_[2],H=_[4],ee=_[5],oe=_[6],W=_[8],Z=_[9],ue=_[10];return R[0]=Math.sqrt(D*D+P*P+N*N),R[1]=Math.sqrt(H*H+ee*ee+oe*oe),R[2]=Math.sqrt(W*W+Z*Z+ue*ue),R}function E(_,T,R,D){const P=D??new t(3),N=[],H=[];return N[0]=_[0]-T[0],N[1]=_[1]-T[1],N[2]=_[2]-T[2],H[0]=N[0],H[1]=N[1]*Math.cos(R)-N[2]*Math.sin(R),H[2]=N[1]*Math.sin(R)+N[2]*Math.cos(R),P[0]=H[0]+T[0],P[1]=H[1]+T[1],P[2]=H[2]+T[2],P}function g(_,T,R,D){const P=D??new t(3),N=[],H=[];return N[0]=_[0]-T[0],N[1]=_[1]-T[1],N[2]=_[2]-T[2],H[0]=N[2]*Math.sin(R)+N[0]*Math.cos(R),H[1]=N[1],H[2]=N[2]*Math.cos(R)-N[0]*Math.sin(R),P[0]=H[0]+T[0],P[1]=H[1]+T[1],P[2]=H[2]+T[2],P}function B(_,T,R,D){const P=D??new t(3),N=[],H=[];return N[0]=_[0]-T[0],N[1]=_[1]-T[1],N[2]=_[2]-T[2],H[0]=N[0]*Math.cos(R)-N[1]*Math.sin(R),H[1]=N[0]*Math.sin(R)+N[1]*Math.cos(R),H[2]=N[2],P[0]=H[0]+T[0],P[1]=H[1]+T[1],P[2]=H[2]+T[2],P}function w(_,T,R){const D=R??new t(3);return k(_,D),te(D,T,D)}function v(_,T,R){const D=R??new t(3);return Ce(_)>T?w(_,T,D):Y(_,D)}function U(_,T,R){const D=R??new t(3);return Q(_,T,.5,D)}return{create:e,fromValues:c,set:u,ceil:d,floor:h,round:m,clamp:p,add:y,addScaled:M,angle:F,subtract:L,sub:K,equalsApproximately:X,equals:j,lerp:Q,lerpV:z,max:re,min:ie,mulScalar:te,scale:ge,divScalar:Be,inverse:Ge,invert:Ue,cross:Fe,dot:Oe,length:Ce,len:He,lengthSq:he,lenSq:me,distance:fe,dist:I,distanceSq:$,distSq:O,normalize:k,negate:q,copy:Y,clone:ae,multiply:ce,mul:le,divide:ne,div:se,random:Ae,zero:G,transformMat4:J,transformMat4Upper3x3:C,transformMat3:b,transformQuat:S,getTranslation:x,getAxis:V,getScaling:A,rotateX:E,rotateY:g,rotateZ:B,setLength:w,truncate:v,midpoint:U}}const cache$3=new Map;function getAPI$3(t){let e=cache$3.get(t);return e||(e=getAPIImpl$3(t),cache$3.set(t,e)),e}function getAPIImpl$2(t){const e=getAPI$3(t);function c(A,E,g,B,w,v,U,_,T,R,D,P,N,H,ee,oe){const W=new t(16);return A!==void 0&&(W[0]=A,E!==void 0&&(W[1]=E,g!==void 0&&(W[2]=g,B!==void 0&&(W[3]=B,w!==void 0&&(W[4]=w,v!==void 0&&(W[5]=v,U!==void 0&&(W[6]=U,_!==void 0&&(W[7]=_,T!==void 0&&(W[8]=T,R!==void 0&&(W[9]=R,D!==void 0&&(W[10]=D,P!==void 0&&(W[11]=P,N!==void 0&&(W[12]=N,H!==void 0&&(W[13]=H,ee!==void 0&&(W[14]=ee,oe!==void 0&&(W[15]=oe)))))))))))))))),W}function u(A,E,g,B,w,v,U,_,T,R,D,P,N,H,ee,oe,W){const Z=W??new t(16);return Z[0]=A,Z[1]=E,Z[2]=g,Z[3]=B,Z[4]=w,Z[5]=v,Z[6]=U,Z[7]=_,Z[8]=T,Z[9]=R,Z[10]=D,Z[11]=P,Z[12]=N,Z[13]=H,Z[14]=ee,Z[15]=oe,Z}function d(A,E){const g=E??new t(16);return g[0]=A[0],g[1]=A[1],g[2]=A[2],g[3]=0,g[4]=A[4],g[5]=A[5],g[6]=A[6],g[7]=0,g[8]=A[8],g[9]=A[9],g[10]=A[10],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function h(A,E){const g=E??new t(16),B=A[0],w=A[1],v=A[2],U=A[3],_=B+B,T=w+w,R=v+v,D=B*_,P=w*_,N=w*T,H=v*_,ee=v*T,oe=v*R,W=U*_,Z=U*T,ue=U*R;return g[0]=1-N-oe,g[1]=P+ue,g[2]=H-Z,g[3]=0,g[4]=P-ue,g[5]=1-D-oe,g[6]=ee+W,g[7]=0,g[8]=H+Z,g[9]=ee-W,g[10]=1-D-N,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function m(A,E){const g=E??new t(16);return g[0]=-A[0],g[1]=-A[1],g[2]=-A[2],g[3]=-A[3],g[4]=-A[4],g[5]=-A[5],g[6]=-A[6],g[7]=-A[7],g[8]=-A[8],g[9]=-A[9],g[10]=-A[10],g[11]=-A[11],g[12]=-A[12],g[13]=-A[13],g[14]=-A[14],g[15]=-A[15],g}function p(A,E){const g=E??new t(16);return g[0]=A[0],g[1]=A[1],g[2]=A[2],g[3]=A[3],g[4]=A[4],g[5]=A[5],g[6]=A[6],g[7]=A[7],g[8]=A[8],g[9]=A[9],g[10]=A[10],g[11]=A[11],g[12]=A[12],g[13]=A[13],g[14]=A[14],g[15]=A[15],g}const y=p;function M(A,E){return Math.abs(A[0]-E[0])<EPSILON&&Math.abs(A[1]-E[1])<EPSILON&&Math.abs(A[2]-E[2])<EPSILON&&Math.abs(A[3]-E[3])<EPSILON&&Math.abs(A[4]-E[4])<EPSILON&&Math.abs(A[5]-E[5])<EPSILON&&Math.abs(A[6]-E[6])<EPSILON&&Math.abs(A[7]-E[7])<EPSILON&&Math.abs(A[8]-E[8])<EPSILON&&Math.abs(A[9]-E[9])<EPSILON&&Math.abs(A[10]-E[10])<EPSILON&&Math.abs(A[11]-E[11])<EPSILON&&Math.abs(A[12]-E[12])<EPSILON&&Math.abs(A[13]-E[13])<EPSILON&&Math.abs(A[14]-E[14])<EPSILON&&Math.abs(A[15]-E[15])<EPSILON}function F(A,E){return A[0]===E[0]&&A[1]===E[1]&&A[2]===E[2]&&A[3]===E[3]&&A[4]===E[4]&&A[5]===E[5]&&A[6]===E[6]&&A[7]===E[7]&&A[8]===E[8]&&A[9]===E[9]&&A[10]===E[10]&&A[11]===E[11]&&A[12]===E[12]&&A[13]===E[13]&&A[14]===E[14]&&A[15]===E[15]}function L(A){const E=A??new t(16);return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function K(A,E){const g=E??new t(16);if(g===A){let de;return de=A[1],A[1]=A[4],A[4]=de,de=A[2],A[2]=A[8],A[8]=de,de=A[3],A[3]=A[12],A[12]=de,de=A[6],A[6]=A[9],A[9]=de,de=A[7],A[7]=A[13],A[13]=de,de=A[11],A[11]=A[14],A[14]=de,g}const B=A[0*4+0],w=A[0*4+1],v=A[0*4+2],U=A[0*4+3],_=A[1*4+0],T=A[1*4+1],R=A[1*4+2],D=A[1*4+3],P=A[2*4+0],N=A[2*4+1],H=A[2*4+2],ee=A[2*4+3],oe=A[3*4+0],W=A[3*4+1],Z=A[3*4+2],ue=A[3*4+3];return g[0]=B,g[1]=_,g[2]=P,g[3]=oe,g[4]=w,g[5]=T,g[6]=N,g[7]=W,g[8]=v,g[9]=R,g[10]=H,g[11]=Z,g[12]=U,g[13]=D,g[14]=ee,g[15]=ue,g}function X(A,E){const g=E??new t(16),B=A[0*4+0],w=A[0*4+1],v=A[0*4+2],U=A[0*4+3],_=A[1*4+0],T=A[1*4+1],R=A[1*4+2],D=A[1*4+3],P=A[2*4+0],N=A[2*4+1],H=A[2*4+2],ee=A[2*4+3],oe=A[3*4+0],W=A[3*4+1],Z=A[3*4+2],ue=A[3*4+3],de=H*ue,pe=Z*ee,_e=R*ue,Ee=Z*D,ye=R*ee,be=H*D,Te=v*ue,we=Z*U,Se=v*ee,Ie=H*U,Re=v*D,De=R*U,xe=P*W,ve=oe*N,Le=_*W,Pe=oe*T,Ne=_*N,ke=P*T,Je=B*W,$e=oe*w,Ke=B*N,Ve=P*w,Xe=B*T,je=_*w,Qe=de*T+Ee*N+ye*W-(pe*T+_e*N+be*W),Ye=pe*w+Te*N+Ie*W-(de*w+we*N+Se*W),ze=_e*w+we*T+Re*W-(Ee*w+Te*T+De*W),We=be*w+Se*T+De*N-(ye*w+Ie*T+Re*N),Me=1/(B*Qe+_*Ye+P*ze+oe*We);return g[0]=Me*Qe,g[1]=Me*Ye,g[2]=Me*ze,g[3]=Me*We,g[4]=Me*(pe*_+_e*P+be*oe-(de*_+Ee*P+ye*oe)),g[5]=Me*(de*B+we*P+Se*oe-(pe*B+Te*P+Ie*oe)),g[6]=Me*(Ee*B+Te*_+De*oe-(_e*B+we*_+Re*oe)),g[7]=Me*(ye*B+Ie*_+Re*P-(be*B+Se*_+De*P)),g[8]=Me*(xe*D+Pe*ee+Ne*ue-(ve*D+Le*ee+ke*ue)),g[9]=Me*(ve*U+Je*ee+Ve*ue-(xe*U+$e*ee+Ke*ue)),g[10]=Me*(Le*U+$e*D+Xe*ue-(Pe*U+Je*D+je*ue)),g[11]=Me*(ke*U+Ke*D+je*ee-(Ne*U+Ve*D+Xe*ee)),g[12]=Me*(Le*H+ke*Z+ve*R-(Ne*Z+xe*R+Pe*H)),g[13]=Me*(Ke*Z+xe*v+$e*H-(Je*H+Ve*Z+ve*v)),g[14]=Me*(Je*R+je*Z+Pe*v-(Xe*Z+Le*v+$e*R)),g[15]=Me*(Xe*H+Ne*v+Ve*R-(Ke*R+je*H+ke*v)),g}function j(A){const E=A[0],g=A[0*4+1],B=A[0*4+2],w=A[0*4+3],v=A[1*4+0],U=A[1*4+1],_=A[1*4+2],T=A[1*4+3],R=A[2*4+0],D=A[2*4+1],P=A[2*4+2],N=A[2*4+3],H=A[3*4+0],ee=A[3*4+1],oe=A[3*4+2],W=A[3*4+3],Z=P*W,ue=oe*N,de=_*W,pe=oe*T,_e=_*N,Ee=P*T,ye=B*W,be=oe*w,Te=B*N,we=P*w,Se=B*T,Ie=_*w,Re=Z*U+pe*D+_e*ee-(ue*U+de*D+Ee*ee),De=ue*g+ye*D+we*ee-(Z*g+be*D+Te*ee),xe=de*g+be*U+Se*ee-(pe*g+ye*U+Ie*ee),ve=Ee*g+Te*U+Ie*D-(_e*g+we*U+Se*D);return E*Re+v*De+R*xe+H*ve}const Q=X;function z(A,E,g){const B=g??new t(16),w=A[0],v=A[1],U=A[2],_=A[3],T=A[4],R=A[5],D=A[6],P=A[7],N=A[8],H=A[9],ee=A[10],oe=A[11],W=A[12],Z=A[13],ue=A[14],de=A[15],pe=E[0],_e=E[1],Ee=E[2],ye=E[3],be=E[4],Te=E[5],we=E[6],Se=E[7],Ie=E[8],Re=E[9],De=E[10],xe=E[11],ve=E[12],Le=E[13],Pe=E[14],Ne=E[15];return B[0]=w*pe+T*_e+N*Ee+W*ye,B[1]=v*pe+R*_e+H*Ee+Z*ye,B[2]=U*pe+D*_e+ee*Ee+ue*ye,B[3]=_*pe+P*_e+oe*Ee+de*ye,B[4]=w*be+T*Te+N*we+W*Se,B[5]=v*be+R*Te+H*we+Z*Se,B[6]=U*be+D*Te+ee*we+ue*Se,B[7]=_*be+P*Te+oe*we+de*Se,B[8]=w*Ie+T*Re+N*De+W*xe,B[9]=v*Ie+R*Re+H*De+Z*xe,B[10]=U*Ie+D*Re+ee*De+ue*xe,B[11]=_*Ie+P*Re+oe*De+de*xe,B[12]=w*ve+T*Le+N*Pe+W*Ne,B[13]=v*ve+R*Le+H*Pe+Z*Ne,B[14]=U*ve+D*Le+ee*Pe+ue*Ne,B[15]=_*ve+P*Le+oe*Pe+de*Ne,B}const re=z;function ie(A,E,g){const B=g??L();return A!==B&&(B[0]=A[0],B[1]=A[1],B[2]=A[2],B[3]=A[3],B[4]=A[4],B[5]=A[5],B[6]=A[6],B[7]=A[7],B[8]=A[8],B[9]=A[9],B[10]=A[10],B[11]=A[11]),B[12]=E[0],B[13]=E[1],B[14]=E[2],B[15]=1,B}function te(A,E){const g=E??e.create();return g[0]=A[12],g[1]=A[13],g[2]=A[14],g}function ge(A,E,g){const B=g??e.create(),w=E*4;return B[0]=A[w+0],B[1]=A[w+1],B[2]=A[w+2],B}function Be(A,E,g,B){const w=B===A?B:p(A,B),v=g*4;return w[v+0]=E[0],w[v+1]=E[1],w[v+2]=E[2],w}function Ge(A,E){const g=E??e.create(),B=A[0],w=A[1],v=A[2],U=A[4],_=A[5],T=A[6],R=A[8],D=A[9],P=A[10];return g[0]=Math.sqrt(B*B+w*w+v*v),g[1]=Math.sqrt(U*U+_*_+T*T),g[2]=Math.sqrt(R*R+D*D+P*P),g}function Ue(A,E,g,B,w){const v=w??new t(16),U=Math.tan(Math.PI*.5-.5*A);if(v[0]=U/E,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=U,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,Number.isFinite(B)){const _=1/(g-B);v[10]=B*_,v[14]=B*g*_}else v[10]=-1,v[14]=-g;return v}function Fe(A,E,g,B=1/0,w){const v=w??new t(16),U=1/Math.tan(A*.5);if(v[0]=U/E,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=U,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,B===1/0)v[10]=0,v[14]=g;else{const _=1/(B-g);v[10]=g*_,v[14]=B*g*_}return v}function Oe(A,E,g,B,w,v,U){const _=U??new t(16);return _[0]=2/(E-A),_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2/(B-g),_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1/(w-v),_[11]=0,_[12]=(E+A)/(A-E),_[13]=(B+g)/(g-B),_[14]=w/(w-v),_[15]=1,_}function Ce(A,E,g,B,w,v,U){const _=U??new t(16),T=E-A,R=B-g,D=w-v;return _[0]=2*w/T,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*w/R,_[6]=0,_[7]=0,_[8]=(A+E)/T,_[9]=(B+g)/R,_[10]=v/D,_[11]=-1,_[12]=0,_[13]=0,_[14]=w*v/D,_[15]=0,_}function He(A,E,g,B,w,v=1/0,U){const _=U??new t(16),T=E-A,R=B-g;if(_[0]=2*w/T,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*w/R,_[6]=0,_[7]=0,_[8]=(A+E)/T,_[9]=(B+g)/R,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,v===1/0)_[10]=0,_[14]=w;else{const D=1/(v-w);_[10]=w*D,_[14]=v*w*D}return _}const he=e.create(),me=e.create(),fe=e.create();function I(A,E,g,B){const w=B??new t(16);return e.normalize(e.subtract(E,A,fe),fe),e.normalize(e.cross(g,fe,he),he),e.normalize(e.cross(fe,he,me),me),w[0]=he[0],w[1]=he[1],w[2]=he[2],w[3]=0,w[4]=me[0],w[5]=me[1],w[6]=me[2],w[7]=0,w[8]=fe[0],w[9]=fe[1],w[10]=fe[2],w[11]=0,w[12]=A[0],w[13]=A[1],w[14]=A[2],w[15]=1,w}function $(A,E,g,B){const w=B??new t(16);return e.normalize(e.subtract(A,E,fe),fe),e.normalize(e.cross(g,fe,he),he),e.normalize(e.cross(fe,he,me),me),w[0]=he[0],w[1]=he[1],w[2]=he[2],w[3]=0,w[4]=me[0],w[5]=me[1],w[6]=me[2],w[7]=0,w[8]=fe[0],w[9]=fe[1],w[10]=fe[2],w[11]=0,w[12]=A[0],w[13]=A[1],w[14]=A[2],w[15]=1,w}function O(A,E,g,B){const w=B??new t(16);return e.normalize(e.subtract(A,E,fe),fe),e.normalize(e.cross(g,fe,he),he),e.normalize(e.cross(fe,he,me),me),w[0]=he[0],w[1]=me[0],w[2]=fe[0],w[3]=0,w[4]=he[1],w[5]=me[1],w[6]=fe[1],w[7]=0,w[8]=he[2],w[9]=me[2],w[10]=fe[2],w[11]=0,w[12]=-(he[0]*A[0]+he[1]*A[1]+he[2]*A[2]),w[13]=-(me[0]*A[0]+me[1]*A[1]+me[2]*A[2]),w[14]=-(fe[0]*A[0]+fe[1]*A[1]+fe[2]*A[2]),w[15]=1,w}function k(A,E){const g=E??new t(16);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=A[0],g[13]=A[1],g[14]=A[2],g[15]=1,g}function q(A,E,g){const B=g??new t(16),w=E[0],v=E[1],U=E[2],_=A[0],T=A[1],R=A[2],D=A[3],P=A[1*4+0],N=A[1*4+1],H=A[1*4+2],ee=A[1*4+3],oe=A[2*4+0],W=A[2*4+1],Z=A[2*4+2],ue=A[2*4+3],de=A[3*4+0],pe=A[3*4+1],_e=A[3*4+2],Ee=A[3*4+3];return A!==B&&(B[0]=_,B[1]=T,B[2]=R,B[3]=D,B[4]=P,B[5]=N,B[6]=H,B[7]=ee,B[8]=oe,B[9]=W,B[10]=Z,B[11]=ue),B[12]=_*w+P*v+oe*U+de,B[13]=T*w+N*v+W*U+pe,B[14]=R*w+H*v+Z*U+_e,B[15]=D*w+ee*v+ue*U+Ee,B}function Y(A,E){const g=E??new t(16),B=Math.cos(A),w=Math.sin(A);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=B,g[6]=w,g[7]=0,g[8]=0,g[9]=-w,g[10]=B,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function ae(A,E,g){const B=g??new t(16),w=A[4],v=A[5],U=A[6],_=A[7],T=A[8],R=A[9],D=A[10],P=A[11],N=Math.cos(E),H=Math.sin(E);return B[4]=N*w+H*T,B[5]=N*v+H*R,B[6]=N*U+H*D,B[7]=N*_+H*P,B[8]=N*T-H*w,B[9]=N*R-H*v,B[10]=N*D-H*U,B[11]=N*P-H*_,A!==B&&(B[0]=A[0],B[1]=A[1],B[2]=A[2],B[3]=A[3],B[12]=A[12],B[13]=A[13],B[14]=A[14],B[15]=A[15]),B}function ce(A,E){const g=E??new t(16),B=Math.cos(A),w=Math.sin(A);return g[0]=B,g[1]=0,g[2]=-w,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=w,g[9]=0,g[10]=B,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function le(A,E,g){const B=g??new t(16),w=A[0*4+0],v=A[0*4+1],U=A[0*4+2],_=A[0*4+3],T=A[2*4+0],R=A[2*4+1],D=A[2*4+2],P=A[2*4+3],N=Math.cos(E),H=Math.sin(E);return B[0]=N*w-H*T,B[1]=N*v-H*R,B[2]=N*U-H*D,B[3]=N*_-H*P,B[8]=N*T+H*w,B[9]=N*R+H*v,B[10]=N*D+H*U,B[11]=N*P+H*_,A!==B&&(B[4]=A[4],B[5]=A[5],B[6]=A[6],B[7]=A[7],B[12]=A[12],B[13]=A[13],B[14]=A[14],B[15]=A[15]),B}function ne(A,E){const g=E??new t(16),B=Math.cos(A),w=Math.sin(A);return g[0]=B,g[1]=w,g[2]=0,g[3]=0,g[4]=-w,g[5]=B,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function se(A,E,g){const B=g??new t(16),w=A[0*4+0],v=A[0*4+1],U=A[0*4+2],_=A[0*4+3],T=A[1*4+0],R=A[1*4+1],D=A[1*4+2],P=A[1*4+3],N=Math.cos(E),H=Math.sin(E);return B[0]=N*w+H*T,B[1]=N*v+H*R,B[2]=N*U+H*D,B[3]=N*_+H*P,B[4]=N*T-H*w,B[5]=N*R-H*v,B[6]=N*D-H*U,B[7]=N*P-H*_,A!==B&&(B[8]=A[8],B[9]=A[9],B[10]=A[10],B[11]=A[11],B[12]=A[12],B[13]=A[13],B[14]=A[14],B[15]=A[15]),B}function Ae(A,E,g){const B=g??new t(16);let w=A[0],v=A[1],U=A[2];const _=Math.sqrt(w*w+v*v+U*U);w/=_,v/=_,U/=_;const T=w*w,R=v*v,D=U*U,P=Math.cos(E),N=Math.sin(E),H=1-P;return B[0]=T+(1-T)*P,B[1]=w*v*H+U*N,B[2]=w*U*H-v*N,B[3]=0,B[4]=w*v*H-U*N,B[5]=R+(1-R)*P,B[6]=v*U*H+w*N,B[7]=0,B[8]=w*U*H+v*N,B[9]=v*U*H-w*N,B[10]=D+(1-D)*P,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}const G=Ae;function J(A,E,g,B){const w=B??new t(16);let v=E[0],U=E[1],_=E[2];const T=Math.sqrt(v*v+U*U+_*_);v/=T,U/=T,_/=T;const R=v*v,D=U*U,P=_*_,N=Math.cos(g),H=Math.sin(g),ee=1-N,oe=R+(1-R)*N,W=v*U*ee+_*H,Z=v*_*ee-U*H,ue=v*U*ee-_*H,de=D+(1-D)*N,pe=U*_*ee+v*H,_e=v*_*ee+U*H,Ee=U*_*ee-v*H,ye=P+(1-P)*N,be=A[0],Te=A[1],we=A[2],Se=A[3],Ie=A[4],Re=A[5],De=A[6],xe=A[7],ve=A[8],Le=A[9],Pe=A[10],Ne=A[11];return w[0]=oe*be+W*Ie+Z*ve,w[1]=oe*Te+W*Re+Z*Le,w[2]=oe*we+W*De+Z*Pe,w[3]=oe*Se+W*xe+Z*Ne,w[4]=ue*be+de*Ie+pe*ve,w[5]=ue*Te+de*Re+pe*Le,w[6]=ue*we+de*De+pe*Pe,w[7]=ue*Se+de*xe+pe*Ne,w[8]=_e*be+Ee*Ie+ye*ve,w[9]=_e*Te+Ee*Re+ye*Le,w[10]=_e*we+Ee*De+ye*Pe,w[11]=_e*Se+Ee*xe+ye*Ne,A!==w&&(w[12]=A[12],w[13]=A[13],w[14]=A[14],w[15]=A[15]),w}const C=J;function b(A,E){const g=E??new t(16);return g[0]=A[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=A[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=A[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function S(A,E,g){const B=g??new t(16),w=E[0],v=E[1],U=E[2];return B[0]=w*A[0*4+0],B[1]=w*A[0*4+1],B[2]=w*A[0*4+2],B[3]=w*A[0*4+3],B[4]=v*A[1*4+0],B[5]=v*A[1*4+1],B[6]=v*A[1*4+2],B[7]=v*A[1*4+3],B[8]=U*A[2*4+0],B[9]=U*A[2*4+1],B[10]=U*A[2*4+2],B[11]=U*A[2*4+3],A!==B&&(B[12]=A[12],B[13]=A[13],B[14]=A[14],B[15]=A[15]),B}function x(A,E){const g=E??new t(16);return g[0]=A,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=A,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=A,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function V(A,E,g){const B=g??new t(16);return B[0]=E*A[0*4+0],B[1]=E*A[0*4+1],B[2]=E*A[0*4+2],B[3]=E*A[0*4+3],B[4]=E*A[1*4+0],B[5]=E*A[1*4+1],B[6]=E*A[1*4+2],B[7]=E*A[1*4+3],B[8]=E*A[2*4+0],B[9]=E*A[2*4+1],B[10]=E*A[2*4+2],B[11]=E*A[2*4+3],A!==B&&(B[12]=A[12],B[13]=A[13],B[14]=A[14],B[15]=A[15]),B}return{create:c,set:u,fromMat3:d,fromQuat:h,negate:m,copy:p,clone:y,equalsApproximately:M,equals:F,identity:L,transpose:K,inverse:X,determinant:j,invert:Q,multiply:z,mul:re,setTranslation:ie,getTranslation:te,getAxis:ge,setAxis:Be,getScaling:Ge,perspective:Ue,perspectiveReverseZ:Fe,ortho:Oe,frustum:Ce,frustumReverseZ:He,aim:I,cameraAim:$,lookAt:O,translation:k,translate:q,rotationX:Y,rotateX:ae,rotationY:ce,rotateY:le,rotationZ:ne,rotateZ:se,axisRotation:Ae,rotation:G,axisRotate:J,rotate:C,scaling:b,scale:S,uniformScaling:x,uniformScale:V}}const cache$2=new Map;function getAPI$2(t){let e=cache$2.get(t);return e||(e=getAPIImpl$2(t),cache$2.set(t,e)),e}function getAPIImpl$1(t){const e=getAPI$3(t);function c(G,J,C,b){const S=new t(4);return G!==void 0&&(S[0]=G,J!==void 0&&(S[1]=J,C!==void 0&&(S[2]=C,b!==void 0&&(S[3]=b)))),S}const u=c;function d(G,J,C,b,S){const x=S??new t(4);return x[0]=G,x[1]=J,x[2]=C,x[3]=b,x}function h(G,J,C){const b=C??new t(4),S=J*.5,x=Math.sin(S);return b[0]=x*G[0],b[1]=x*G[1],b[2]=x*G[2],b[3]=Math.cos(S),b}function m(G,J){const C=J??e.create(3),b=Math.acos(G[3])*2,S=Math.sin(b*.5);return S>EPSILON?(C[0]=G[0]/S,C[1]=G[1]/S,C[2]=G[2]/S):(C[0]=1,C[1]=0,C[2]=0),{angle:b,axis:C}}function p(G,J){const C=Ce(G,J);return Math.acos(2*C*C-1)}function y(G,J,C){const b=C??new t(4),S=G[0],x=G[1],V=G[2],A=G[3],E=J[0],g=J[1],B=J[2],w=J[3];return b[0]=S*w+A*E+x*B-V*g,b[1]=x*w+A*g+V*E-S*B,b[2]=V*w+A*B+S*g-x*E,b[3]=A*w-S*E-x*g-V*B,b}const M=y;function F(G,J,C){const b=C??new t(4),S=J*.5,x=G[0],V=G[1],A=G[2],E=G[3],g=Math.sin(S),B=Math.cos(S);return b[0]=x*B+E*g,b[1]=V*B+A*g,b[2]=A*B-V*g,b[3]=E*B-x*g,b}function L(G,J,C){const b=C??new t(4),S=J*.5,x=G[0],V=G[1],A=G[2],E=G[3],g=Math.sin(S),B=Math.cos(S);return b[0]=x*B-A*g,b[1]=V*B+E*g,b[2]=A*B+x*g,b[3]=E*B-V*g,b}function K(G,J,C){const b=C??new t(4),S=J*.5,x=G[0],V=G[1],A=G[2],E=G[3],g=Math.sin(S),B=Math.cos(S);return b[0]=x*B+V*g,b[1]=V*B-x*g,b[2]=A*B+E*g,b[3]=E*B-A*g,b}function X(G,J,C,b){const S=b??new t(4),x=G[0],V=G[1],A=G[2],E=G[3];let g=J[0],B=J[1],w=J[2],v=J[3],U=x*g+V*B+A*w+E*v;U<0&&(U=-U,g=-g,B=-B,w=-w,v=-v);let _,T;if(1-U>EPSILON){const R=Math.acos(U),D=Math.sin(R);_=Math.sin((1-C)*R)/D,T=Math.sin(C*R)/D}else _=1-C,T=C;return S[0]=_*x+T*g,S[1]=_*V+T*B,S[2]=_*A+T*w,S[3]=_*E+T*v,S}function j(G,J){const C=J??new t(4),b=G[0],S=G[1],x=G[2],V=G[3],A=b*b+S*S+x*x+V*V,E=A?1/A:0;return C[0]=-b*E,C[1]=-S*E,C[2]=-x*E,C[3]=V*E,C}function Q(G,J){const C=J??new t(4);return C[0]=-G[0],C[1]=-G[1],C[2]=-G[2],C[3]=G[3],C}function z(G,J){const C=J??new t(4),b=G[0]+G[5]+G[10];if(b>0){const S=Math.sqrt(b+1);C[3]=.5*S;const x=.5/S;C[0]=(G[6]-G[9])*x,C[1]=(G[8]-G[2])*x,C[2]=(G[1]-G[4])*x}else{let S=0;G[5]>G[0]&&(S=1),G[10]>G[S*4+S]&&(S=2);const x=(S+1)%3,V=(S+2)%3,A=Math.sqrt(G[S*4+S]-G[x*4+x]-G[V*4+V]+1);C[S]=.5*A;const E=.5/A;C[3]=(G[x*4+V]-G[V*4+x])*E,C[x]=(G[x*4+S]+G[S*4+x])*E,C[V]=(G[V*4+S]+G[S*4+V])*E}return C}function re(G,J,C,b,S){const x=S??new t(4),V=G*.5,A=J*.5,E=C*.5,g=Math.sin(V),B=Math.cos(V),w=Math.sin(A),v=Math.cos(A),U=Math.sin(E),_=Math.cos(E);switch(b){case"xyz":x[0]=g*v*_+B*w*U,x[1]=B*w*_-g*v*U,x[2]=B*v*U+g*w*_,x[3]=B*v*_-g*w*U;break;case"xzy":x[0]=g*v*_-B*w*U,x[1]=B*w*_-g*v*U,x[2]=B*v*U+g*w*_,x[3]=B*v*_+g*w*U;break;case"yxz":x[0]=g*v*_+B*w*U,x[1]=B*w*_-g*v*U,x[2]=B*v*U-g*w*_,x[3]=B*v*_+g*w*U;break;case"yzx":x[0]=g*v*_+B*w*U,x[1]=B*w*_+g*v*U,x[2]=B*v*U-g*w*_,x[3]=B*v*_-g*w*U;break;case"zxy":x[0]=g*v*_-B*w*U,x[1]=B*w*_+g*v*U,x[2]=B*v*U+g*w*_,x[3]=B*v*_-g*w*U;break;case"zyx":x[0]=g*v*_-B*w*U,x[1]=B*w*_+g*v*U,x[2]=B*v*U-g*w*_,x[3]=B*v*_+g*w*U;break;default:throw new Error(`Unknown rotation order: ${b}`)}return x}function ie(G,J){const C=J??new t(4);return C[0]=G[0],C[1]=G[1],C[2]=G[2],C[3]=G[3],C}const te=ie;function ge(G,J,C){const b=C??new t(4);return b[0]=G[0]+J[0],b[1]=G[1]+J[1],b[2]=G[2]+J[2],b[3]=G[3]+J[3],b}function Be(G,J,C){const b=C??new t(4);return b[0]=G[0]-J[0],b[1]=G[1]-J[1],b[2]=G[2]-J[2],b[3]=G[3]-J[3],b}const Ge=Be;function Ue(G,J,C){const b=C??new t(4);return b[0]=G[0]*J,b[1]=G[1]*J,b[2]=G[2]*J,b[3]=G[3]*J,b}const Fe=Ue;function Oe(G,J,C){const b=C??new t(4);return b[0]=G[0]/J,b[1]=G[1]/J,b[2]=G[2]/J,b[3]=G[3]/J,b}function Ce(G,J){return G[0]*J[0]+G[1]*J[1]+G[2]*J[2]+G[3]*J[3]}function He(G,J,C,b){const S=b??new t(4);return S[0]=G[0]+C*(J[0]-G[0]),S[1]=G[1]+C*(J[1]-G[1]),S[2]=G[2]+C*(J[2]-G[2]),S[3]=G[3]+C*(J[3]-G[3]),S}function he(G){const J=G[0],C=G[1],b=G[2],S=G[3];return Math.sqrt(J*J+C*C+b*b+S*S)}const me=he;function fe(G){const J=G[0],C=G[1],b=G[2],S=G[3];return J*J+C*C+b*b+S*S}const I=fe;function $(G,J){const C=J??new t(4),b=G[0],S=G[1],x=G[2],V=G[3],A=Math.sqrt(b*b+S*S+x*x+V*V);return A>1e-5?(C[0]=b/A,C[1]=S/A,C[2]=x/A,C[3]=V/A):(C[0]=0,C[1]=0,C[2]=0,C[3]=1),C}function O(G,J){return Math.abs(G[0]-J[0])<EPSILON&&Math.abs(G[1]-J[1])<EPSILON&&Math.abs(G[2]-J[2])<EPSILON&&Math.abs(G[3]-J[3])<EPSILON}function k(G,J){return G[0]===J[0]&&G[1]===J[1]&&G[2]===J[2]&&G[3]===J[3]}function q(G){const J=G??new t(4);return J[0]=0,J[1]=0,J[2]=0,J[3]=1,J}const Y=e.create(),ae=e.create(),ce=e.create();function le(G,J,C){const b=C??new t(4),S=e.dot(G,J);return S<-.999999?(e.cross(ae,G,Y),e.len(Y)<1e-6&&e.cross(ce,G,Y),e.normalize(Y,Y),h(Y,Math.PI,b),b):S>.999999?(b[0]=0,b[1]=0,b[2]=0,b[3]=1,b):(e.cross(G,J,Y),b[0]=Y[0],b[1]=Y[1],b[2]=Y[2],b[3]=1+S,$(b,b))}const ne=new t(4),se=new t(4);function Ae(G,J,C,b,S,x){const V=x??new t(4);return X(G,b,S,ne),X(J,C,S,se),X(ne,se,2*S*(1-S),V),V}return{create:c,fromValues:u,set:d,fromAxisAngle:h,toAxisAngle:m,angle:p,multiply:y,mul:M,rotateX:F,rotateY:L,rotateZ:K,slerp:X,inverse:j,conjugate:Q,fromMat:z,fromEuler:re,copy:ie,clone:te,add:ge,subtract:Be,sub:Ge,mulScalar:Ue,scale:Fe,divScalar:Oe,dot:Ce,lerp:He,length:he,len:me,lengthSq:fe,lenSq:I,normalize:$,equalsApproximately:O,equals:k,identity:q,rotationTo:le,sqlerp:Ae}}const cache$1=new Map;function getAPI$1(t){let e=cache$1.get(t);return e||(e=getAPIImpl$1(t),cache$1.set(t,e)),e}function getAPIImpl(t){function e(C,b,S,x){const V=new t(4);return C!==void 0&&(V[0]=C,b!==void 0&&(V[1]=b,S!==void 0&&(V[2]=S,x!==void 0&&(V[3]=x)))),V}const c=e;function u(C,b,S,x,V){const A=V??new t(4);return A[0]=C,A[1]=b,A[2]=S,A[3]=x,A}function d(C,b){const S=b??new t(4);return S[0]=Math.ceil(C[0]),S[1]=Math.ceil(C[1]),S[2]=Math.ceil(C[2]),S[3]=Math.ceil(C[3]),S}function h(C,b){const S=b??new t(4);return S[0]=Math.floor(C[0]),S[1]=Math.floor(C[1]),S[2]=Math.floor(C[2]),S[3]=Math.floor(C[3]),S}function m(C,b){const S=b??new t(4);return S[0]=Math.round(C[0]),S[1]=Math.round(C[1]),S[2]=Math.round(C[2]),S[3]=Math.round(C[3]),S}function p(C,b=0,S=1,x){const V=x??new t(4);return V[0]=Math.min(S,Math.max(b,C[0])),V[1]=Math.min(S,Math.max(b,C[1])),V[2]=Math.min(S,Math.max(b,C[2])),V[3]=Math.min(S,Math.max(b,C[3])),V}function y(C,b,S){const x=S??new t(4);return x[0]=C[0]+b[0],x[1]=C[1]+b[1],x[2]=C[2]+b[2],x[3]=C[3]+b[3],x}function M(C,b,S,x){const V=x??new t(4);return V[0]=C[0]+b[0]*S,V[1]=C[1]+b[1]*S,V[2]=C[2]+b[2]*S,V[3]=C[3]+b[3]*S,V}function F(C,b,S){const x=S??new t(4);return x[0]=C[0]-b[0],x[1]=C[1]-b[1],x[2]=C[2]-b[2],x[3]=C[3]-b[3],x}const L=F;function K(C,b){return Math.abs(C[0]-b[0])<EPSILON&&Math.abs(C[1]-b[1])<EPSILON&&Math.abs(C[2]-b[2])<EPSILON&&Math.abs(C[3]-b[3])<EPSILON}function X(C,b){return C[0]===b[0]&&C[1]===b[1]&&C[2]===b[2]&&C[3]===b[3]}function j(C,b,S,x){const V=x??new t(4);return V[0]=C[0]+S*(b[0]-C[0]),V[1]=C[1]+S*(b[1]-C[1]),V[2]=C[2]+S*(b[2]-C[2]),V[3]=C[3]+S*(b[3]-C[3]),V}function Q(C,b,S,x){const V=x??new t(4);return V[0]=C[0]+S[0]*(b[0]-C[0]),V[1]=C[1]+S[1]*(b[1]-C[1]),V[2]=C[2]+S[2]*(b[2]-C[2]),V[3]=C[3]+S[3]*(b[3]-C[3]),V}function z(C,b,S){const x=S??new t(4);return x[0]=Math.max(C[0],b[0]),x[1]=Math.max(C[1],b[1]),x[2]=Math.max(C[2],b[2]),x[3]=Math.max(C[3],b[3]),x}function re(C,b,S){const x=S??new t(4);return x[0]=Math.min(C[0],b[0]),x[1]=Math.min(C[1],b[1]),x[2]=Math.min(C[2],b[2]),x[3]=Math.min(C[3],b[3]),x}function ie(C,b,S){const x=S??new t(4);return x[0]=C[0]*b,x[1]=C[1]*b,x[2]=C[2]*b,x[3]=C[3]*b,x}const te=ie;function ge(C,b,S){const x=S??new t(4);return x[0]=C[0]/b,x[1]=C[1]/b,x[2]=C[2]/b,x[3]=C[3]/b,x}function Be(C,b){const S=b??new t(4);return S[0]=1/C[0],S[1]=1/C[1],S[2]=1/C[2],S[3]=1/C[3],S}const Ge=Be;function Ue(C,b){return C[0]*b[0]+C[1]*b[1]+C[2]*b[2]+C[3]*b[3]}function Fe(C){const b=C[0],S=C[1],x=C[2],V=C[3];return Math.sqrt(b*b+S*S+x*x+V*V)}const Oe=Fe;function Ce(C){const b=C[0],S=C[1],x=C[2],V=C[3];return b*b+S*S+x*x+V*V}const He=Ce;function he(C,b){const S=C[0]-b[0],x=C[1]-b[1],V=C[2]-b[2],A=C[3]-b[3];return Math.sqrt(S*S+x*x+V*V+A*A)}const me=he;function fe(C,b){const S=C[0]-b[0],x=C[1]-b[1],V=C[2]-b[2],A=C[3]-b[3];return S*S+x*x+V*V+A*A}const I=fe;function $(C,b){const S=b??new t(4),x=C[0],V=C[1],A=C[2],E=C[3],g=Math.sqrt(x*x+V*V+A*A+E*E);return g>1e-5?(S[0]=x/g,S[1]=V/g,S[2]=A/g,S[3]=E/g):(S[0]=0,S[1]=0,S[2]=0,S[3]=0),S}function O(C,b){const S=b??new t(4);return S[0]=-C[0],S[1]=-C[1],S[2]=-C[2],S[3]=-C[3],S}function k(C,b){const S=b??new t(4);return S[0]=C[0],S[1]=C[1],S[2]=C[2],S[3]=C[3],S}const q=k;function Y(C,b,S){const x=S??new t(4);return x[0]=C[0]*b[0],x[1]=C[1]*b[1],x[2]=C[2]*b[2],x[3]=C[3]*b[3],x}const ae=Y;function ce(C,b,S){const x=S??new t(4);return x[0]=C[0]/b[0],x[1]=C[1]/b[1],x[2]=C[2]/b[2],x[3]=C[3]/b[3],x}const le=ce;function ne(C){const b=C??new t(4);return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b}function se(C,b,S){const x=S??new t(4),V=C[0],A=C[1],E=C[2],g=C[3];return x[0]=b[0]*V+b[4]*A+b[8]*E+b[12]*g,x[1]=b[1]*V+b[5]*A+b[9]*E+b[13]*g,x[2]=b[2]*V+b[6]*A+b[10]*E+b[14]*g,x[3]=b[3]*V+b[7]*A+b[11]*E+b[15]*g,x}function Ae(C,b,S){const x=S??new t(4);return $(C,x),ie(x,b,x)}function G(C,b,S){const x=S??new t(4);return Fe(C)>b?Ae(C,b,x):k(C,x)}function J(C,b,S){const x=S??new t(4);return j(C,b,.5,x)}return{create:e,fromValues:c,set:u,ceil:d,floor:h,round:m,clamp:p,add:y,addScaled:M,subtract:F,sub:L,equalsApproximately:K,equals:X,lerp:j,lerpV:Q,max:z,min:re,mulScalar:ie,scale:te,divScalar:ge,inverse:Be,invert:Ge,dot:Ue,length:Fe,len:Oe,lengthSq:Ce,lenSq:He,distance:he,dist:me,distanceSq:fe,distSq:I,normalize:$,negate:O,copy:k,clone:q,multiply:Y,mul:ae,divide:ce,div:le,zero:ne,transformMat4:se,setLength:Ae,truncate:G,midpoint:J}}const cache=new Map;function getAPI(t){let e=cache.get(t);return e||(e=getAPIImpl(t),cache.set(t,e)),e}function wgpuMatrixAPI(t,e,c,u,d,h){return{mat4:getAPI$2(t),mat3:getAPI$4(e),quat:getAPI$1(c),vec2:getAPI$5(u),vec3:getAPI$3(d),vec4:getAPI(h)}}const{mat4,mat3,quat,vec2,vec3,vec4}=wgpuMatrixAPI(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);wgpuMatrixAPI(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);wgpuMatrixAPI(ZeroArray,Array,Array,Array,Array,Array);function setupLoaders(){registerLoaders([GLTFLoader,ImageLoader])}function getFloatArray(t,e){const c=t.json,u=c.accessors[e],d=c.bufferViews[u.bufferView],h=t.buffers[d.buffer],m=(u.byteOffset??0)+(d.byteOffset??0)+h.byteOffset;return new Float32Array(h.arrayBuffer,m,d.byteLength/4)}class Texture{image;sampler;constructor(e,c){this.image=e,this.sampler=c}}class Material{static nextId=0;id;materialBindGroup;constructor(e,c){this.id=Material.nextId++;const u=c[e.pbrMetallicRoughness.baseColorTexture.index];this.materialBindGroup=device.createBindGroup({label:"material bind group",layout:materialBindGroupLayout,entries:[{binding:0,resource:u.image.createView()},{binding:1,resource:u.sampler}]})}}class Primitive{vertexBuffer;indexBuffer;numIndices=-1;material;constructor(e,c,u){this.material=u;const d=c.json,h=d.accessors[e.indices],m=d.bufferViews[h.bufferView],p=h.componentType,y=c.buffers[m.buffer],M=(h.byteOffset??0)+(m.byteOffset??0)+y.byteOffset;let F;switch(p){case 5123:F=Uint32Array.from(new Uint16Array(y.arrayBuffer,M,h.count));break;case 5125:F=new Uint32Array(y.arrayBuffer,M,h.count);break;default:throw new Error(`unsupported index buffer element component type: 0x${p.toString(16)}`)}const L=getFloatArray(c,e.attributes.POSITION),K=getFloatArray(c,e.attributes.NORMAL),X=getFloatArray(c,e.attributes.TEXCOORD_0),j=8,Q=L.length/3,z=new Float32Array(Q*j);for(let re=0;re<Q;++re){const ie=re*j;z[ie]=L[re*3],z[ie+1]=L[re*3+1],z[ie+2]=L[re*3+2],z[ie+3]=K[re*3],z[ie+4]=K[re*3+1],z[ie+5]=K[re*3+2],z[ie+6]=X[re*2],z[ie+7]=X[re*2+1]}this.indexBuffer=device.createBuffer({label:"index buffer",size:F.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.indexBuffer,0,F),this.vertexBuffer=device.createBuffer({label:"vertex buffer",size:z.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.vertexBuffer,0,z),this.numIndices=F.length}}class Mesh{primitives=[];constructor(e,c,u){e.primitives.forEach(d=>{this.primitives.push(new Primitive(d,c,u[d.material]))}),this.primitives.sort((d,h)=>d.material.id-h.material.id)}}class Node{name="node";parent;children=new Set;transform=mat4.identity();modelMatUniformBuffer;modelBindGroup;mesh;setName(e){this.name=e}setParent(e){this.parent!=null&&this.parent.children.delete(this),this.parent=e,e.children.add(this)}propagateTransformations(){this.parent!=null&&(this.transform=mat4.mul(this.parent.transform,this.transform)),this.mesh!=null&&(this.modelMatUniformBuffer=device.createBuffer({label:"model mat uniform",size:16*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.modelMatUniformBuffer,0,this.transform),this.modelBindGroup=device.createBindGroup({label:"model bind group",layout:modelBindGroupLayout,entries:[{binding:0,resource:{buffer:this.modelMatUniformBuffer}}]}));for(let e of this.children)e.propagateTransformations()}}function createTexture(t){let e=device.createTexture({size:[t.width,t.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return device.queue.copyExternalImageToTexture({source:t},{texture:e},{width:t.width,height:t.height}),e}function convertWrapModeEnum(t){switch(t){case 10497:return"repeat";case 33071:return"clamp-to-edge";case 33648:return"mirror-repeat";default:throw new Error(`unsupported wrap mode: 0x${t.toString(16)}`)}}function createSampler(t){let e={};switch(t.magFilter){case 9728:e.magFilter="nearest";break;case 9729:e.magFilter="linear";break;default:throw new Error(`unsupported magFilter: 0x${t.magFilter.toString(16)}`)}switch(t.minFilter){case 9728:e.minFilter="nearest";break;case 9729:e.minFilter="linear";break;case 9984:e.minFilter="nearest",e.mipmapFilter="nearest";break;case 9985:e.minFilter="linear",e.mipmapFilter="nearest";break;case 9986:e.minFilter="nearest",e.mipmapFilter="linear";break;case 9987:e.minFilter="linear",e.mipmapFilter="linear";break;default:throw new Error(`unsupported minFilter: 0x${t.minFilter.toString(16)}`)}return e.addressModeU=convertWrapModeEnum(t.wrapS),e.addressModeV=convertWrapModeEnum(t.wrapT),device.createSampler(e)}class Scene{root=new Node;constructor(){this.root.setName("root")}async loadGltf(e){const c=await load(e),u=c.json;let d=[];{let M=[];for(let L of c.images)M.push(createTexture(L));let F=[];for(let L of u.samplers)F.push(createSampler(L));for(let L of u.textures)d.push(new Texture(M[L.source],F[L.sampler]))}let h=[];for(let M of u.materials)h.push(new Material(M,d));let m=[];for(let M of u.meshes)m.push(new Mesh(M,c,h));let p=new Node;p.setName("scene root"),p.setParent(this.root);let y=[];for(let M of u.nodes){let F=new Node;F.setName(M.name),F.setParent(p),M.mesh!=null&&(F.mesh=m[M.mesh]),M.matrix!=null?F.transform=new Float32Array(M.matrix):(M.translation!=null&&(F.transform=mat4.mul(F.transform,mat4.translation(M.translation))),M.rotation!=null&&(F.transform=mat4.mul(F.transform,mat4.fromQuat(M.rotation))),M.scale!=null&&(F.transform=mat4.mul(F.transform,mat4.scaling(M.scale)))),y.push(F)}for(let M in u.nodes){const F=u.nodes[M];if(F.children!=null)for(let L of F.children)y[L].setParent(y[M])}p.propagateTransformations()}iterate(e,c,u){let d=[this.root],h;for(;d.length>0;){let m=d.pop();if(m.mesh!=null){e(m);for(let p of m.mesh.primitives)p.material.id!=h&&(c(p.material),h=p.material.id),u(p)}for(let p of m.children)d.push(p)}}}function hueToRgb(t){let e=(c,u=(c+t*6)%6)=>1-Math.max(Math.min(u,4-u,1),0);return vec3.lerp(vec3.create(1,1,1),vec3.create(e(5),e(3),e(1)),.8)}class Lights{camera;numLights=500;static maxNumLights=5e3;static numFloatsPerLight=8;static lightIntensity=.1;lightsArray=new Float32Array(Lights.maxNumLights*Lights.numFloatsPerLight);lightSetStorageBuffer;timeUniformBuffer;moveLightsComputeBindGroupLayout;moveLightsComputeBindGroup;moveLightsComputePipeline;clusterComputeBindGroupLayout;clusterComputeBindGroup;clusterComputePipeline;clusterSetBuffer;constructor(e){this.camera=e,this.lightSetStorageBuffer=device.createBuffer({label:"lights",size:16+this.lightsArray.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.populateLightsBuffer(),this.updateLightSetUniformNumLights(),this.timeUniformBuffer=device.createBuffer({label:"time uniform",size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.moveLightsComputeBindGroupLayout=device.createBindGroupLayout({label:"move lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.moveLightsComputeBindGroup=device.createBindGroup({label:"move lights compute bind group",layout:this.moveLightsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.timeUniformBuffer}}]}),this.moveLightsComputePipeline=device.createComputePipeline({label:"move lights compute pipeline",layout:device.createPipelineLayout({label:"move lights compute pipeline layout",bindGroupLayouts:[this.moveLightsComputeBindGroupLayout]}),compute:{module:device.createShaderModule({label:"move lights compute shader",code:moveLightsComputeSrc}),entryPoint:"main"}});const c=36+4*constants.maxLightsPerCluster,u=constants.clusterDim[0]*constants.clusterDim[1]*constants.clusterDim[2],d=16+u*c;this.clusterSetBuffer=device.createBuffer({label:"cluster sets",size:d,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.clusterSetBuffer,0,new Uint32Array([u])),this.clusterComputeBindGroupLayout=device.createBindGroupLayout({label:"cluster lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.clusterComputeBindGroup=device.createBindGroup({label:"cluster lights compute bind group",layout:this.clusterComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.clusterSetBuffer}},{binding:2,resource:{buffer:this.camera.uniformsBuffer}}]}),this.clusterComputePipeline=device.createComputePipeline({label:"cluster lights compute pipeline",layout:device.createPipelineLayout({label:"cluster lights compute pipeline layout",bindGroupLayouts:[this.clusterComputeBindGroupLayout]}),compute:{module:device.createShaderModule({label:"cluster lights compute shader",code:clusteringComputeSrc}),entryPoint:"main"}})}populateLightsBuffer(){for(let e=0;e<Lights.maxNumLights;++e){const c=vec3.scale(hueToRgb(Math.random()),Lights.lightIntensity);this.lightsArray.set(c,e*Lights.numFloatsPerLight+4)}device.queue.writeBuffer(this.lightSetStorageBuffer,16,this.lightsArray)}updateLightSetUniformNumLights(){device.queue.writeBuffer(this.lightSetStorageBuffer,0,new Uint32Array([this.numLights]))}doLightClustering(e){const c=e.beginComputePass();c.setPipeline(this.clusterComputePipeline),c.setBindGroup(0,this.clusterComputeBindGroup);const u=Math.ceil(constants.clusterDim[0]/constants.clusterWorkgroupSize[0]),d=Math.ceil(constants.clusterDim[1]/constants.clusterWorkgroupSize[1]),h=Math.ceil(constants.clusterDim[2]/constants.clusterWorkgroupSize[2]);c.dispatchWorkgroups(u,d,h),c.end()}onFrame(e){device.queue.writeBuffer(this.timeUniformBuffer,0,new Float32Array([e]));const c=device.createCommandEncoder(),u=c.beginComputePass();u.setPipeline(this.moveLightsComputePipeline),u.setBindGroup(0,this.moveLightsComputeBindGroup);const d=Math.ceil(this.numLights/constants.moveLightsWorkgroupSize);u.dispatchWorkgroups(d),u.end(),device.queue.submit([c.finish()])}}function toRadians(t){return t*Math.PI/180}class CameraUniforms{buffer=new ArrayBuffer(68*4);floatView=new Float32Array(this.buffer);set viewProjMat(e){this.floatView.set(e.subarray(0,16),0)}set viewMat(e){this.floatView.set(e.subarray(0,16),16)}set invProjMat(e){this.floatView.set(e.subarray(0,16),32)}set invViewMat(e){this.floatView.set(e.subarray(0,16),48)}set screenDimensions(e){this.floatView.set(e.subarray(0,2),64)}}class Camera{uniforms=new CameraUniforms;uniformsBuffer;projMat=mat4.create();cameraPos=vec3.create(-7,2,0);cameraFront=vec3.create(0,0,-1);cameraUp=vec3.create(0,1,0);cameraRight=vec3.create(1,0,0);yaw=0;pitch=0;moveSpeed=.004;sensitivity=.15;static nearPlane=.1;static farPlane=1e3;keys={};constructor(){this.uniformsBuffer=device.createBuffer({label:"uniform_buffer",size:this.uniforms.buffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.projMat=mat4.perspective(toRadians(fovYDegrees),aspectRatio,Camera.nearPlane,Camera.farPlane),this.rotateCamera(0,0),window.addEventListener("keydown",e=>this.onKeyEvent(e,!0)),window.addEventListener("keyup",e=>this.onKeyEvent(e,!1)),window.onblur=()=>this.keys={},canvas.addEventListener("mousedown",()=>canvas.requestPointerLock()),canvas.addEventListener("mouseup",()=>document.exitPointerLock()),canvas.addEventListener("mousemove",e=>this.onMouseMove(e))}onKeyEvent(e,c){this.keys[e.key.toLowerCase()]=c,this.keys.alt&&e.preventDefault()}rotateCamera(e,c){this.yaw+=e,this.pitch-=c,this.pitch>89&&(this.pitch=89),this.pitch<-89&&(this.pitch=-89);const u=mat4.create();u[0]=Math.cos(toRadians(this.yaw))*Math.cos(toRadians(this.pitch)),u[1]=Math.sin(toRadians(this.pitch)),u[2]=Math.sin(toRadians(this.yaw))*Math.cos(toRadians(this.pitch)),this.cameraFront=vec3.normalize(u),this.cameraRight=vec3.normalize(vec3.cross(this.cameraFront,[0,1,0])),this.cameraUp=vec3.normalize(vec3.cross(this.cameraRight,this.cameraFront))}onMouseMove(e){document.pointerLockElement===canvas&&this.rotateCamera(e.movementX*this.sensitivity,e.movementY*this.sensitivity)}processInput(e){let c=vec3.create(0,0,0);this.keys.w&&(c=vec3.add(c,this.cameraFront)),this.keys.s&&(c=vec3.sub(c,this.cameraFront)),this.keys.a&&(c=vec3.sub(c,this.cameraRight)),this.keys.d&&(c=vec3.add(c,this.cameraRight)),this.keys.q&&(c=vec3.sub(c,this.cameraUp)),this.keys.e&&(c=vec3.add(c,this.cameraUp));let u=this.moveSpeed*e;const d=3;if(this.keys.shift&&(u*=d),this.keys.alt&&(u/=d),vec3.length(c)>0){const h=vec3.scale(vec3.normalize(c),u);this.cameraPos=vec3.add(this.cameraPos,h)}}onFrame(e){this.processInput(e);const c=vec3.add(this.cameraPos,vec3.scale(this.cameraFront,1)),u=mat4.lookAt(this.cameraPos,c,[0,1,0]),d=mat4.mul(this.projMat,u);this.uniforms.viewProjMat=d,this.uniforms.viewMat=u,this.uniforms.invProjMat=mat4.inverse(this.projMat),this.uniforms.invViewMat=mat4.inverse(u),this.uniforms.screenDimensions=vec2.fromValues(canvas.width,canvas.height),device.queue.writeBuffer(this.uniformsBuffer,0,this.uniforms.buffer,0,this.uniforms.buffer.byteLength)}}class Stage{scene;lights;camera;stats;constructor(e,c,u,d){this.scene=e,this.lights=c,this.camera=u,this.stats=d}}await initWebGPU();setupLoaders();let scene=new Scene;await scene.loadGltf("./scenes/sponza/Sponza.gltf");const camera=new Camera,lights=new Lights(camera),stats=new Stats;stats.showPanel(0);document.body.appendChild(stats.dom);const gui=new GUI$1;gui.add(lights,"numLights").min(1).max(Lights.maxNumLights).step(1).onChange(()=>{lights.updateLightSetUniformNumLights()});const stage=new Stage(scene,lights,camera,stats);var renderer;function setRenderer(t){switch(renderer?.stop(),t){case renderModes.naive:renderer=new NaiveRenderer(stage);break;case renderModes.forwardPlus:renderer=new ForwardPlusRenderer(stage);break;case renderModes.clusteredDeferred:renderer=new ClusteredDeferredRenderer(stage);break}}const renderModes={naive:"naive",forwardPlus:"forward+",clusteredDeferred:"clustered deferred"};let renderModeController=gui.add({mode:renderModes.naive},"mode",renderModes);renderModeController.onChange(setRenderer);setRenderer(renderModeController.getValue());
